"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1119],{"./public/app/features/profile/ChangePasswordPage.tsx":(e,a,s)=>{s.r(a),s.d(a,{ChangePasswordPage:()=>v,default:()=>x});s("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var n,r,o=s("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useMount.js"),t=s("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),c=s("./public/app/core/selectors/navModel.ts"),i=s("./public/app/core/components/Page/Page.tsx"),d=s("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/3/opt/drone/yarncache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),u=s("./packages/grafana-ui/src/index.ts"),l=s("./public/app/core/config.ts"),p=s("./public/app/core/components/PasswordField/PasswordField.tsx"),w=s("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const f=({user:e,onChangePassword:a,isSaving:s})=>{var o,t;const{ldapEnabled:c,authProxyEnabled:i,disableLoginForm:f}=l.ZP,g=(null===(o=e.authLabels)||void 0===o?void 0:o.length)&&e.authLabels[0];return c||i?n||(n=(0,w.jsx)("p",{children:"You cannot change password when LDAP or auth proxy authentication is enabled."})):g&&f?r||(r=(0,w.jsx)("p",{children:"Password cannot be changed here."})):(0,w.jsx)("div",{className:d.css`
        max-width: 400px;
      `,children:(0,w.jsx)(u.Form,{onSubmit:a,children:({register:e,errors:a,getValues:n})=>{var r,o,c;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(u.Field,{label:"Old password",invalid:!!a.oldPassword,error:null==a||null===(r=a.oldPassword)||void 0===r?void 0:r.message,children:(0,w.jsx)(p.Z,Object.assign({id:"current-password",autoComplete:"current-password"},e("oldPassword",{required:"Old password is required"})))}),(0,w.jsx)(u.Field,{label:"New password",invalid:!!a.newPassword,error:null==a||null===(o=a.newPassword)||void 0===o?void 0:o.message,children:(0,w.jsx)(p.Z,Object.assign({id:"new-password",autoComplete:"new-password"},e("newPassword",{required:"New password is required",validate:{confirm:e=>e===n().confirmNew||"Passwords must match",old:e=>e!==n().oldPassword||"New password can't be the same as the old one."}})))}),(0,w.jsx)(u.Field,{label:"Confirm password",invalid:!!a.confirmNew,error:null==a||null===(c=a.confirmNew)||void 0===c?void 0:c.message,children:(0,w.jsx)(p.Z,Object.assign({id:"confirm-new-password",autoComplete:"new-password"},e("confirmNew",{required:"New password confirmation is required",validate:e=>e===n().newPassword||"Passwords must match"})))}),(0,w.jsxs)(u.HorizontalGroup,{children:[t||(t=(0,w.jsx)(u.Button,{variant:"primary",disabled:s,children:"Change Password"})),(0,w.jsx)(u.LinkButton,{variant:"secondary",href:`${l.ZP.appSubUrl}/profile`,fill:"outline",children:"Cancel"})]})]})}})})};var g,h=s("./public/app/features/profile/state/actions.ts");const m={loadUser:h.II,changePassword:h.Cp};function v({navModel:e,loadUser:a,isUpdating:s,user:n,changePassword:r}){return(0,o.Z)((()=>a())),(0,w.jsx)(i.Z,{navModel:e,children:(0,w.jsx)(i.Z.Contents,{isLoading:!Boolean(n),children:n?(0,w.jsxs)(w.Fragment,{children:[g||(g=(0,w.jsx)("h3",{className:"page-heading",children:"Change Your Password"})),(0,w.jsx)(f,{user:n,onChangePassword:r,isSaving:s})]}):null})})}const x=(0,t.connect)((function(e){const a=e.user,{isUpdating:s,user:n}=a;return{navModel:(0,c.h)(e.navIndex,"change-password"),isUpdating:s,user:n}}),m)(v)},"./public/app/features/profile/state/actions.ts":(e,a,s)=>{s.d(a,{Cp:()=>t,hz:()=>u,PA:()=>c,II:()=>i,cc:()=>d,Lj:()=>l});var n=s("./packages/grafana-runtime/src/index.ts"),r=s("./public/app/features/profile/state/reducers.ts");const o={changePassword:async function(e){try{await(0,n.getBackendSrv)().put("/api/user/password",e)}catch(e){console.error(e)}},revokeUserSession:async function(e){await(0,n.getBackendSrv)().post("/api/user/revoke-auth-token",{authTokenId:e})},loadUser:function(){return(0,n.getBackendSrv)().get("/api/user")},loadSessions:function(){return(0,n.getBackendSrv)().get("/api/user/auth-tokens")},loadOrgs:function(){return(0,n.getBackendSrv)().get("/api/user/orgs")},loadTeams:function(){return(0,n.getBackendSrv)().get("/api/user/teams")},setUserOrg:async function(e){await(0,n.getBackendSrv)().post("/api/user/using/"+e.orgId,{})},updateUserProfile:async function(e){try{await(0,n.getBackendSrv)().put("/api/user",e)}catch(e){console.error(e)}}};function t(e){return async function(a){a((0,r.zc)({updating:!0})),await o.changePassword(e),a((0,r.zc)({updating:!1}))}}function c(){return async function(e){await e(i()),e((async function(e){e((0,r.qD)());const a=await o.loadTeams();e((0,r.PL)({teams:a}))})),e((async function(e){e((0,r.$S)());const a=await o.loadOrgs();e((0,r.Ns)({orgs:a}))})),e((async function(e){e((0,r.Uk)());const a=await o.loadSessions();e((0,r.z0)({sessions:a}))}))}}function i(){return async function(e){const a=await o.loadUser();e((0,r.aw)({user:a}))}}function d(e){return async function(a){a((0,r.zc)({updating:!0})),await o.revokeUserSession(e),a((0,r.p$)({tokenId:e}))}}function u(e){return async function(a){a((0,r.zc)({updating:!0})),await o.setUserOrg(e),window.location.href=n.config.appSubUrl+"/profile"}}function l(e){return async function(a){a((0,r.zc)({updating:!0})),await o.updateUserProfile(e),await a(i()),a((0,r.zc)({updating:!1}))}}},"./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useMount.js":(e,a,s)=>{s.d(a,{Z:()=>r});var n=s("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useEffectOnce.js");const r=function(e){(0,n.Z)((function(){e()}))}}}]);
//# sourceMappingURL=1119.1f65f885c5a67f13d9d6.js.map