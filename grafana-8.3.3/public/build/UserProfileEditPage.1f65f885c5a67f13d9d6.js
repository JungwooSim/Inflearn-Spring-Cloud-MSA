"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7323],{"./public/app/core/components/SharedPreferences/SharedPreferences.tsx":(e,s,a)=>{a.d(s,{v:()=>m,Z:()=>g});var r,t,n=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=a("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/3/opt/drone/yarncache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),o=a("./packages/grafana-ui/src/index.ts"),d=a("./packages/grafana-e2e-selectors/src/index.ts"),l=a("./public/app/core/services/backend_srv.ts"),c=a("./public/app/core/services/PreferencesService.ts"),u=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function h(e,s,a){return s in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a,e}const p=[{value:"",label:"Default"},{value:"dark",label:"Dark"},{value:"light",label:"Light"}];class m extends n.PureComponent{constructor(e){super(e),h(this,"service",void 0),h(this,"onSubmitForm",(async()=>{const{homeDashboardId:e,theme:s,timezone:a,weekStart:r}=this.state;await this.service.update({homeDashboardId:e,theme:s,timezone:a,weekStart:r}),window.location.reload()})),h(this,"onThemeChanged",(e=>{this.setState({theme:e})})),h(this,"onTimeZoneChanged",(e=>{e&&this.setState({timezone:e})})),h(this,"onWeekStartChanged",(e=>{this.setState({weekStart:e})})),h(this,"onHomeDashboardChanged",(e=>{this.setState({homeDashboardId:e})})),h(this,"getFullDashName",(e=>void 0===e.folderTitle||""===e.folderTitle?e.title:e.folderTitle+" / "+e.title)),this.service=new c.y(e.resourceUri),this.state={homeDashboardId:0,theme:"",timezone:"",weekStart:"",dashboards:[]}}async componentDidMount(){const e=await this.service.load(),s=await l.ae.search({starred:!0});if(e.homeDashboardId>0&&!s.find((s=>s.id===e.homeDashboardId))){const a=await l.ae.search({dashboardIds:[e.homeDashboardId]});a&&a.length>0&&s.push(a[0])}this.setState({homeDashboardId:e.homeDashboardId,theme:e.theme,timezone:e.timezone,weekStart:e.weekStart,dashboards:[{id:0,title:"Default",tags:[],type:"",uid:"",uri:"",url:"",folderId:0,folderTitle:"",folderUid:"",folderUrl:"",isStarred:!1,slug:"",items:[]},...s]})}render(){const{theme:e,timezone:s,weekStart:a,homeDashboardId:n,dashboards:i}=this.state,{disabled:l}=this.props,c=f();return(0,u.jsx)(o.Form,{onSubmit:this.onSubmitForm,children:()=>{var h;return(0,u.jsxs)(o.FieldSet,{label:"Preferences",disabled:l,children:[(0,u.jsx)(o.Field,{label:"UI Theme",children:(0,u.jsx)(o.RadioButtonGroup,{options:p,value:null===(h=p.find((s=>s.value===e)))||void 0===h?void 0:h.value,onChange:this.onThemeChanged})}),(0,u.jsx)(o.Field,{label:(0,u.jsxs)(o.Label,{htmlFor:"home-dashboard-select",children:[(0,u.jsx)("span",{className:c.labelText,children:"Home Dashboard"}),r||(r=(0,u.jsx)(o.Tooltip,{content:"Not finding the dashboard you want? Star it first, then it should appear in this select box.",children:(0,u.jsx)(o.Icon,{name:"info-circle"})}))]}),"data-testid":"User preferences home dashboard drop down",children:(0,u.jsx)(o.Select,{menuShouldPortal:!0,value:i.find((e=>e.id===n)),getOptionValue:e=>e.id,getOptionLabel:this.getFullDashName,onChange:e=>this.onHomeDashboardChanged(e.id),options:i,placeholder:"Choose default dashboard",inputId:"home-dashboard-select"})}),(0,u.jsx)(o.Field,{label:"Timezone","data-testid":d.wl.components.TimeZonePicker.containerV2,children:(0,u.jsx)(o.TimeZonePicker,{includeInternal:!0,value:s,onChange:this.onTimeZoneChanged,inputId:"shared-preferences-timezone-picker"})}),(0,u.jsx)(o.Field,{label:"Week start","data-testid":d.wl.components.WeekStartPicker.containerV2,children:(0,u.jsx)(o.WeekStartPicker,{value:a,onChange:this.onWeekStartChanged,inputId:"shared-preferences-week-start-picker"})}),t||(t=(0,u.jsx)("div",{className:"gf-form-button-row",children:(0,u.jsx)(o.Button,{variant:"primary","aria-label":"User preferences save button",children:"Save"})}))]})}})}}const g=m,f=(0,o.stylesFactory)((()=>({labelText:i.css`
      margin-right: 6px;
    `})))},"./public/app/features/profile/UserProfileEditPage.tsx":(e,s,a)=>{a.r(s),a.d(s,{UserProfileEditPage:()=>Z,default:()=>E});var r,t,n,i,o=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),d=a("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),l=a("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useMount.js"),c=a("./packages/grafana-ui/src/index.ts"),u=a("./public/app/core/selectors/navModel.ts"),h=a("./public/app/core/components/Page/Page.tsx"),p=a("./public/app/features/profile/state/actions.ts"),m=a("./public/app/core/config.ts"),g=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const{disableLoginForm:f}=m.ZP,x=({user:e,isSavingUser:s,updateProfile:a})=>{var i;return(0,g.jsx)(c.Form,{onSubmit:e=>{a(e)},validateOn:"onBlur",children:({register:a,errors:o})=>{var d,l,u;return(0,g.jsxs)(c.FieldSet,{label:"Edit profile",children:[(0,g.jsx)(c.Field,{label:"Name",invalid:!!o.name,error:"Name is required",disabled:f,children:(0,g.jsx)(c.Input,Object.assign({},a("name",{required:!0}),{id:"edit-user-profile-name",placeholder:"Name",defaultValue:null!==(d=null==e?void 0:e.name)&&void 0!==d?d:"",suffix:r||(r=(0,g.jsx)(j,{}))}))}),(0,g.jsx)(c.Field,{label:"Email",invalid:!!o.email,error:"Email is required",disabled:f,children:(0,g.jsx)(c.Input,Object.assign({},a("email",{required:!0}),{id:"edit-user-profile-email",placeholder:"Email",defaultValue:null!==(l=null==e?void 0:e.email)&&void 0!==l?l:"",suffix:t||(t=(0,g.jsx)(j,{}))}))}),(0,g.jsx)(c.Field,{label:"Username",disabled:f,children:(0,g.jsx)(c.Input,Object.assign({},a("login"),{id:"edit-user-profile-username",defaultValue:null!==(u=null==e?void 0:e.login)&&void 0!==u?u:"",placeholder:"Username",suffix:n||(n=(0,g.jsx)(j,{}))}))}),i||(i=(0,g.jsx)("div",{className:"gf-form-button-row",children:(0,g.jsx)(c.Button,{variant:"primary",disabled:s,"aria-label":"Edit user profile save button",children:"Save"})}))]})}})},j=()=>f?i||(i=(0,g.jsx)(c.Tooltip,{content:"Login details locked because they are managed in another system.",children:(0,g.jsx)(c.Icon,{name:"lock"})})):null;var b,v,S,k=a("./public/app/core/components/SharedPreferences/SharedPreferences.tsx");class w extends o.PureComponent{render(){const{isLoading:e,teams:s}=this.props;return e?b||(b=(0,g.jsx)(c.LoadingPlaceholder,{text:"Loading teams..."})):0===s.length?null:(0,g.jsxs)("div",{children:[v||(v=(0,g.jsx)("h3",{className:"page-sub-heading",children:"Teams"})),(0,g.jsx)("div",{className:"gf-form-group",children:(0,g.jsxs)("table",{className:"filter-table form-inline","aria-label":"User teams table",children:[S||(S=(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{}),(0,g.jsx)("th",{children:"Name"}),(0,g.jsx)("th",{children:"Email"}),(0,g.jsx)("th",{children:"Members"})]})})),(0,g.jsx)("tbody",{children:s.map(((e,s)=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{className:"width-4 text-center",children:(0,g.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:""})}),(0,g.jsx)("td",{children:e.name}),(0,g.jsx)("td",{children:e.email}),(0,g.jsx)("td",{children:e.memberCount})]},s)))})]})})]})}}var y,P,U,z;class I extends o.PureComponent{render(){const{isLoading:e,orgs:s,user:a}=this.props;return e?y||(y=(0,g.jsx)(c.LoadingPlaceholder,{text:"Loading organizations..."})):0===s.length?null:(0,g.jsxs)("div",{children:[P||(P=(0,g.jsx)("h3",{className:"page-sub-heading",children:"Organizations"})),(0,g.jsx)("div",{className:"gf-form-group",children:(0,g.jsxs)("table",{className:"filter-table form-inline","aria-label":"User organizations table",children:[U||(U=(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Name"}),(0,g.jsx)("th",{children:"Role"}),(0,g.jsx)("th",{})]})})),(0,g.jsx)("tbody",{children:s.map(((e,s)=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:e.name}),(0,g.jsx)("td",{children:e.role}),(0,g.jsx)("td",{className:"text-right",children:e.orgId===(null==a?void 0:a.orgId)?z||(z=(0,g.jsx)(c.Button,{variant:"secondary",size:"sm",disabled:!0,children:"Current"})):(0,g.jsx)(c.Button,{variant:"secondary",size:"sm",onClick:()=>{this.props.setUserOrg(e)},"aria-label":`Switch to the organization named ${e.name}`,children:"Select"})})]},s)))})]})})]})}}const L=I;var _,C,N,D,T;class F extends o.PureComponent{render(){const{isLoading:e,sessions:s,revokeUserSession:a}=this.props;return e?_||(_=(0,g.jsx)(c.LoadingPlaceholder,{text:"Loading sessions..."})):(0,g.jsx)("div",{children:s.length>0&&(0,g.jsxs)(g.Fragment,{children:[C||(C=(0,g.jsx)("h3",{className:"page-sub-heading",children:"Sessions"})),(0,g.jsx)("div",{className:"gf-form-group",children:(0,g.jsxs)("table",{className:"filter-table form-inline","aria-label":"User sessions table",children:[N||(N=(0,g.jsx)("thead",{children:(0,g.jsxs)("tr",{children:[(0,g.jsx)("th",{children:"Last seen"}),(0,g.jsx)("th",{children:"Logged on"}),(0,g.jsx)("th",{children:"IP address"}),(0,g.jsx)("th",{children:"Browser & OS"}),(0,g.jsx)("th",{})]})})),(0,g.jsx)("tbody",{children:s.map(((e,s)=>(0,g.jsxs)("tr",{children:[e.isActive?D||(D=(0,g.jsx)("td",{children:"Now"})):(0,g.jsx)("td",{children:e.seenAt}),(0,g.jsx)("td",{children:e.createdAt}),(0,g.jsx)("td",{children:e.clientIp}),(0,g.jsxs)("td",{children:[e.browser," on ",e.os," ",e.osVersion]}),(0,g.jsx)("td",{children:(0,g.jsx)(c.Button,{size:"sm",variant:"destructive",onClick:()=>a(e.id),"aria-label":"Revoke user session",children:T||(T=(0,g.jsx)(c.Icon,{name:"power"}))})})]},s)))})]})})]})})}}const O=F;var B;const A={initUserProfilePage:p.PA,revokeUserSession:p.cc,changeUserOrg:p.hz,updateUserProfile:p.Lj};function Z({navModel:e,orgsAreLoading:s,sessionsAreLoading:a,teamsAreLoading:r,initUserProfilePage:t,orgs:n,sessions:i,teams:o,isUpdating:d,user:u,revokeUserSession:p,changeUserOrg:m,updateUserProfile:f}){return(0,l.Z)((()=>t())),(0,g.jsx)(h.Z,{navModel:e,children:(0,g.jsx)(h.Z.Contents,{isLoading:!u,children:(0,g.jsxs)(c.VerticalGroup,{spacing:"md",children:[(0,g.jsx)(x,{updateProfile:f,isSavingUser:d,user:u}),B||(B=(0,g.jsx)(k.Z,{resourceUri:"user"})),(0,g.jsx)(w,{isLoading:r,teams:o}),(0,g.jsx)(L,{isLoading:s,setUserOrg:m,orgs:n,user:u}),(0,g.jsx)(O,{isLoading:a,revokeUserSession:p,sessions:i})]})})})}const E=(0,d.connect)((function(e){const s=e.user,{user:a,teams:r,orgs:t,sessions:n,teamsAreLoading:i,orgsAreLoading:o,sessionsAreLoading:d,isUpdating:l}=s;return{navModel:(0,u.h)(e.navIndex,"profile-settings"),orgsAreLoading:o,sessionsAreLoading:d,teamsAreLoading:i,orgs:t,sessions:n,teams:r,isUpdating:l,user:a}}),A)(Z)},"./public/app/features/profile/state/actions.ts":(e,s,a)=>{a.d(s,{Cp:()=>i,hz:()=>c,PA:()=>o,II:()=>d,cc:()=>l,Lj:()=>u});var r=a("./packages/grafana-runtime/src/index.ts"),t=a("./public/app/features/profile/state/reducers.ts");const n={changePassword:async function(e){try{await(0,r.getBackendSrv)().put("/api/user/password",e)}catch(e){console.error(e)}},revokeUserSession:async function(e){await(0,r.getBackendSrv)().post("/api/user/revoke-auth-token",{authTokenId:e})},loadUser:function(){return(0,r.getBackendSrv)().get("/api/user")},loadSessions:function(){return(0,r.getBackendSrv)().get("/api/user/auth-tokens")},loadOrgs:function(){return(0,r.getBackendSrv)().get("/api/user/orgs")},loadTeams:function(){return(0,r.getBackendSrv)().get("/api/user/teams")},setUserOrg:async function(e){await(0,r.getBackendSrv)().post("/api/user/using/"+e.orgId,{})},updateUserProfile:async function(e){try{await(0,r.getBackendSrv)().put("/api/user",e)}catch(e){console.error(e)}}};function i(e){return async function(s){s((0,t.zc)({updating:!0})),await n.changePassword(e),s((0,t.zc)({updating:!1}))}}function o(){return async function(e){await e(d()),e((async function(e){e((0,t.qD)());const s=await n.loadTeams();e((0,t.PL)({teams:s}))})),e((async function(e){e((0,t.$S)());const s=await n.loadOrgs();e((0,t.Ns)({orgs:s}))})),e((async function(e){e((0,t.Uk)());const s=await n.loadSessions();e((0,t.z0)({sessions:s}))}))}}function d(){return async function(e){const s=await n.loadUser();e((0,t.aw)({user:s}))}}function l(e){return async function(s){s((0,t.zc)({updating:!0})),await n.revokeUserSession(e),s((0,t.p$)({tokenId:e}))}}function c(e){return async function(s){s((0,t.zc)({updating:!0})),await n.setUserOrg(e),window.location.href=r.config.appSubUrl+"/profile"}}function u(e){return async function(s){s((0,t.zc)({updating:!0})),await n.updateUserProfile(e),await s(d()),s((0,t.zc)({updating:!1}))}}},"./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useMount.js":(e,s,a)=>{a.d(s,{Z:()=>t});var r=a("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useEffectOnce.js");const t=function(e){(0,r.Z)((function(){e()}))}}}]);
//# sourceMappingURL=UserProfileEditPage.1f65f885c5a67f13d9d6.js.map