"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8431],{"./public/app/features/folders/FolderPermissions.tsx":(e,s,i)=>{i.r(s),i.d(s,{FolderPermissions:()=>y,default:()=>A});var n,r,t,o,a=i("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),d=i("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),c=i("./public/app/core/components/Page/Page.tsx"),l=i("./packages/grafana-ui/src/index.ts"),p=i("./public/app/core/components/Animations/SlideDown.tsx"),u=i("./public/app/core/selectors/navModel.ts"),m=i("./public/app/features/folders/state/actions.ts"),f=i("./public/app/features/folders/state/navModel.ts"),h=i("./public/app/core/components/PermissionList/PermissionList.tsx"),b=i("./public/app/core/components/PermissionList/AddPermission.tsx"),v=i("./public/app/core/components/PermissionList/PermissionsInfo.tsx"),g=i("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function x(e,s,i){return s in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i,e}const P={getFolderByUid:m.Pb,getFolderPermissions:m.a,updateFolderPermission:m.v7,removeFolderPermission:m.Uk,addFolderPermission:m.pz},j=(0,d.connect)(((e,s)=>{const i=s.match.params.uid;return{navModel:(0,u.h)(e.navIndex,`folder-permissions-${i}`,(0,f._)(1)),folderUid:i,folder:e.folder}}),P);class y extends a.PureComponent{constructor(e){super(e),x(this,"onOpenAddPermissions",(()=>{this.setState({isAdding:!0})})),x(this,"onRemoveItem",(e=>{this.props.removeFolderPermission(e)})),x(this,"onPermissionChanged",((e,s)=>{this.props.updateFolderPermission(e,s)})),x(this,"onAddPermission",(e=>this.props.addFolderPermission(e))),x(this,"onCancelAddPermission",(()=>{this.setState({isAdding:!1})})),this.state={isAdding:!1}}componentDidMount(){this.props.getFolderByUid(this.props.folderUid),this.props.getFolderPermissions(this.props.folderUid)}render(){const{navModel:e,folder:s}=this.props,{isAdding:i}=this.state;if(0===s.id)return(0,g.jsx)(c.Z,{navModel:e,children:n||(n=(0,g.jsx)(c.Z.Contents,{isLoading:!0,children:(0,g.jsx)("span",{})}))});const a={title:s.title,url:s.url,id:s.id};return(0,g.jsx)(c.Z,{navModel:e,children:(0,g.jsxs)(c.Z.Contents,{children:[(0,g.jsxs)("div",{className:"page-action-bar",children:[r||(r=(0,g.jsx)("h3",{className:"page-sub-heading",children:"Folder Permissions"})),t||(t=(0,g.jsx)(l.Tooltip,{placement:"auto",content:(0,g.jsx)(v.Z,{}),children:(0,g.jsx)(l.Icon,{className:"icon--has-hover page-sub-heading-icon",name:"question-circle"})})),o||(o=(0,g.jsx)("div",{className:"page-action-bar__spacer"})),(0,g.jsx)(l.Button,{className:"pull-right",onClick:this.onOpenAddPermissions,disabled:i,children:"Add Permission"})]}),(0,g.jsx)(p.s,{in:i,children:(0,g.jsx)(b.Z,{onAddPermission:this.onAddPermission,onCancel:this.onCancelAddPermission})}),(0,g.jsx)(h.Z,{items:s.permissions,onRemoveItem:this.onRemoveItem,onPermissionChanged:this.onPermissionChanged,isFetching:!1,folderInfo:a})]})})}}const A=j(y)},"./public/app/features/folders/state/actions.ts":(e,s,i)=>{i.d(s,{Pb:()=>l,OD:()=>p,Go:()=>u,a:()=>m,v7:()=>h,Uk:()=>b,pz:()=>v,W7:()=>g});var n=i("./packages/grafana-data/src/index.ts"),r=i("./packages/grafana-runtime/src/index.ts"),t=i("./public/app/core/services/backend_srv.ts"),o=i("./public/app/core/actions/index.ts"),a=i("./public/app/features/folders/state/navModel.ts"),d=i("./public/app/core/app_events.ts"),c=i("./public/app/features/folders/state/reducers.ts");function l(e){return async s=>{const i=await t.ae.getFolderByUid(e);s((0,c.G3)(i)),s((0,o.RL)((0,a.B)(i)))}}function p(e){return async s=>{const i=await t.ae.put(`/api/folders/${e.uid}`,{title:e.title,version:e.version});d.Z.emit(n.AppEvents.alertSuccess,["Folder saved"]),r.locationService.push(`${i.url}/settings`)}}function u(e){return async()=>{await t.ae.delete(`/api/folders/${e}?forceDeleteRules=false`),r.locationService.push("/dashboards")}}function m(e){return async s=>{const i=await t.ae.get(`/api/folders/${e}/permissions`);s((0,c.R7)(i))}}function f(e){return{userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}}function h(e,s){return async(i,n)=>{const r=n().folder,o=[];for(const i of r.permissions){if(i.inherited)continue;const n=f(i);e===i&&(n.permission=s),o.push(n)}await t.ae.post(`/api/folders/${r.uid}/permissions`,{items:o}),await i(m(r.uid))}}function b(e){return async(s,i)=>{const n=i().folder,r=[];for(const s of n.permissions)s.inherited||s===e||r.push(f(s));await t.ae.post(`/api/folders/${n.uid}/permissions`,{items:r}),await s(m(n.uid))}}function v(e){return async(s,i)=>{const n=i().folder,r=[];for(const e of n.permissions)e.inherited||r.push(f(e));r.push({userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}),await t.ae.post(`/api/folders/${n.uid}/permissions`,{items:r}),await s(m(n.uid))}}function g(e){return async()=>{const s=await(0,r.getBackendSrv)().post("/api/folders",{title:e});d.Z.emit(n.AppEvents.alertSuccess,["Folder Created","OK"]),r.locationService.push(n.locationUtil.stripBaseFromUrl(s.url))}}},"./public/app/features/folders/state/navModel.ts":(e,s,i)=>{function n(e){const s={icon:"folder",id:"manage-folder",subTitle:"Manage folder dashboards and permissions",url:"",text:e.title,breadcrumbs:[{title:"Dashboards",url:"dashboards"}],children:[{active:!1,icon:"apps",id:`folder-dashboards-${e.uid}`,text:"Dashboards",url:e.url}]};return s.children.push({active:!1,icon:"library-panel",id:`folder-library-panels-${e.uid}`,text:"Panels",url:`${e.url}/library-panels`}),e.canAdmin&&s.children.push({active:!1,icon:"lock",id:`folder-permissions-${e.uid}`,text:"Permissions",url:`${e.url}/permissions`}),e.canSave&&s.children.push({active:!1,icon:"cog",id:`folder-settings-${e.uid}`,text:"Settings",url:`${e.url}/settings`}),s}function r(e){const s=n({id:1,uid:"loading",title:"Loading",url:"url",canSave:!0,canEdit:!0,canAdmin:!0,version:0});return s.children[e].active=!0,{main:s,node:s.children[e]}}i.d(s,{B:()=>n,_:()=>r})}}]);
//# sourceMappingURL=FolderPermissions.1f65f885c5a67f13d9d6.js.map