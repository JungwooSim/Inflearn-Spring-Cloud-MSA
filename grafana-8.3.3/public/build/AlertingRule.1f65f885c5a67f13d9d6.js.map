{"version":3,"file":"AlertingRule.1f65f885c5a67f13d9d6.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/unified/utils/query.ts","webpack://grafana/./public/app/features/alerting/unified/components/rule-viewer/RuleViewerVisualization.tsx","webpack://grafana/./public/app/features/alerting/unified/RuleViewer.tsx","webpack://grafana/./public/app/features/alerting/unified/components/PanelPluginsButtonGroup.tsx","webpack://grafana/./public/app/features/alerting/unified/components/rule-viewer/RuleViewerLayout.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/useCombinedRule.ts","webpack://grafana/./public/app/features/alerting/unified/utils/timeRange.ts","webpack://grafana/./public/app/features/alerting/unified/state/AlertingQueryRunner.ts","webpack://grafana/./public/app/features/expressions/guards.ts","webpack://grafana/./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useIsomorphicLayoutEffect.js","webpack://grafana/./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useObservable.js"],"sourcesContent":["import { DataQuery, DataSourceInstanceSettings } from '@grafana/data';\nimport { LokiQuery } from 'app/plugins/datasource/loki/types';\nimport { PromQuery } from 'app/plugins/datasource/prometheus/types';\nimport { CombinedRule } from 'app/types/unified-alerting';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { isCloudRulesSource, isGrafanaRulesSource } from './datasource';\nimport { isGrafanaRulerRule } from './rules';\n\nexport function alertRuleToQueries(combinedRule: CombinedRule | undefined | null): AlertQuery[] {\n  if (!combinedRule) {\n    return [];\n  }\n  const { namespace, rulerRule } = combinedRule;\n  const { rulesSource } = namespace;\n\n  if (isGrafanaRulesSource(rulesSource)) {\n    if (isGrafanaRulerRule(rulerRule)) {\n      return rulerRule.grafana_alert.data;\n    }\n  }\n\n  if (isCloudRulesSource(rulesSource)) {\n    const model = cloudAlertRuleToModel(rulesSource, combinedRule);\n\n    return [\n      {\n        refId: model.refId,\n        datasourceUid: rulesSource.uid,\n        queryType: '',\n        model,\n        relativeTimeRange: {\n          from: 360,\n          to: 0,\n        },\n      },\n    ];\n  }\n\n  return [];\n}\n\nfunction cloudAlertRuleToModel(dsSettings: DataSourceInstanceSettings, rule: CombinedRule): DataQuery {\n  const refId = 'A';\n\n  switch (dsSettings.type) {\n    case 'prometheus': {\n      const query: PromQuery = {\n        refId,\n        expr: rule.query,\n      };\n\n      return query;\n    }\n\n    case 'loki': {\n      const query: LokiQuery = {\n        refId,\n        expr: rule.query,\n      };\n\n      return query;\n    }\n\n    default:\n      throw new Error(`Query for datasource type ${dsSettings.type} is currently not supported by cloud alert rules.`);\n  }\n}\n","import React, { useCallback, useState } from 'react';\nimport { css } from '@emotion/css';\nimport { DataSourceInstanceSettings, DateTime, dateTime, GrafanaTheme2, PanelData, urlUtil } from '@grafana/data';\nimport { config, getDataSourceSrv, PanelRenderer } from '@grafana/runtime';\nimport { Alert, CodeEditor, DateTimePicker, LinkButton, useStyles2, useTheme2 } from '@grafana/ui';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\nimport { PanelOptions } from 'app/plugins/panel/table/models.gen';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { PanelPluginsButtonGroup, SupportedPanelPlugins } from '../PanelPluginsButtonGroup';\nimport { TABLE, TIMESERIES } from '../../utils/constants';\n\ntype RuleViewerVisualizationProps = {\n  data?: PanelData;\n  query: AlertQuery;\n  onChangeQuery: (query: AlertQuery) => void;\n};\n\nconst headerHeight = 4;\n\nexport function RuleViewerVisualization(props: RuleViewerVisualizationProps): JSX.Element | null {\n  const theme = useTheme2();\n  const styles = useStyles2(getStyles);\n  const { data, query, onChangeQuery } = props;\n  const defaultPanel = isExpressionQuery(query.model) ? TABLE : TIMESERIES;\n  const [panel, setPanel] = useState<SupportedPanelPlugins>(defaultPanel);\n  const dsSettings = getDataSourceSrv().getInstanceSettings(query.datasourceUid);\n  const relativeTimeRange = query.relativeTimeRange;\n  const [options, setOptions] = useState<PanelOptions>({\n    frameIndex: 0,\n    showHeader: true,\n  });\n\n  const onTimeChange = useCallback(\n    (newDateTime: DateTime) => {\n      const now = dateTime().unix() - newDateTime.unix();\n\n      if (relativeTimeRange) {\n        const interval = relativeTimeRange.from - relativeTimeRange.to;\n        onChangeQuery({\n          ...query,\n          relativeTimeRange: { from: now + interval, to: now },\n        });\n      }\n    },\n    [onChangeQuery, query, relativeTimeRange]\n  );\n\n  const setDateTime = useCallback((relativeTimeRangeTo: number) => {\n    return relativeTimeRangeTo === 0 ? dateTime() : dateTime().subtract(relativeTimeRangeTo, 'seconds');\n  }, []);\n\n  if (!data) {\n    return null;\n  }\n\n  if (!dsSettings) {\n    return (\n      <div className={styles.content}>\n        <Alert title=\"Could not find datasource for query\" />\n        <CodeEditor\n          width=\"100%\"\n          height=\"250px\"\n          language=\"json\"\n          showLineNumbers={false}\n          showMiniMap={false}\n          value={JSON.stringify(query, null, '\\t')}\n          readOnly={true}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.content}>\n      <AutoSizer>\n        {({ width, height }) => {\n          return (\n            <div style={{ width, height }}>\n              <div className={styles.header}>\n                <div>\n                  {`Query ${query.refId}`}\n                  <span className={styles.dataSource}>({dsSettings.name})</span>\n                </div>\n                <div className={styles.actions}>\n                  {!isExpressionQuery(query.model) && relativeTimeRange ? (\n                    <DateTimePicker\n                      date={setDateTime(relativeTimeRange.to)}\n                      onChange={onTimeChange}\n                      maxDate={new Date()}\n                    />\n                  ) : null}\n                  <PanelPluginsButtonGroup onChange={setPanel} value={panel} size=\"md\" />\n                  {!isExpressionQuery(query.model) && (\n                    <>\n                      <div className={styles.spacing} />\n                      <LinkButton\n                        size=\"md\"\n                        variant=\"secondary\"\n                        icon=\"compass\"\n                        target=\"_blank\"\n                        href={createExploreLink(dsSettings, query)}\n                      >\n                        View in Explore\n                      </LinkButton>\n                    </>\n                  )}\n                </div>\n              </div>\n              <PanelRenderer\n                height={height - theme.spacing.gridSize * headerHeight}\n                width={width}\n                data={data}\n                pluginId={panel}\n                title=\"\"\n                onOptionsChange={setOptions}\n                options={options}\n              />\n            </div>\n          );\n        }}\n      </AutoSizer>\n    </div>\n  );\n}\n\nfunction createExploreLink(settings: DataSourceInstanceSettings, query: AlertQuery): string {\n  const { name } = settings;\n  const { refId, ...rest } = query.model;\n  const queryParams = { ...rest, datasource: name };\n\n  return urlUtil.renderUrl(`${config.appSubUrl}/explore`, {\n    left: JSON.stringify(['now-1h', 'now', name, queryParams]),\n  });\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    content: css`\n      width: 100%;\n      height: 250px;\n    `,\n    header: css`\n      height: ${theme.spacing(headerHeight)};\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      white-space: nowrap;\n    `,\n    refId: css`\n      font-weight: ${theme.typography.fontWeightMedium};\n      color: ${theme.colors.text.link};\n      overflow: hidden;\n    `,\n    dataSource: css`\n      margin-left: ${theme.spacing(1)};\n      font-style: italic;\n      color: ${theme.colors.text.secondary};\n    `,\n    actions: css`\n      display: flex;\n      align-items: center;\n    `,\n    spacing: css`\n      padding: ${theme.spacing(0, 1, 0, 0)};\n    `,\n    errorMessage: css`\n      white-space: pre-wrap;\n    `,\n  };\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useObservable } from 'react-use';\nimport { css } from '@emotion/css';\nimport { GrafanaTheme2, LoadingState, PanelData } from '@grafana/data';\nimport {\n  withErrorBoundary,\n  useStyles2,\n  Alert,\n  LoadingPlaceholder,\n  PanelChromeLoadingIndicator,\n  Icon,\n} from '@grafana/ui';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { AlertingQueryRunner } from './state/AlertingQueryRunner';\nimport { useCombinedRule } from './hooks/useCombinedRule';\nimport { alertRuleToQueries } from './utils/query';\nimport { RuleState } from './components/rules/RuleState';\nimport { getRulesSourceByName } from './utils/datasource';\nimport { DetailsField } from './components/DetailsField';\nimport { RuleHealth } from './components/rules/RuleHealth';\nimport { RuleViewerVisualization } from './components/rule-viewer/RuleViewerVisualization';\nimport { RuleDetailsActionButtons } from './components/rules/RuleDetailsActionButtons';\nimport { RuleDetailsMatchingInstances } from './components/rules/RuleDetailsMatchingInstances';\nimport { RuleDetailsDataSources } from './components/rules/RuleDetailsDataSources';\nimport { RuleViewerLayout, RuleViewerLayoutContent } from './components/rule-viewer/RuleViewerLayout';\nimport { AlertLabels } from './components/AlertLabels';\nimport { RuleDetailsExpression } from './components/rules/RuleDetailsExpression';\nimport { RuleDetailsAnnotations } from './components/rules/RuleDetailsAnnotations';\nimport * as ruleId from './utils/rule-id';\nimport { AlertQuery } from '../../../types/unified-alerting-dto';\n\ntype RuleViewerProps = GrafanaRouteComponentProps<{ id?: string; sourceName?: string }>;\n\nconst errorMessage = 'Could not find data source for rule';\nconst errorTitle = 'Could not view rule';\nconst pageTitle = 'Alerting / View rule';\n\nexport function RuleViewer({ match }: RuleViewerProps) {\n  const styles = useStyles2(getStyles);\n  const { id, sourceName } = match.params;\n  const identifier = ruleId.tryParse(id, true);\n  const { loading, error, result: rule } = useCombinedRule(identifier, sourceName);\n  const runner = useMemo(() => new AlertingQueryRunner(), []);\n  const data = useObservable(runner.get());\n  const queries2 = useMemo(() => alertRuleToQueries(rule), [rule]);\n  const [queries, setQueries] = useState<AlertQuery[]>([]);\n\n  const onRunQueries = useCallback(() => {\n    if (queries.length > 0) {\n      runner.run(queries);\n    }\n  }, [queries, runner]);\n\n  useEffect(() => {\n    setQueries(queries2);\n  }, [queries2]);\n\n  useEffect(() => {\n    onRunQueries();\n  }, [onRunQueries]);\n\n  useEffect(() => {\n    return () => runner.destroy();\n  }, [runner]);\n\n  const onChangeQuery = useCallback((query: AlertQuery) => {\n    setQueries((queries) =>\n      queries.map((q) => {\n        if (q.refId === query.refId) {\n          return query;\n        }\n        return q;\n      })\n    );\n  }, []);\n\n  if (!sourceName) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title={errorTitle}>\n          <details className={styles.errorMessage}>{errorMessage}</details>\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  const rulesSource = getRulesSourceByName(sourceName);\n\n  if (loading) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <LoadingPlaceholder text=\"Loading rule...\" />\n      </RuleViewerLayout>\n    );\n  }\n\n  if (error || !rulesSource) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <Alert title={errorTitle}>\n          <details className={styles.errorMessage}>\n            {error?.message ?? errorMessage}\n            <br />\n            {!!error?.stack && error.stack}\n          </details>\n        </Alert>\n      </RuleViewerLayout>\n    );\n  }\n\n  if (!rule) {\n    return (\n      <RuleViewerLayout title={pageTitle}>\n        <span>Rule could not be found.</span>\n      </RuleViewerLayout>\n    );\n  }\n  const annotations = Object.entries(rule.annotations).filter(([_, value]) => !!value.trim());\n  return (\n    <RuleViewerLayout wrapInContent={false} title={pageTitle}>\n      <RuleViewerLayoutContent>\n        <div>\n          <h4>\n            <Icon name=\"bell\" size=\"lg\" /> {rule.name}\n          </h4>\n          <RuleState rule={rule} isCreating={false} isDeleting={false} />\n          <RuleDetailsActionButtons rule={rule} rulesSource={rulesSource} />\n        </div>\n        <div className={styles.details}>\n          <div className={styles.leftSide}>\n            {rule.promRule && (\n              <DetailsField label=\"Health\" horizontal={true}>\n                <RuleHealth rule={rule.promRule} />\n              </DetailsField>\n            )}\n            {!!rule.labels && !!Object.keys(rule.labels).length && (\n              <DetailsField label=\"Labels\" horizontal={true}>\n                <AlertLabels labels={rule.labels} />\n              </DetailsField>\n            )}\n            <RuleDetailsExpression rulesSource={rulesSource} rule={rule} annotations={annotations} />\n            <RuleDetailsAnnotations annotations={annotations} />\n          </div>\n          <div className={styles.rightSide}>\n            <RuleDetailsDataSources rule={rule} rulesSource={rulesSource} />\n            <DetailsField label=\"Namespace / Group\">{`${rule.namespace.name} / ${rule.group.name}`}</DetailsField>\n          </div>\n        </div>\n        <div>\n          <RuleDetailsMatchingInstances promRule={rule.promRule} />\n        </div>\n      </RuleViewerLayoutContent>\n      {data && Object.keys(data).length > 0 && (\n        <>\n          <div className={styles.queriesTitle}>\n            Query results <PanelChromeLoadingIndicator loading={isLoading(data)} onCancel={() => runner.cancel()} />\n          </div>\n          <RuleViewerLayoutContent padding={0}>\n            <div className={styles.queries}>\n              {queries.map((query) => {\n                return (\n                  <div key={query.refId} className={styles.query}>\n                    <RuleViewerVisualization\n                      query={query}\n                      data={data && data[query.refId]}\n                      onChangeQuery={onChangeQuery}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          </RuleViewerLayoutContent>\n        </>\n      )}\n    </RuleViewerLayout>\n  );\n}\n\nfunction isLoading(data: Record<string, PanelData>): boolean {\n  return !!Object.values(data).find((d) => d.state === LoadingState.Loading);\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    errorMessage: css`\n      white-space: pre-wrap;\n    `,\n    queries: css`\n      height: 100%;\n      width: 100%;\n    `,\n    queriesTitle: css`\n      padding: ${theme.spacing(2, 0.5)};\n      font-size: ${theme.typography.h5.fontSize};\n      font-weight: ${theme.typography.fontWeightBold};\n      font-family: ${theme.typography.h5.fontFamily};\n    `,\n    query: css`\n      border-bottom: 1px solid ${theme.colors.border.medium};\n      padding: ${theme.spacing(2)};\n    `,\n    details: css`\n      display: flex;\n      flex-direction: row;\n    `,\n    leftSide: css`\n      flex: 1;\n    `,\n    rightSide: css`\n      padding-left: 90px;\n      width: 300px;\n    `,\n  };\n};\n\nexport default withErrorBoundary(RuleViewer, { style: 'page' });\n","import { SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React, { useMemo } from 'react';\nimport { STAT, TABLE, TIMESERIES } from '../utils/constants';\n\nexport type SupportedPanelPlugins = 'timeseries' | 'table' | 'stat';\n\ntype Props = {\n  value: SupportedPanelPlugins;\n  onChange: (value: SupportedPanelPlugins) => void;\n  size?: 'sm' | 'md';\n};\n\nexport function PanelPluginsButtonGroup(props: Props): JSX.Element | null {\n  const { value, onChange, size = 'md' } = props;\n  const panels = useMemo(() => getSupportedPanels(), []);\n\n  return <RadioButtonGroup options={panels} value={value} onChange={onChange} size={size} />;\n}\n\nfunction getSupportedPanels(): Array<SelectableValue<SupportedPanelPlugins>> {\n  return Object.values(config.panels).reduce((panels: Array<SelectableValue<SupportedPanelPlugins>>, panel) => {\n    if (isSupportedPanelPlugin(panel.id)) {\n      panels.push({\n        value: panel.id,\n        label: panel.name,\n        imgUrl: panel.info.logos.small,\n      });\n    }\n    return panels;\n  }, []);\n}\n\nfunction isSupportedPanelPlugin(id: string): id is SupportedPanelPlugins {\n  switch (id) {\n    case TIMESERIES:\n    case TABLE:\n    case STAT:\n      return true;\n    default:\n      return false;\n  }\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { PageToolbar, useStyles2 } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\n\ntype Props = {\n  children: React.ReactNode | React.ReactNode[];\n  title: string;\n  wrapInContent?: boolean;\n};\n\nexport function RuleViewerLayout(props: Props): JSX.Element | null {\n  const { wrapInContent = true, children, title } = props;\n  const styles = useStyles2(getPageStyles);\n\n  return (\n    <Page>\n      <PageToolbar title={title} pageIcon=\"bell\" onGoBack={() => locationService.push('/alerting/list')} />\n      <div className={styles.content}>{wrapInContent ? <RuleViewerLayoutContent {...props} /> : children}</div>\n    </Page>\n  );\n}\n\ntype ContentProps = {\n  children: React.ReactNode | React.ReactNode[];\n  padding?: number;\n};\n\nexport function RuleViewerLayoutContent({ children, padding = 2 }: ContentProps): JSX.Element | null {\n  const styles = useStyles2(getContentStyles(padding));\n  return <div className={styles.wrapper}>{children}</div>;\n}\n\nconst getPageStyles = (theme: GrafanaTheme2) => {\n  return {\n    content: css`\n      margin: ${theme.spacing(0, 2, 2)};\n      max-width: ${theme.breakpoints.values.xxl}px;\n    `,\n  };\n};\n\nconst getContentStyles = (padding: number) => (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      background: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.weak};\n      border-radius: ${theme.shape.borderRadius()};\n      padding: ${theme.spacing(padding)};\n    `,\n  };\n};\n","import { useEffect, useMemo } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { CombinedRule, RuleIdentifier, RuleNamespace } from 'app/types/unified-alerting';\nimport { AsyncRequestMapSlice, AsyncRequestState, initialAsyncRequestState } from '../utils/redux';\nimport { useCombinedRuleNamespaces } from './useCombinedRuleNamespaces';\nimport { useUnifiedAlertingSelector } from './useUnifiedAlertingSelector';\nimport { fetchPromRulesAction, fetchRulerRulesAction } from '../state/actions';\nimport { RulerRulesConfigDTO } from 'app/types/unified-alerting-dto';\nimport * as ruleId from '../utils/rule-id';\nimport { isRulerNotSupportedResponse } from '../utils/rules';\n\nexport function useCombinedRule(\n  identifier: RuleIdentifier | undefined,\n  ruleSourceName: string | undefined\n): AsyncRequestState<CombinedRule> {\n  const requestState = useCombinedRulesLoader(ruleSourceName);\n  const combinedRules = useCombinedRuleNamespaces(ruleSourceName);\n\n  const rule = useMemo(() => {\n    if (!identifier || !ruleSourceName || combinedRules.length === 0) {\n      return;\n    }\n\n    for (const namespace of combinedRules) {\n      for (const group of namespace.groups) {\n        for (const rule of group.rules) {\n          const id = ruleId.fromCombinedRule(ruleSourceName, rule);\n\n          if (ruleId.equal(id, identifier)) {\n            return rule;\n          }\n        }\n      }\n    }\n\n    return;\n  }, [identifier, ruleSourceName, combinedRules]);\n\n  return {\n    ...requestState,\n    result: rule,\n  };\n}\n\nexport function useCombinedRulesMatching(\n  ruleName: string | undefined,\n  ruleSourceName: string | undefined\n): AsyncRequestState<CombinedRule[]> {\n  const requestState = useCombinedRulesLoader(ruleSourceName);\n  const combinedRules = useCombinedRuleNamespaces(ruleSourceName);\n\n  const rules = useMemo(() => {\n    if (!ruleName || !ruleSourceName || combinedRules.length === 0) {\n      return [];\n    }\n\n    const rules: CombinedRule[] = [];\n\n    for (const namespace of combinedRules) {\n      for (const group of namespace.groups) {\n        for (const rule of group.rules) {\n          if (rule.name === ruleName) {\n            rules.push(rule);\n          }\n        }\n      }\n    }\n\n    return rules;\n  }, [ruleName, ruleSourceName, combinedRules]);\n\n  return {\n    ...requestState,\n    result: rules,\n  };\n}\n\nfunction useCombinedRulesLoader(rulesSourceName: string | undefined): AsyncRequestState<void> {\n  const dispatch = useDispatch();\n  const promRuleRequests = useUnifiedAlertingSelector((state) => state.promRules);\n  const promRuleRequest = getRequestState(rulesSourceName, promRuleRequests);\n  const rulerRuleRequests = useUnifiedAlertingSelector((state) => state.rulerRules);\n  const rulerRuleRequest = getRequestState(rulesSourceName, rulerRuleRequests);\n\n  useEffect(() => {\n    if (!rulesSourceName) {\n      return;\n    }\n\n    dispatch(fetchPromRulesAction({ rulesSourceName }));\n    dispatch(fetchRulerRulesAction({ rulesSourceName }));\n  }, [dispatch, rulesSourceName]);\n\n  return {\n    loading: promRuleRequest.loading || rulerRuleRequest.loading,\n    error: promRuleRequest.error ?? isRulerNotSupportedResponse(rulerRuleRequest) ? undefined : rulerRuleRequest.error,\n    dispatched: promRuleRequest.dispatched && rulerRuleRequest.dispatched,\n  };\n}\n\nfunction getRequestState(\n  ruleSourceName: string | undefined,\n  slice: AsyncRequestMapSlice<RulerRulesConfigDTO | RuleNamespace[] | null>\n): AsyncRequestState<RulerRulesConfigDTO | RuleNamespace[] | null> {\n  if (!ruleSourceName) {\n    return initialAsyncRequestState;\n  }\n\n  const state = slice[ruleSourceName];\n\n  if (!state) {\n    return initialAsyncRequestState;\n  }\n\n  return state;\n}\n","import { RelativeTimeRange } from '@grafana/data';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { ExpressionQuery, ExpressionQueryType } from '../../../expressions/types';\n\nconst FALL_BACK_TIME_RANGE = { from: 21600, to: 0 };\n\nexport const getTimeRangeForExpression = (query: ExpressionQuery, queries: AlertQuery[]): RelativeTimeRange => {\n  const referencedRefIds: string[] | undefined = getReferencedIds(query, queries);\n\n  if (!referencedRefIds) {\n    return FALL_BACK_TIME_RANGE;\n  }\n\n  const { from, to } = getTimeRanges(referencedRefIds, queries);\n\n  if (!from.length && !to.length) {\n    return FALL_BACK_TIME_RANGE;\n  }\n\n  return {\n    from: Math.max(...from),\n    to: Math.min(...to),\n  };\n};\n\nconst getReferencedIds = (model: ExpressionQuery, queries: AlertQuery[]): string[] | undefined => {\n  switch (model.type) {\n    case ExpressionQueryType.classic:\n      return getReferencedIdsForClassicCondition(model);\n    case ExpressionQueryType.math:\n      return getReferencedIdsForMath(model, queries);\n    case ExpressionQueryType.resample:\n    case ExpressionQueryType.reduce:\n      return getReferencedIdsForReduce(model);\n  }\n};\n\nconst getReferencedIdsForClassicCondition = (model: ExpressionQuery) => {\n  return model.conditions?.map((condition) => {\n    return condition.query.params[0];\n  });\n};\n\nconst getTimeRanges = (referencedRefIds: string[], queries: AlertQuery[]) => {\n  let from: number[] = [];\n  let to = [FALL_BACK_TIME_RANGE.to];\n  for (const referencedRefIdsKey of referencedRefIds) {\n    const query = queries.find((query) => query.refId === referencedRefIdsKey);\n\n    if (!query || !query.relativeTimeRange) {\n      continue;\n    }\n    from.push(query.relativeTimeRange.from);\n    to.push(query.relativeTimeRange.to);\n  }\n\n  return {\n    from,\n    to,\n  };\n};\n\nconst getReferencedIdsForMath = (model: ExpressionQuery, queries: AlertQuery[]) => {\n  return (\n    queries\n      // filter queries of type query and filter expression on if it includes any refIds\n      .filter((q) => q.queryType === 'query' && model.expression?.includes(q.refId))\n      .map((q) => {\n        return q.refId;\n      })\n  );\n};\n\nconst getReferencedIdsForReduce = (model: ExpressionQuery) => {\n  return model.expression ? [model.expression] : undefined;\n};\n","import { Observable, of, OperatorFunction, ReplaySubject, Unsubscribable } from 'rxjs';\nimport { catchError, map, share } from 'rxjs/operators';\nimport { v4 as uuidv4 } from 'uuid';\nimport {\n  dataFrameFromJSON,\n  DataFrameJSON,\n  getDefaultTimeRange,\n  LoadingState,\n  PanelData,\n  rangeUtil,\n  TimeRange,\n  withLoadingIndicator,\n} from '@grafana/data';\nimport { FetchResponse, getDataSourceSrv, toDataQueryError } from '@grafana/runtime';\nimport { BackendSrv, getBackendSrv } from 'app/core/services/backend_srv';\nimport { preProcessPanelData } from 'app/features/query/state/runRequest';\nimport { AlertQuery } from 'app/types/unified-alerting-dto';\nimport { getTimeRangeForExpression } from '../utils/timeRange';\nimport { isExpressionQuery } from 'app/features/expressions/guards';\nimport { setStructureRevision } from 'app/features/query/state/processing/revision';\nimport { cancelNetworkRequestsOnUnsubscribe } from 'app/features/query/state/processing/canceler';\n\nexport interface AlertingQueryResult {\n  frames: DataFrameJSON[];\n}\n\nexport interface AlertingQueryResponse {\n  results: Record<string, AlertingQueryResult>;\n}\nexport class AlertingQueryRunner {\n  private subject: ReplaySubject<Record<string, PanelData>>;\n  private subscription?: Unsubscribable;\n  private lastResult: Record<string, PanelData>;\n\n  constructor(private backendSrv = getBackendSrv(), private dataSourceSrv = getDataSourceSrv()) {\n    this.subject = new ReplaySubject(1);\n    this.lastResult = {};\n  }\n\n  get(): Observable<Record<string, PanelData>> {\n    return this.subject.asObservable();\n  }\n\n  async run(queries: AlertQuery[]) {\n    if (queries.length === 0) {\n      const empty = initialState(queries, LoadingState.Done);\n      return this.subject.next(empty);\n    }\n\n    // do not execute if one more of the queries are not runnable,\n    // for example not completely configured\n    for (const query of queries) {\n      if (!isExpressionQuery(query.model)) {\n        const ds = await this.dataSourceSrv.get(query.datasourceUid);\n        if (ds.filterQuery && !ds.filterQuery(query.model)) {\n          const empty = initialState(queries, LoadingState.Done);\n          return this.subject.next(empty);\n        }\n      }\n    }\n\n    this.subscription = runRequest(this.backendSrv, queries).subscribe({\n      next: (dataPerQuery) => {\n        const nextResult = applyChange(dataPerQuery, (refId, data) => {\n          const previous = this.lastResult[refId];\n          const preProcessed = preProcessPanelData(data, previous);\n          return setStructureRevision(preProcessed, previous);\n        });\n\n        this.lastResult = nextResult;\n        this.subject.next(this.lastResult);\n      },\n\n      error: (error: Error) => {\n        this.lastResult = mapErrorToPanelData(this.lastResult, error);\n        this.subject.next(this.lastResult);\n      },\n    });\n  }\n\n  cancel() {\n    if (!this.subscription) {\n      return;\n    }\n    this.subscription.unsubscribe();\n\n    let requestIsRunning = false;\n\n    const nextResult = applyChange(this.lastResult, (refId, data) => {\n      if (data.state === LoadingState.Loading) {\n        requestIsRunning = true;\n      }\n\n      return {\n        ...data,\n        state: LoadingState.Done,\n      };\n    });\n\n    if (requestIsRunning) {\n      this.subject.next(nextResult);\n    }\n  }\n\n  destroy() {\n    if (this.subject) {\n      this.subject.complete();\n    }\n\n    this.cancel();\n  }\n}\n\nconst runRequest = (backendSrv: BackendSrv, queries: AlertQuery[]): Observable<Record<string, PanelData>> => {\n  const initial = initialState(queries, LoadingState.Loading);\n  const request = {\n    data: { data: queries },\n    url: '/api/v1/eval',\n    method: 'POST',\n    requestId: uuidv4(),\n  };\n\n  return withLoadingIndicator({\n    whileLoading: initial,\n    source: backendSrv.fetch<AlertingQueryResponse>(request).pipe(\n      mapToPanelData(initial),\n      catchError((error) => of(mapErrorToPanelData(initial, error))),\n      cancelNetworkRequestsOnUnsubscribe(backendSrv, request.requestId),\n      share()\n    ),\n  });\n};\n\nconst initialState = (queries: AlertQuery[], state: LoadingState): Record<string, PanelData> => {\n  return queries.reduce((dataByQuery: Record<string, PanelData>, query) => {\n    dataByQuery[query.refId] = {\n      state,\n      series: [],\n      timeRange: getTimeRange(query, queries),\n    };\n\n    return dataByQuery;\n  }, {});\n};\n\nconst getTimeRange = (query: AlertQuery, queries: AlertQuery[]): TimeRange => {\n  if (isExpressionQuery(query.model)) {\n    const relative = getTimeRangeForExpression(query.model, queries);\n    return rangeUtil.relativeToTimeRange(relative);\n  }\n\n  if (!query.relativeTimeRange) {\n    console.warn(`Query with refId: ${query.refId} did not have any relative time range, using default.`);\n    return getDefaultTimeRange();\n  }\n\n  return rangeUtil.relativeToTimeRange(query.relativeTimeRange);\n};\n\nconst mapToPanelData = (\n  dataByQuery: Record<string, PanelData>\n): OperatorFunction<FetchResponse<AlertingQueryResponse>, Record<string, PanelData>> => {\n  return map((response) => {\n    const { data } = response;\n    const results: Record<string, PanelData> = {};\n\n    for (const [refId, result] of Object.entries(data.results)) {\n      results[refId] = {\n        timeRange: dataByQuery[refId].timeRange,\n        state: LoadingState.Done,\n        series: result.frames.map(dataFrameFromJSON),\n      };\n    }\n\n    return results;\n  });\n};\n\nconst mapErrorToPanelData = (lastResult: Record<string, PanelData>, error: Error): Record<string, PanelData> => {\n  const queryError = toDataQueryError(error);\n\n  return applyChange(lastResult, (refId, data) => {\n    return {\n      ...data,\n      state: LoadingState.Error,\n      error: queryError,\n    };\n  });\n};\n\nconst applyChange = (\n  initial: Record<string, PanelData>,\n  change: (refId: string, data: PanelData) => PanelData\n): Record<string, PanelData> => {\n  const nextResult: Record<string, PanelData> = {};\n\n  for (const [refId, data] of Object.entries(initial)) {\n    nextResult[refId] = change(refId, data);\n  }\n\n  return nextResult;\n};\n","import { DataQuery } from '@grafana/data';\nimport { isExpressionReference } from '@grafana/runtime/src/utils/DataSourceWithBackend';\nimport { ExpressionQuery, ExpressionQueryType } from './types';\n\nexport const isExpressionQuery = (dataQuery?: DataQuery): dataQuery is ExpressionQuery => {\n  if (!dataQuery) {\n    return false;\n  }\n\n  if (isExpressionReference(dataQuery.datasource)) {\n    return true;\n  }\n\n  const expression = dataQuery as ExpressionQuery;\n\n  if (typeof expression.type !== 'string') {\n    return false;\n  }\n  return Object.values(ExpressionQueryType).includes(expression.type);\n};\n","import { useEffect, useLayoutEffect } from 'react';\nimport { isBrowser } from './misc/util';\nvar useIsomorphicLayoutEffect = isBrowser ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n","import { useState } from 'react';\nimport useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';\nfunction useObservable(observable$, initialValue) {\n    var _a = useState(initialValue), value = _a[0], update = _a[1];\n    useIsomorphicLayoutEffect(function () {\n        var s = observable$.subscribe(update);\n        return function () { return s.unsubscribe(); };\n    }, [observable$]);\n    return value;\n}\nexport default useObservable;\n"],"names":["alertRuleToQueries","combinedRule","namespace","rulerRule","rulesSource","isGrafanaRulesSource","isGrafanaRulerRule","grafana_alert","data","isCloudRulesSource","model","dsSettings","rule","refId","type","expr","query","Error","cloudAlertRuleToModel","datasourceUid","uid","queryType","relativeTimeRange","from","to","RuleViewerVisualization","props","theme","useTheme2","styles","useStyles2","getStyles","onChangeQuery","defaultPanel","isExpressionQuery","TABLE","TIMESERIES","panel","setPanel","useState","getDataSourceSrv","getInstanceSettings","options","setOptions","frameIndex","showHeader","onTimeChange","useCallback","newDateTime","now","dateTime","unix","interval","setDateTime","relativeTimeRangeTo","subtract","className","content","width","height","style","header","dataSource","name","actions","DateTimePicker","date","onChange","maxDate","Date","PanelPluginsButtonGroup","value","size","spacing","LinkButton","variant","icon","target","href","createExploreLink","PanelRenderer","gridSize","pluginId","title","onOptionsChange","Alert","CodeEditor","language","showLineNumbers","showMiniMap","JSON","stringify","readOnly","settings","rest","queryParams","datasource","urlUtil","config","left","css","typography","fontWeightMedium","colors","text","link","secondary","errorMessage","errorTitle","pageTitle","RuleViewer","match","id","sourceName","params","identifier","ruleId","loading","error","result","useCombinedRule","runner","useMemo","AlertingQueryRunner","useObservable","get","queries2","queries","setQueries","onRunQueries","length","run","useEffect","destroy","map","q","RuleViewerLayout","getRulesSourceByName","LoadingPlaceholder","message","stack","annotations","Object","entries","filter","_","trim","wrapInContent","Icon","RuleState","isCreating","isDeleting","RuleDetailsActionButtons","details","leftSide","promRule","DetailsField","label","horizontal","RuleHealth","labels","keys","AlertLabels","RuleDetailsExpression","RuleDetailsAnnotations","rightSide","RuleDetailsDataSources","group","RuleDetailsMatchingInstances","queriesTitle","PanelChromeLoadingIndicator","isLoading","onCancel","cancel","padding","values","find","d","state","LoadingState","h5","fontSize","fontWeightBold","fontFamily","border","medium","withErrorBoundary","panels","reduce","STAT","isSupportedPanelPlugin","push","imgUrl","info","logos","small","RadioButtonGroup","children","getPageStyles","PageToolbar","pageIcon","onGoBack","locationService","RuleViewerLayoutContent","getContentStyles","wrapper","breakpoints","xxl","background","primary","weak","shape","borderRadius","ruleSourceName","requestState","useCombinedRulesLoader","combinedRules","useCombinedRuleNamespaces","groups","rules","useCombinedRulesMatching","ruleName","rulesSourceName","dispatch","useDispatch","promRuleRequests","useUnifiedAlertingSelector","promRules","promRuleRequest","getRequestState","rulerRuleRequests","rulerRules","rulerRuleRequest","fetchPromRulesAction","fetchRulerRulesAction","isRulerNotSupportedResponse","undefined","dispatched","slice","initialAsyncRequestState","FALL_BACK_TIME_RANGE","getReferencedIds","ExpressionQueryType","getReferencedIdsForClassicCondition","getReferencedIdsForMath","getReferencedIdsForReduce","conditions","condition","getTimeRanges","referencedRefIds","referencedRefIdsKey","expression","includes","constructor","backendSrv","getBackendSrv","dataSourceSrv","this","subject","ReplaySubject","lastResult","asObservable","empty","initialState","next","ds","filterQuery","subscription","runRequest","subscribe","dataPerQuery","nextResult","applyChange","previous","preProcessed","preProcessPanelData","setStructureRevision","mapErrorToPanelData","unsubscribe","requestIsRunning","complete","initial","request","url","method","requestId","uuidv4","withLoadingIndicator","whileLoading","source","fetch","pipe","mapToPanelData","catchError","of","cancelNetworkRequestsOnUnsubscribe","share","dataByQuery","series","timeRange","getTimeRange","relative","Math","max","min","getTimeRangeForExpression","rangeUtil","console","warn","getDefaultTimeRange","response","results","frames","dataFrameFromJSON","queryError","toDataQueryError","change","dataQuery","isExpressionReference","useLayoutEffect","observable$","initialValue","_a","update","s"],"sourceRoot":""}