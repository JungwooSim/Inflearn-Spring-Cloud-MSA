"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7494],{"./public/app/plugins/datasource/graphite/module.ts":(e,t,a)=>{a.r(t),a.d(t,{plugin:()=>It});var n=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),r=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/of.js"),s=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/lastValueFrom.js"),i=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/observable/throwError.js"),o=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/util/pipe.js"),l=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/map.js"),c=a("../../opt/drone/yarncache/rxjs-npm-7.3.0-8a14d1c3d9-e63adb8808.zip/node_modules/rxjs/dist/esm5/internal/operators/catchError.js"),m=a("./packages/grafana-runtime/src/index.ts"),u=a("./packages/grafana-data/src/index.ts");function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const p=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/;class g{constructor(e){d(this,"major",void 0),d(this,"minor",void 0),d(this,"patch",void 0),d(this,"meta",void 0),this.major=0,this.minor=0,this.patch=0,this.meta="";const t=p.exec(e);t&&(this.major=Number(t[1]),this.minor=Number(t[2]||0),this.patch=Number(t[3]||0),this.meta=t[4])}isGtOrEq(e){const t=new g(e);for(let e=0;e<this.comparable.length;++e){if(this.comparable[e]>t.comparable[e])return!0;if(this.comparable[e]<t.comparable[e])return!1}return!0}isValid(){return(0,n.isNumber)(this.major)}get comparable(){return[this.major,this.minor,this.patch]}}function h(e,t){return new g(e).isGtOrEq(t)}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const y={};function v(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],y[e.name]=e,e.shortName&&(y[e.shortName]=e)}const x=[{name:"other",type:"value_or_series",optional:!0,multiple:!0}];function b(e,t){return!e.version||h(t,e.version)}v({name:"scaleToSeconds",category:"Transform",params:[{name:"seconds",type:"int"}],defaultParams:[1]}),v({name:"perSecond",category:"Transform",params:[{name:"max value",type:"int",optional:!0}],defaultParams:[]}),v({name:"holtWintersForecast",category:"Calculate"}),v({name:"holtWintersConfidenceBands",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),v({name:"holtWintersAberration",category:"Calculate",params:[{name:"delta",type:"int"}],defaultParams:[3]}),v({name:"nPercentile",category:"Calculate",params:[{name:"Nth percentile",type:"int"}],defaultParams:[95]}),v({name:"diffSeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"stddevSeries",params:x,defaultParams:[""],category:"Combine"}),v({name:"divideSeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"multiplySeries",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"asPercent",params:x,defaultParams:["#A"],category:"Combine"}),v({name:"group",params:x,defaultParams:["#A","#B"],category:"Combine"}),v({name:"sumSeries",shortName:"sum",category:"Combine",params:x,defaultParams:[""]}),v({name:"averageSeries",shortName:"avg",category:"Combine",params:x,defaultParams:[""]}),v({name:"rangeOfSeries",category:"Combine"}),v({name:"percentileOfSeries",category:"Combine",params:[{name:"n",type:"int"},{name:"interpolate",type:"boolean",options:["true","false"]}],defaultParams:[95,"false"]}),v({name:"sumSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),v({name:"maxSeries",shortName:"max",category:"Combine"}),v({name:"minSeries",shortName:"min",category:"Combine"}),v({name:"averageSeriesWithWildcards",category:"Combine",params:[{name:"node",type:"int",multiple:!0}],defaultParams:[3]}),v({name:"alias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:["alias"]}),v({name:"aliasSub",category:"Alias",params:[{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:["","\\1"]}),v({name:"consolidateBy",category:"Special",params:[{name:"function",type:"string",options:["sum","average","min","max"]}],defaultParams:["max"]}),v({name:"cumulative",category:"Special",params:[],defaultParams:[]}),v({name:"groupByNode",category:"Combine",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]},{name:"function",type:"string",options:["sum","avg","maxSeries"]}],defaultParams:[3,"sum"]}),v({name:"aliasByNode",category:"Alias",params:[{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[3]}),v({name:"substr",category:"Special",params:[{name:"start",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]},{name:"stop",type:"int",options:[-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:[0,0]}),v({name:"sortByName",category:"Sorting",params:[{name:"natural",type:"boolean",options:["true","false"],optional:!0}],defaultParams:["false"]}),v({name:"sortByMaxima",category:"Sorting"}),v({name:"sortByMinima",category:"Sorting"}),v({name:"sortByTotal",category:"Sorting"}),v({name:"aliasByMetric",category:"Alias"}),v({name:"randomWalk",fake:!0,category:"Special",params:[{name:"name",type:"string"}],defaultParams:["randomWalk"]}),v({name:"countSeries",category:"Combine"}),v({name:"constantLine",category:"Special",params:[{name:"value",type:"int"}],defaultParams:[10]}),v({name:"cactiStyle",category:"Special"}),v({name:"keepLastValue",category:"Transform",params:[{name:"n",type:"int"}],defaultParams:[100]}),v({name:"changed",category:"Special",params:[],defaultParams:[]}),v({name:"scale",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[1]}),v({name:"offset",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[10]}),v({name:"transformNull",category:"Transform",params:[{name:"amount",type:"int"}],defaultParams:[0]}),v({name:"integral",category:"Transform"}),v({name:"derivative",category:"Transform"}),v({name:"nonNegativeDerivative",category:"Transform",params:[{name:"max value or 0",type:"int",optional:!0}],defaultParams:[""]}),v({name:"timeShift",category:"Transform",params:[{name:"amount",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"]}),v({name:"timeStack",category:"Transform",params:[{name:"timeShiftUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]},{name:"timeShiftStart",type:"int"},{name:"timeShiftEnd",type:"int"}],defaultParams:["1d",0,7]}),v({name:"summarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]},{name:"alignToFrom",type:"boolean",optional:!0,options:["false","true"]}],defaultParams:["1h","sum","false"]}),v({name:"smartSummarize",category:"Transform",params:[{name:"interval",type:"string"},{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["1h","sum"]}),v({name:"absolute",category:"Transform"}),v({name:"hitcount",category:"Transform",params:[{name:"interval",type:"string"}],defaultParams:["10s"]}),v({name:"log",category:"Transform",params:[{name:"base",type:"int"}],defaultParams:["10"]}),v({name:"averageAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"averageBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"currentAbove",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"currentBelow",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[25]}),v({name:"maximumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"maximumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"minimumAbove",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"minimumBelow",category:"Filter Series",params:[{name:"value",type:"int"}],defaultParams:[0]}),v({name:"limit",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"mostDeviant",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[10]}),v({name:"exclude",category:"Filter Series",params:[{name:"exclude",type:"string"}],defaultParams:["exclude"]}),v({name:"highestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"highestMax",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"lowestCurrent",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"movingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10]}),v({name:"movingMedian",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:["5"]}),v({name:"stdev",category:"Calculate",params:[{name:"n",type:"int"},{name:"tolerance",type:"int"}],defaultParams:[5,.1]}),v({name:"highestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"lowestAverage",category:"Filter Series",params:[{name:"count",type:"int"}],defaultParams:[5]}),v({name:"removeAbovePercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeAboveValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeBelowPercentile",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"removeBelowValue",category:"Filter Data",params:[{name:"n",type:"int"}],defaultParams:[5]}),v({name:"useSeriesAbove",category:"Filter Series",params:[{name:"value",type:"int"},{name:"search",type:"string"},{name:"replace",type:"string"}],defaultParams:[0,"search","replace"]}),v({name:"aggregateLine",category:"Calculate",params:[{name:"func",type:"select",options:["sum","avg","min","max","last"]}],defaultParams:["avg"],version:"1.0"}),v({name:"averageOutsidePercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),v({name:"delay",category:"Transform",params:[{name:"steps",type:"int"}],defaultParams:[1],version:"1.0"}),v({name:"exponentialMovingAverage",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"fallbackSeries",category:"Special",params:[{name:"fallback",type:"string"}],defaultParams:["constantLine(0)"],version:"1.0"}),v({name:"grep",category:"Filter Series",params:[{name:"grep",type:"string"}],defaultParams:["grep"],version:"1.0"}),v({name:"groupByNodes",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:["sum",3],version:"1.0"}),v({name:"integralByInterval",category:"Transform",params:[{name:"intervalUnit",type:"select",options:["1h","6h","12h","1d","2d","7d","14d","30d"]}],defaultParams:["1d"],version:"1.0"}),v({name:"interpolate",category:"Transform",params:[{name:"limit",type:"int",optional:!0}],defaultParams:[],version:"1.0"}),v({name:"invert",category:"Transform",version:"1.0"}),v({name:"isNonNull",category:"Combine",version:"1.0"}),v({name:"linearRegression",category:"Calculate",params:[{name:"startSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0},{name:"endSourceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:[],version:"1.0"}),v({name:"mapSeries",shortName:"map",params:[{name:"node",type:"int"}],defaultParams:[3],category:"Combine",version:"1.0"}),v({name:"movingMin",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"movingMax",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"movingSum",category:"Calculate",params:[{name:"windowSize",type:"int_or_interval",options:["5","7","10","5min","10min","30min","1hour"]}],defaultParams:[10],version:"1.0"}),v({name:"multiplySeriesWithWildcards",category:"Combine",params:[{name:"position",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12],multiple:!0}],defaultParams:[2],version:"1.0"}),v({name:"offsetToZero",category:"Transform",version:"1.0"}),v({name:"pow",category:"Transform",params:[{name:"factor",type:"int"}],defaultParams:[10],version:"1.0"}),v({name:"powSeries",category:"Transform",params:x,defaultParams:[""],version:"1.0"}),v({name:"reduceSeries",shortName:"reduce",params:[{name:"function",type:"string",options:["asPercent","diffSeries","divideSeries"]},{name:"reduceNode",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,11,12,13]},{name:"reduceMatchers",type:"string",multiple:!0}],defaultParams:["asPercent",2,"used_bytes"],category:"Combine",version:"1.0"}),v({name:"removeBetweenPercentile",category:"Filter Series",params:[{name:"n",type:"int"}],defaultParams:[95],version:"1.0"}),v({name:"removeEmptySeries",category:"Filter Series",version:"1.0"}),v({name:"squareRoot",category:"Transform",version:"1.0"}),v({name:"timeSlice",category:"Transform",params:[{name:"startSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"]},{name:"endSliceAt",type:"select",options:["-1h","-6h","-12h","-1d","-2d","-7d","-14d","-30d"],optional:!0}],defaultParams:["-1h"],version:"1.0"}),v({name:"weightedAverage",category:"Combine",params:[{name:"other",type:"value_or_series",optional:!0},{name:"node",type:"int",options:[0,1,2,3,4,5,6,7,8,9,10,12]}],defaultParams:["#A",4],version:"1.0"}),v({name:"seriesByTag",category:"Special",params:[{name:"tagExpression",type:"string",multiple:!0}],version:"1.1"}),v({name:"groupByTags",category:"Combine",params:[{name:"function",type:"string",options:["sum","avg","maxSeries"]},{name:"tag",type:"string",multiple:!0}],defaultParams:["sum","tag"],version:"1.1"}),v({name:"aliasByTags",category:"Alias",params:[{name:"tag",type:"string",multiple:!0}],defaultParams:["tag"],version:"1.1"});class j{constructor(e,t){f(this,"def",void 0),f(this,"params",void 0),f(this,"text",void 0),f(this,"hidden",void 0),this.def=e,this.params=[],t&&t.withDefaultParams&&e.defaultParams&&(this.params=e.defaultParams.slice(0)),this.updateText()}render(e,t){const a=this.def.name+"(",r=(0,n.map)(this.params,((e,a)=>{let r;if(a<this.def.params.length?r=this.def.params[a].type:(0,n.get)((0,n.last)(this.def.params),"multiple")&&(r=(0,n.get)((0,n.last)(this.def.params),"type")),(0,n.includes)(["value_or_series","boolean","int","float","node","int_or_infinity"],r))return e;const s=(0,n.isString)(e)?t(e):e;return(0,n.includes)(["int_or_interval","node_or_tag"],r)&&(0,n.isFinite)(+s)?(0,n.toString)(e):"'"+e+"'"}));for(;""===r[r.length-1];)r.pop();return e&&r.unshift(e),a+r.join(", ")+")"}_hasMultipleParamsInString(e,t){return-1!==e.indexOf(",")&&(!(!this.def.params[t+1]||!this.def.params[t+1].optional)||!!(t+1>=this.def.params.length&&(0,n.get)((0,n.last)(this.def.params),"multiple")))}updateParam(e,t){this._hasMultipleParamsInString(e,t)?(0,n.each)(e.split(","),((e,a)=>{this.updateParam(e.trim(),t+a)})):(""===e&&(t>=this.def.params.length||this.def.params[t].optional)?this.params.splice(t,1):this.params[t]=e,this.updateText())}updateText(){if(0===this.params.length)return void(this.text=this.def.name+"()");let e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}}function w(e,t){return(t||y)[e]?(t||y)[e]:{name:e,params:[{name:"",type:"",multiple:!0}],defaultParams:[""],unknown:!0}}const S={createFuncInstance:function(e,t,a){return(0,n.isString)(e)&&(e=w(e,a)),new j(e,t)},getFuncDef:w,getFuncDefs:function(e,t){const a={};return(0,n.forEach)(t||y,(t=>{b(t,e)&&(a[t.name]=(0,n.assign)({},t,{params:(0,n.filter)(t.params,(t=>b(t,e)))}))})),a},parseFuncDefs:function(e){const t={};return(0,n.forEach)(e||{},((e,a)=>{if("Graph"===e.group)return;let r=e.description;r&&(r=r.replace(/:py:func:`(.+)( <[^>]*>)?`/g,"``$1``").replace(/.. seealso:: /g,"See also: ").replace(/.. code-block *:: *none/g,".. code-block::"));const s={name:e.name,description:r,category:e.group,params:[],defaultParams:[],fake:!1};/^seriesLists?$/.test((0,n.get)(e,"params[0].type",""))?e.params[0].multiple?e.params[0].required=!1:e.params.shift():s.fake=!0,(0,n.forEach)(e.params,(e=>{const t={name:e.name,type:"string",optional:!e.required,multiple:!!e.multiple,options:void 0};void 0!==e.default?e.default===1/0?s.defaultParams.push("inf"):s.defaultParams.push((0,n.toString)(e.default)):e.suggestions?s.defaultParams.push((0,n.toString)(e.suggestions[0])):s.defaultParams.push(""),"boolean"===e.type?(t.type="boolean",t.options=["true","false"]):"integer"===e.type?t.type="int":"float"===e.type?t.type="float":"node"===e.type?(t.type="node",t.options=["0","1","2","3","4","5","6","7","8","9","10","11","12"]):"nodeOrTag"===e.type?(t.type="node_or_tag",t.options=["name","0","1","2","3","4","5","6","7","8","9","10","11","12"]):"intOrInterval"===e.type?t.type="int_or_interval":"seriesList"===e.type?t.type="value_or_series":"intOrInf"===e.type&&(t.type="int_or_infinity"),e.options?t.options=(0,n.map)(e.options,n.toString):e.suggestions&&(t.options=(0,n.map)(e.suggestions,n.toString)),s.params.push(t)})),t[a]=s})),t}};var P=a("./public/app/features/templating/template_srv.ts");let C;function T(e){if(e)return parseInt(e,10)}function q(e){if(e)return"true"===e||"false"!==e&&parseInt(e,10)}function k(e){for(const a of e){const e=a["archive-read"];if(e>0){var t;return{text:`Data is rolled up, aggregated over ${D(a["schema-retentions"])[e].interval} using ${(null!==(t=a["consolidator-normfetch"])&&void 0!==t?t:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function M(e){for(const a of e){const e=a["aggnum-rc"];if(e>0){var t;return{text:`Data is runtime consolidated, ${e} datapoints combined using ${(null!==(t=a["consolidator-rc"])&&void 0!==t?t:"").replace("Consolidator","")} function`,severity:"info",inspect:"meta"}}}return null}function D(e){return e?e.split(",").map((e=>{const t=e.split(":");return{interval:t[0],retention:t[1],chunkspan:t[2],numchunks:T(t[3]),ready:q(t[4])}})):[]}!function(e){e.Default="default",e.Metrictank="metrictank"}(C||(C={}));var F=a("./public/app/features/variables/utils.ts");const I=["0.9","1.0","1.1"],N=(0,n.last)(I);function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class A extends u.DataSourceApi{constructor(e,t=(0,P.J)()){var a,r;super(e),_(this,"basicAuth",void 0),_(this,"url",void 0),_(this,"name",void 0),_(this,"graphiteVersion",void 0),_(this,"supportsTags",void 0),_(this,"isMetricTank",void 0),_(this,"rollupIndicatorEnabled",void 0),_(this,"cacheTimeout",void 0),_(this,"withCredentials",void 0),_(this,"funcDefs",null),_(this,"funcDefsPromise",null),_(this,"_seriesRefLetters",void 0),_(this,"metricMappings",void 0),_(this,"convertResponseToDataFrames",(e=>{const t=[];if(!e||!e.data)return{data:t};const a=e.data.series||e.data;if(!(0,n.isArray)(a))throw{message:"Missing series in result",data:e};for(let n=0;n<a.length;n++){const r=a[n];r.title=r.target;for(let e=0;e<r.datapoints.length;e++)r.datapoints[e][1]*=1e3;const s=(0,u.toDataFrame)(r);if(r.meta){if(s.meta={custom:{requestMetaList:e.data.meta,seriesMetaList:r.meta}},this.rollupIndicatorEnabled){const e=k(r.meta),t=M(r.meta);e?s.meta.notices=[e]:t&&(s.meta.notices=[t])}0===n&&e.data.meta.stats&&(s.meta.stats=this.getRequestStats(e.data.meta))}t.push(s)}return{data:t}})),this.templateSrv=t,this.templateSrv=t,this.basicAuth=e.basicAuth,this.url=e.url,this.name=e.name,this.graphiteVersion=e.jsonData.graphiteVersion||N,this.metricMappings=(null===(a=e.jsonData.importConfiguration)||void 0===a||null===(r=a.loki)||void 0===r?void 0:r.mappings)||[],this.isMetricTank=e.jsonData.graphiteType===C.Metrictank,this.supportsTags=h(this.graphiteVersion,"1.1"),this.cacheTimeout=e.cacheTimeout,this.rollupIndicatorEnabled=e.jsonData.rollupIndicatorEnabled,this.withCredentials=e.withCredentials,this.funcDefs=null,this.funcDefsPromise=null,this._seriesRefLetters="ABCDEFGHIJKLMNOPQRSTUVWXYZ"}getQueryOptionsInfo(){return{maxDataPoints:!0,cacheTimeout:!0,links:[{text:"Help",url:"http://docs.grafana.org/features/datasources/graphite/#using-graphite-in-grafana"}]}}getImportQueryConfiguration(){return{loki:{mappings:this.metricMappings}}}query(e){const t={from:this.translateTime(e.range.raw.from,!1,e.timezone),until:this.translateTime(e.range.raw.to,!0,e.timezone),targets:e.targets,format:e.format,cacheTimeout:e.cacheTimeout||this.cacheTimeout,maxDataPoints:e.maxDataPoints},a=this.buildGraphiteParams(t,e.scopedVars);if(0===a.length)return(0,r.of)({data:[]});this.isMetricTank&&a.push("meta=true");const n={method:"POST",url:"/render",data:a.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded"}};return this.addTracingHeaders(n,e),e.panelId&&(n.requestId=this.name+".panelId."+e.panelId),this.doGraphiteRequest(n).pipe((0,l.U)(this.convertResponseToDataFrames))}addTracingHeaders(e,t){!this.url.match(/^http/)&&(t.dashboardId&&(e.headers["X-Dashboard-Id"]=t.dashboardId),t.panelId&&(e.headers["X-Panel-Id"]=t.panelId))}getRequestStats(e){const t=[];for(const a in e.stats){let n;a.endsWith(".ms")&&(n="ms"),t.push({displayName:a,value:e.stats[a],unit:n})}return t}parseTags(e){let t=[];return t=e.split(","),1===t.length&&(t=e.split(" "),""===t[0]&&(t=[])),t}interpolateVariablesInQueries(e,t){let a=e;return e&&e.length>0&&(a=e.map((e=>{var a;return Object.assign({},e,{datasource:this.getRef(),target:this.templateSrv.replace(null!==(a=e.target)&&void 0!==a?a:"",t)})}))),a}annotationQuery(e){if(e.annotation.target){const t=this.templateSrv.replace(e.annotation.target,{},"glob"),a={range:e.range,targets:[{target:t}],format:"json",maxDataPoints:100};return(0,s.n)(this.query(a).pipe((0,l.U)((t=>{const a=[];for(let n=0;n<t.data.length;n++){const r=t.data[n];for(let t=0;t<r.length;t++){const n=r.fields[0].values.get(t);r.fields[1].values.get(t)&&a.push({annotation:e.annotation,time:n,title:r.name})}}return a}))))}{const t=this.templateSrv.replace(e.annotation.tags);return this.events({range:e.range,tags:t}).then((t=>{const a=[];if(!(0,n.isArray)(t.data))return console.error(`Unable to get annotations from ${t.url}.`),[];for(let r=0;r<t.data.length;r++){const s=t.data[r];let i=s.tags;(0,n.isString)(s.tags)&&(i=this.parseTags(s.tags)),a.push({annotation:e.annotation,time:1e3*s.when,title:s.what,tags:i,text:s.data})}return a}))}}events(e){try{let t="";return e.tags&&(t="&tags="+e.tags),(0,s.n)(this.doGraphiteRequest({method:"GET",url:"/events/get_data?from="+this.translateTime(e.range.raw.from,!1,e.timezone)+"&until="+this.translateTime(e.range.raw.to,!0,e.timezone)+t}))}catch(e){return Promise.reject(e)}}targetContainsTemplate(e){var t;return this.templateSrv.variableExists(null!==(t=e.target)&&void 0!==t?t:"")}translateTime(e,t,a){if((0,n.isString)(e)){if("now"===e)return"now";if(e.indexOf("now-")>=0&&-1===e.indexOf("/"))return e=(e=(e=e.substring(3)).replace("m","min")).replace("M","mon");e=u.dateMath.parse(e,t,a)}return t?e.get("s")&&e.add(1,"s"):!1===t&&e.get("s")&&e.subtract(1,"s"),e.unix()}metricFindQuery(e,t){const a=t||{};let n=this.templateSrv.replace(e,(0,F._6)({query:e,wildcardChar:"",options:t})),r=n.match(/^tag_values\((.*)\)$/),s=r?r[1].split(",").filter((e=>!!e)):void 0;if(s)return a.limit=1e4,this.getTagValuesAutoComplete(s.slice(1),s[0],void 0,a);if(r=n.match(/^tags\((.*)\)$/),s=r?r[1].split(",").filter((e=>!!e)):void 0,s)return a.limit=1e4,this.getTagsAutoComplete(s,void 0,a);let i,o=e.match(/^expand\((.*)\)$/);return e=o?o[1]:e,n=this.templateSrv.replace(e,(0,F._6)({query:e,wildcardChar:"*",options:t})),a.range&&(i={from:this.translateTime(a.range.from,!1,a.timezone),until:this.translateTime(a.range.to,!0,a.timezone)}),o?this.requestMetricExpand(n,a.requestId,i):this.requestMetricFind(n,a.requestId,i)}requestMetricFind(e,t,a){const r={method:"POST",url:"/metrics/find",params:{},data:`query=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:t};return a&&(r.params.from=a.from,r.params.until=a.until),(0,s.n)(this.doGraphiteRequest(r).pipe((0,l.U)((e=>(0,n.map)(e.data,(e=>({text:e.text,expandable:!!e.expandable})))))))}requestMetricExpand(e,t,a){const r={method:"GET",url:"/metrics/expand",params:{query:e},headers:{"Content-Type":"application/x-www-form-urlencoded"},requestId:t};return a&&(r.params.from=a.from,r.params.until=a.until),(0,s.n)(this.doGraphiteRequest(r).pipe((0,l.U)((e=>(0,n.map)(e.data.results,(e=>({text:e,expandable:!1})))))))}getTags(e){const t=e||{},a={method:"GET",url:"/tags",requestId:t.requestId};return t.range&&(a.params.from=this.translateTime(t.range.from,!1,t.timezone),a.params.until=this.translateTime(t.range.to,!0,t.timezone)),(0,s.n)(this.doGraphiteRequest(a).pipe((0,l.U)((e=>(0,n.map)(e.data,(e=>({text:e.tag,id:e.id})))))))}getTagValues(e={}){const t={method:"GET",url:"/tags/"+this.templateSrv.replace(e.key),requestId:e.requestId};return e.range&&(t.params.from=this.translateTime(e.range.from,!1,e.timezone),t.params.until=this.translateTime(e.range.to,!0,e.timezone)),(0,s.n)(this.doGraphiteRequest(t).pipe((0,l.U)((e=>e.data&&e.data.values?(0,n.map)(e.data.values,(e=>({text:e.value,id:e.id}))):[]))))}getTagsAutoComplete(e,t,a){const r=a||{},i={method:"GET",url:"/tags/autoComplete/tags",params:{expr:(0,n.map)(e,(e=>this.templateSrv.replace((e||"").trim())))},requestId:r.requestId};return t&&(i.params.tagPrefix=t),r.limit&&(i.params.limit=r.limit),r.range&&(i.params.from=this.translateTime(r.range.from,!1,r.timezone),i.params.until=this.translateTime(r.range.to,!0,r.timezone)),(0,s.n)(this.doGraphiteRequest(i).pipe(O()))}getTagValuesAutoComplete(e,t,a,r){const i=r||{},o={method:"GET",url:"/tags/autoComplete/values",params:{expr:(0,n.map)(e,(e=>this.templateSrv.replace((e||"").trim()))),tag:this.templateSrv.replace((t||"").trim())},requestId:i.requestId};return a&&(o.params.valuePrefix=a),i.limit&&(o.params.limit=i.limit),i.range&&(o.params.from=this.translateTime(i.range.from,!1,i.timezone),o.params.until=this.translateTime(i.range.to,!0,i.timezone)),(0,s.n)(this.doGraphiteRequest(o).pipe(O()))}getVersion(e){const t={method:"GET",url:"/version",requestId:(e||{}).requestId};return(0,s.n)(this.doGraphiteRequest(t).pipe((0,l.U)((e=>{if(e.data){return new g(e.data).isValid()?e.data:""}return""})),(0,c.K)((()=>(0,r.of)("")))))}createFuncInstance(e,t){return S.createFuncInstance(e,t,this.funcDefs)}getFuncDef(e){return S.getFuncDef(e,this.funcDefs)}waitForFuncDefsLoaded(){return this.getFuncDefs()}getFuncDefs(){if(null!==this.funcDefsPromise)return this.funcDefsPromise;if(!h(this.graphiteVersion,"1.1"))return this.funcDefs=S.getFuncDefs(this.graphiteVersion),this.funcDefsPromise=Promise.resolve(this.funcDefs),this.funcDefsPromise;return(0,s.n)(this.doGraphiteRequest({method:"GET",url:"/functions"}).pipe((0,l.U)((e=>{if(200!==e.status||"object"!=typeof e.data)if("string"==typeof e.data){const t=JSON.parse(e.data.replace(/"default": ?Infinity/g,'"default": 1e9999'));this.funcDefs=S.parseFuncDefs(t)}else this.funcDefs=S.getFuncDefs(this.graphiteVersion);else this.funcDefs=S.parseFuncDefs(e.data);return this.funcDefs})),(0,c.K)((e=>(console.error("Fetching graphite functions error",e),this.funcDefs=S.getFuncDefs(this.graphiteVersion),(0,r.of)(this.funcDefs))))))}testDatasource(){return(0,s.n)(this.query({panelId:3,rangeRaw:{from:"now-1h",to:"now"},range:{raw:{from:"now-1h",to:"now"}},targets:[{target:"constantLine(100)"}],maxDataPoints:300})).then((()=>({status:"success",message:"Data source is working"})))}doGraphiteRequest(e){return(this.basicAuth||this.withCredentials)&&(e.withCredentials=!0),this.basicAuth&&(e.headers=e.headers||{},e.headers.Authorization=this.basicAuth),e.url=this.url+e.url,e.inspect={type:"graphite"},(0,m.getBackendSrv)().fetch(e).pipe((0,c.K)((e=>(0,i._)(function(e){var t,a;if(e&&500===e.status&&null!==(t=e.data)&&void 0!==t&&null!==(a=t.message)&&void 0!==a&&a.startsWith("<body")){const t=(0,n.last)(e.data.message.replace(/(<([^>]+)>)/gi,"").trim().split(/\n/)).replace(/u?&#[^;]+;/g,"");e.data.message=`Graphite encountered an unexpected error while handling your request. ${t}`}return e}(e)))))}buildGraphiteParams(e,t){const a=["from","until","rawData","format","maxDataPoints","cacheTimeout"],r=[],s={};let i,o,l;const c=/\#([A-Z])/g,m=/'(\d+)m'/gi;let u=!1;function d(e){return e.replace("m","min").replace("M","mon")}for(e.format="json",l=0;l<e.targets.length;l++)i=e.targets[l],i.target&&(i.refId||(i.refId=this._seriesRefLetters[l]),o=this.templateSrv.replace(i.target,t),o=o.replace(m,d),s[i.refId]=o);function p(e,t){return s[t]||e}for(l=0;l<e.targets.length;l++)i=e.targets[l],i.target&&(o=s[i.refId],o=o.replace(c,p),s[i.refId]=o,i.hide||(u=!0,r.push("target="+encodeURIComponent(o))));return(0,n.each)(e,((e,t)=>{-1!==(0,n.indexOf)(a,t)&&e&&r.push(t+"="+encodeURIComponent(e))})),u?r:[]}}function O(){return(0,o.z)((0,l.U)((e=>e.data?(0,n.map)(e.data,(e=>({text:e}))):[])))}var E,R,z,$,B,G,H,V=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),L=a("./packages/grafana-ui/src/index.ts"),W=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function U(e){return(0,W.jsxs)(L.Alert,{severity:"info",title:"How to map Graphite metrics to labels?",onRemove:e.onDismiss,children:[E||(E=(0,W.jsx)("p",{children:"Mappings are currently supported only between Graphite and Loki queries."})),R||(R=(0,W.jsx)("p",{children:"When you switch your data source from Graphite to Loki, your queries are mapped according to the mappings defined in the example below. To define a mapping, write the full path of the metric and replace nodes you want to map to label with the label name in parentheses. The value of the label is extracted from your Graphite query when you switch data sources."})),z||(z=(0,W.jsx)("p",{children:"All tags are automatically mapped to labels regardless of the mapping configuration. Graphite matching patterns (using {}) are converted to Loki's regular expressions matching patterns. When you use functions in your queries, the metrics, and tags are extracted to match them with defined mappings."})),$||($=(0,W.jsxs)("p",{children:["Example: for a mapping = ",(0,W.jsx)("code",{children:"servers.(cluster).(server).*"}),":"]})),B||(B=(0,W.jsxs)("table",{children:[(0,W.jsx)("thead",{children:(0,W.jsxs)("tr",{children:[(0,W.jsx)("th",{children:"Graphite query"}),(0,W.jsx)("th",{children:"Mapped to Loki query"})]})}),(0,W.jsxs)("tbody",{children:[(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:["alias(servers.",(0,W.jsx)("u",{children:"west"}),".",(0,W.jsx)("u",{children:"001"}),".cpu,1,2)"]})}),(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:['{cluster="',(0,W.jsx)("u",{children:"west"}),'", server="',(0,W.jsx)("u",{children:"001"}),'"}']})})]}),(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:["alias(servers.*.",(0,W.jsx)("u",{children:"{001,002}"}),".*,1,2)"]})}),(0,W.jsx)("td",{children:(0,W.jsxs)("code",{children:['{server=~"',(0,W.jsx)("u",{children:"(001|002)"}),'"}']})})]}),(0,W.jsxs)("tr",{children:[(0,W.jsx)("td",{children:(0,W.jsx)("code",{children:"interpolate(seriesByTag('foo=bar', 'server=002'), inf))"})}),(0,W.jsx)("td",{children:(0,W.jsx)("code",{children:'{foo="bar", server="002"}'})})]})]})]}))]})}const Q=e=>{const[t,a]=(0,V.useState)(e.mappings||[]);return(0,W.jsxs)("div",{children:[G||(G=(0,W.jsx)("h3",{className:"page-heading",children:"Label mappings"})),!e.showHelp&&(0,W.jsx)("p",{children:(0,W.jsx)(L.Button,{variant:"link",onClick:e.onRestoreHelp,children:"Learn how label mappings work"})}),e.showHelp&&(0,W.jsx)(U,{onDismiss:e.onDismiss}),(0,W.jsxs)("div",{className:"gf-form-group",children:[t.map(((n,r)=>(0,W.jsxs)(L.InlineFieldRow,{children:[(0,W.jsx)(L.InlineField,{label:`Mapping (${r+1})`,children:(0,W.jsx)(L.Input,{width:50,onChange:e=>{let n=t.concat();n[r]=e.target.value,a(n)},onBlur:()=>{e.onChange(t)},placeholder:"e.g. test.metric.(labelName).*",value:n})}),(0,W.jsx)(L.Button,{type:"button","aria-label":"Remove header",variant:"secondary",size:"xs",onClick:n=>{let s=t.concat();s.splice(r,1),a(s),e.onChange(s)},children:H||(H=(0,W.jsx)(L.Icon,{name:"trash-alt"}))})]},r))),(0,W.jsx)(L.Button,{variant:"secondary",icon:"plus",type:"button",onClick:()=>{a([...t,""])},children:"Add label mapping"})]})]})};function Z(e){return{matchers:e.split(".").map((e=>e.startsWith("(")&&e.endsWith(")")?{value:"*",labelName:e.slice(1,-1)}:{value:e}))}}function J(e){return e.matchers.map((e=>e.labelName?`(${e.labelName})`:`${e.value}`)).join(".")}var K,X,Y,ee,te=a("./public/app/core/store.ts");const{Select:ae,Switch:ne}=L.LegacyForms,re="grafana.datasources.graphite.config.showMappingsHelp",se=I.map((e=>({label:`${e}.x`,value:e}))),ie=Object.entries(C).map((([e,t])=>({label:e,value:t})));class oe extends V.PureComponent{constructor(e){var t,a,n;super(e),n=()=>K||(K=(0,W.jsxs)("p",{children:["There are different types of Graphite compatible backends. Here you can specify the type you are using. If you are using"," ",(0,W.jsx)("a",{href:"https://github.com/grafana/metrictank",className:"pointer",target:"_blank",rel:"noreferrer",children:"Metrictank"})," ","then select that here. This will enable Metrictank specific features like query processing meta data. Metrictank is a multi-tenant timeseries engine for Graphite and friends."]})),(a="renderTypeHelp")in(t=this)?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,this.state={showMappingsHelp:te.Z.getObject(re,!0)}}componentDidMount(){(0,u.updateDatasourcePluginJsonDataOption)(this.props,"graphiteVersion",this.currentGraphiteVersion)}render(){var e,t;const{options:a,onOptionsChange:n}=this.props,r=se.find((e=>e.value===this.currentGraphiteVersion));return(0,W.jsxs)(W.Fragment,{children:["direct"===a.access&&(X||(X=(0,W.jsx)(L.Alert,{title:"Deprecation Notice",severity:"warning",children:"This data source uses browser access mode. This mode is deprecated and will be removed in the future. Please use server access mode instead."}))),(0,W.jsx)(L.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:a,onChange:n}),Y||(Y=(0,W.jsx)("h3",{className:"page-heading",children:"Graphite details"})),(0,W.jsxs)("div",{className:"gf-form-group",children:[(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsxs)("div",{className:"gf-form",children:[ee||(ee=(0,W.jsx)(L.InlineFormLabel,{tooltip:"This option controls what functions are available in the Graphite query editor.",children:"Version"})),(0,W.jsx)(ae,{menuShouldPortal:!0,value:r,options:se,width:8,onChange:(0,u.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteVersion")})]})}),(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsxs)("div",{className:"gf-form",children:[(0,W.jsx)(L.InlineFormLabel,{tooltip:this.renderTypeHelp,children:"Type"}),(0,W.jsx)(ae,{menuShouldPortal:!0,options:ie,value:ie.find((e=>e.value===a.jsonData.graphiteType)),width:8,onChange:(0,u.onUpdateDatasourceJsonDataOptionSelect)(this.props,"graphiteType")})]})}),a.jsonData.graphiteType===C.Metrictank&&(0,W.jsx)("div",{className:"gf-form-inline",children:(0,W.jsx)("div",{className:"gf-form",children:(0,W.jsx)(ne,{label:"Rollup indicator",labelClass:"width-10",tooltip:"Shows up as an info icon in panel headers when data is aggregated",checked:!!a.jsonData.rollupIndicatorEnabled,onChange:(0,u.onUpdateDatasourceJsonDataOptionChecked)(this.props,"rollupIndicatorEnabled")})})})]}),(0,W.jsx)(Q,{mappings:((null===(e=a.jsonData.importConfiguration)||void 0===e||null===(t=e.loki)||void 0===t?void 0:t.mappings)||[]).map(J),showHelp:this.state.showMappingsHelp,onDismiss:()=>{this.setState({showMappingsHelp:!1}),te.Z.setObject(re,!1)},onRestoreHelp:()=>{this.setState({showMappingsHelp:!0}),te.Z.setObject(re,!0)},onChange:e=>{n(Object.assign({},a,{jsonData:Object.assign({},a.jsonData,{importConfiguration:Object.assign({},a.jsonData.importConfiguration,{loki:{mappings:e.map(Z)}})})}))}})]})}get currentGraphiteVersion(){return this.props.options.jsonData.graphiteVersion||N}}var le,ce,me,ue,de,pe=a("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/3/opt/drone/yarncache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),ge=a("./public/app/core/config.ts");class he extends V.PureComponent{renderMeta(e,t){var a;const n=fe(),r=D(e["schema-retentions"]),s=k([e]),i=M([e]),o=(null!==(a=e["consolidator-normfetch"])&&void 0!==a?a:"").replace("Consolidator",""),l=r.reduce(((e,t)=>e+(t.retention?u.rangeUtil.intervalToSeconds(t.retention):0)),0);return(0,W.jsxs)("div",{className:n.metaItem,children:[(0,W.jsxs)("div",{className:n.metaItemHeader,children:["Schema: ",e["schema-name"],(0,W.jsxs)("div",{className:"small muted",children:["Series count: ",e.count]})]}),(0,W.jsxs)("div",{className:n.metaItemBody,children:[(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 1: Fetch"}),(0,W.jsx)("div",{className:n.stepDescription,children:"First data is fetched, either from raw data archive or a rollup archive"}),s&&(0,W.jsx)("p",{children:s.text}),!s&&(le||(le=(0,W.jsx)("p",{children:"No rollup archive was used"}))),(0,W.jsx)("div",{children:r.map(((t,a)=>{const r=(t.retention?u.rangeUtil.intervalToSeconds(t.retention):0)/l*100,s=a===e["archive-read"];return(0,W.jsxs)("div",{className:n.bucket,children:[(0,W.jsx)("div",{className:n.bucketInterval,children:t.interval}),(0,W.jsx)("div",{className:(0,pe.cx)(n.bucketRetention,{[n.bucketRetentionActive]:s}),style:{flexGrow:r}}),(0,W.jsx)("div",{style:{flexGrow:100-r},children:t.retention})]},t.retention)}))})]}),(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 2: Normalization"}),(0,W.jsx)("div",{className:n.stepDescription,children:"Normalization happens when series with different intervals between points are combined."}),e["aggnum-norm"]>1&&(0,W.jsxs)("p",{children:["Normalization did occur using ",o]}),1===e["aggnum-norm"]&&(ce||(ce=(0,W.jsx)("p",{children:"No normalization was needed"})))]}),(0,W.jsxs)("div",{className:n.step,children:[(0,W.jsx)("div",{className:n.stepHeading,children:"Step 3: Runtime consolidation"}),(0,W.jsx)("div",{className:n.stepDescription,children:"If there are too many data points at this point Metrictank will consolidate them down to below max data points (set in queries tab)."}),i&&(0,W.jsx)("p",{children:i.text}),!i&&(me||(me=(0,W.jsx)("p",{children:"No runtime consolidation"})))]})]})]},t)}render(){const{data:e}=this.props,t={};for(const a of e)if(a.meta&&a.meta.custom)for(const e of a.meta.custom.seriesMetaList){const a=`${JSON.stringify(e)}`;t[a]?t[a].count+=e.count:t[a]=e}return 0===Object.keys(t).length?ue||(ue=(0,W.jsx)("div",{children:"No response meta data"})):(0,W.jsxs)("div",{children:[de||(de=(0,W.jsx)("h2",{className:"page-heading",children:"Metrictank Lineage"})),Object.keys(t).map((e=>this.renderMeta(t[e],e)))]})}}const fe=(0,L.stylesFactory)((()=>{const{theme:e}=ge.vc,t=e.isDark?e.palette.gray25:e.palette.gray85,a=e.isDark?e.palette.dark1:e.palette.white,n=e.isDark?e.palette.gray15:e.palette.gray85;return{metaItem:pe.css`
      background: ${a};
      border: 1px solid ${t};
      margin-bottom: ${e.spacing.md};
    `,metaItemHeader:pe.css`
      background: ${n};
      padding: ${e.spacing.xs} ${e.spacing.md};
      font-size: ${e.typography.size.md};
      display: flex;
      justify-content: space-between;
    `,metaItemBody:pe.css`
      padding: ${e.spacing.md};
    `,stepHeading:pe.css`
      font-size: ${e.typography.size.md};
    `,stepDescription:pe.css`
      font-size: ${e.typography.size.sm};
      color: ${e.colors.textWeak};
      margin-bottom: ${e.spacing.sm};
    `,step:pe.css`
      margin-bottom: ${e.spacing.lg};

      &:last-child {
        margin-bottom: 0;
      }
    `,bucket:pe.css`
      display: flex;
      margin-bottom: ${e.spacing.sm};
      border-radius: ${e.border.radius.md};
    `,bucketInterval:pe.css`
      flex-grow: 0;
      width: 60px;
    `,bucketRetention:pe.css`
      background: linear-gradient(0deg, ${e.palette.blue85}, ${e.palette.blue95});
      text-align: center;
      color: ${e.palette.white};
      margin-right: ${e.spacing.md};
      border-radius: ${e.border.radius.md};
    `,bucketRetentionActive:pe.css`
      background: linear-gradient(0deg, ${e.palette.greenBase}, ${e.palette.greenShade});
    `}}));var ye=a("./.yarn/__virtual__/@reduxjs-toolkit-virtual-5e60bdbc91/3/opt/drone/yarncache/@reduxjs-toolkit-npm-1.6.1-a0999c8262-487e340036.zip/node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js");const ve=(0,ye.PH)("init"),xe=(0,ye.PH)("time-range-changed"),be=(0,ye.PH)("queries-changed"),je=(0,ye.PH)("query-changed"),we=(0,ye.PH)("segment-value-changed"),Se=(0,ye.PH)("add-new-tag"),Pe={init:ve,timeRangeChanged:xe,queriesChanged:be,queryChanged:je,segmentValueChanged:we,tagChanged:(0,ye.PH)("tag-changed"),addNewTag:Se,unpause:(0,ye.PH)("unpause"),addFunction:(0,ye.PH)("add-function"),removeFunction:(0,ye.PH)("remove-function"),moveFunction:(0,ye.PH)("move-function"),updateFunctionParam:(0,ye.PH)("change-function-param"),updateQuery:(0,ye.PH)("update-query"),runQuery:(0,ye.PH)("run-current-query"),toggleEditorMode:(0,ye.PH)("toggle-editor")};var Ce=a("./public/app/plugins/datasource/graphite/graphite_query.ts"),Te=a("./public/app/store/store.ts"),qe=a("./public/app/core/reducers/appNotification.ts"),ke=a("./public/app/core/copy/appNotification.ts");const Me=["=","!=","=~","!=~"],De="tag: ";async function Fe(e){e.queryModel.parseTarget(),await Ie(e)}async function Ie(e,t=!0){e.segments=(0,n.clone)(e.queryModel.segments);const a=e.queryModel.checkOtherSegmentsIndex||0;await _e(e,a,t)}function Ne(e){e.queryModel.addSelectMetricSegment(),e.segments.push({value:"select metric",fake:!0})}async function _e(e,t,a=!0){if(1===e.queryModel.segments.length&&"series-ref"===e.queryModel.segments[0].type)return;if(0===t)return void Ne(e);const n=e.queryModel.getSegmentPathUpTo(t+1);if(""!==n)try{const r=await e.datasource.metricFindQuery(n);0===r.length?""!==n&&a&&(e.queryModel.segments=e.queryModel.segments.splice(0,t),e.segments=e.segments.splice(0,t),Ne(e)):r[0].expandable&&(e.segments.length===t?Ne(e):await _e(e,t+1))}catch(t){Ee(e,t)}}function Ae(e){e.queryModel.segments=[],e.segments=[]}function Oe(e){if(e.queryModel.error)return;const t=e.queryModel.target.target;e.queryModel.updateModelTarget((e.queries||[]).filter((e=>"target"in e&&"string"==typeof e.target))),e.queryModel.target.target===t||e.paused||e.refresh()}function Ee(e,t){return console.error(t),e.metricAutoCompleteErrorShown||(e.metricAutoCompleteErrorShown=!0,(0,Te.WI)((0,qe.$l)((0,ke.t_)(`Fetching metrics failed: ${t.message}.`)))),e}function Re(e,t){return console.error(t),e.tagsAutoCompleteErrorShown||(e.tagsAutoCompleteErrorShown=!0,(0,Te.WI)((0,qe.$l)((0,ke.t_)(`Fetching tags failed: ${t.message}.`)))),e}const ze=async(e,t)=>{if(t=Object.assign({},t),Pe.init.match(e)){const a=e.payload;a.target.target=a.target.target||"",await a.datasource.waitForFuncDefsLoaded(),t=Object.assign({},t,a,{queryModel:new Ce.Z(a.datasource,a.target,(0,m.getTemplateSrv)()),supportsTags:a.datasource.supportsTags,paused:!1,removeTagValue:"-- remove tag --",funcDefs:a.datasource.funcDefs,queries:a.queries}),await Ie(t,!1)}if(Pe.timeRangeChanged.match(e)&&(t.range=e.payload),Pe.queriesChanged.match(e)&&(t.queries=e.payload,Oe(t)),Pe.queryChanged.match(e)&&(t.target.target=e.payload.target||"",await Fe(t),Oe(t)),Pe.segmentValueChanged.match(e)){const{segment:a,index:n}=e.payload;let r;if(r="string"==typeof a?{value:a,expandable:!0,fake:!1}:a,t.error=null,t.segments[n]=r,t.queryModel.updateSegmentValue(r,n),t.queryModel.functions.length>0&&t.queryModel.functions[0].def.fake&&(t.queryModel.functions=[]),"tag"===r.type){const e=r.value.replace(De,"");return function(e){e.paused=!0}(t),await async function(e,t){const a=e.datasource.createFuncInstance("seriesByTag",{withDefaultParams:!1}),n=`${t}=`;a.params=[n],e.queryModel.addFunction(a),a.added=!0,Ae(e),Oe(e),await Fe(e)}(t,e),t}r.expandable?await _e(t,n+1):function(e,t){e.segments=e.segments.splice(0,t),e.queryModel.segments=e.queryModel.segments.splice(0,t)}(t,n+1),Oe(t)}if(Pe.tagChanged.match(e)){const{tag:a,index:n}=e.payload;t.queryModel.updateTag(a,n),Oe(t),0===t.queryModel.tags.length&&(await _e(t,0),t.paused=!1)}if(Pe.addNewTag.match(e)){const a={key:e.payload.segment.value,operator:"=",value:""};t.queryModel.addTag(a),Oe(t)}if(Pe.unpause.match(e)&&(t.paused=!1,t.refresh()),Pe.addFunction.match(e)){const a=t.datasource.createFuncInstance(e.payload.name,{withDefaultParams:!0});a.added=!0,t.queryModel.addFunction(a),function(e,t){if("aliasByNode"===t.def.name)for(let a=0;a<e.segments.length;a++)if(e.segments[a].value.indexOf("*")>=0)return t.params[0]=a,t.added=!1,void Oe(e)}(t,a),1===t.segments.length&&t.segments[0].fake&&Ae(t),!a.params.length&&a.added&&Oe(t),"seriesByTag"===a.def.name&&await Fe(t)}if(Pe.removeFunction.match(e)&&(t.queryModel.removeFunction(e.payload.func),Oe(t)),Pe.moveFunction.match(e)){const{func:a,offset:n}=e.payload;t.queryModel.moveFunction(a,n),Oe(t)}if(Pe.updateFunctionParam.match(e)){const{func:a,index:n,value:r}=e.payload;a.updateParam(r,n),Oe(t)}return Pe.updateQuery.match(e)&&(t.target.target=e.payload.query,Oe(t)),Pe.runQuery.match(e)&&t.refresh(),Pe.toggleEditorMode.match(e)&&(t.target.textEditor=!t.target.textEditor,await Fe(t)),Object.assign({},t)};var $e=a("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js");const Be=(0,V.createContext)({}),Ge=(0,V.createContext)({}),He=()=>(0,V.useContext)(Be),Ve=({datasource:e,onRunQuery:t,onChange:a,query:n,queries:r,range:s,children:i})=>{const[o,l]=(0,V.useState)(),[c,m]=(0,V.useState)(!1),u=(0,V.useMemo)((()=>(e=>{let t={};return async a=>{t=await ze(a,t),e(t)}})((e=>{l(e)}))),[]),d=(0,$e.Z)(s);return(0,V.useEffect)((()=>{(null==d?void 0:d.raw)!==(null==s?void 0:s.raw)&&u(Pe.timeRangeChanged(s))}),[u,s,d]),(0,V.useEffect)((()=>{o&&u(Pe.queriesChanged(r))}),[u,r]),(0,V.useEffect)((()=>{var e;o&&(null===(e=o.target)||void 0===e?void 0:e.target)!==n.target&&u(Pe.queryChanged(n))}),[u,n]),(0,V.useEffect)((()=>{c&&o&&(m(!1),a(Object.assign({},n,{target:o.target.target})),t())}),[c,a,t,n]),o?(0,W.jsx)(Ge.Provider,{value:o,children:(0,W.jsx)(Be.Provider,{value:u,children:i})}):(u(Pe.init({target:n,datasource:e,range:s,templateSrv:(0,P.J)(),queries:r||[],refresh:()=>{m(!0)}})),null)};function Le({rawQuery:e}){const t=He(),a=(0,V.useCallback)((e=>{t(Pe.updateQuery({query:e}))}),[t]),n=(0,V.useCallback)((()=>{t(Pe.runQuery())}),[t]);return(0,W.jsx)(L.QueryField,{query:e,onChange:a,onBlur:n,onRunQuery:n,placeholder:"Enter a Graphite query (run with Shift+Enter)",portalOrigin:"graphite"})}function We(e){return e.map((e=>({value:e,label:e})))}function Ue(e){return e.map((e=>({label:e.value,value:e})))}function Qe(e,t,a){var n,r;return{name:e.name,value:(null==a?void 0:a.toString())||"",optional:!!e.optional||t,multiple:!!e.multiple,options:null!==(n=null===(r=e.options)||void 0===r?void 0:r.map((e=>({value:e.toString(),label:e.toString()}))))&&void 0!==n?n:[]}}const Ze=5e3;async function Je(e,t,a){let r=a.length>0?"*"+a+"*":"*";t>0&&(r=e.queryModel.getSegmentPathUpTo(t)+"."+r);const s={range:e.range,requestId:"get-alt-segments"};try{const i=await e.datasource.metricFindQuery(r,s),o=(0,n.map)(i,(e=>({value:e.text,expandable:e.expandable})));return t>0&&0===o.length?o:(0===t&&(0,n.eachRight)(e.queries,(t=>{t.refId!==e.queryModel.target.refId&&o.unshift({type:"series-ref",value:"#"+t.refId,expandable:!1})})),(0,n.eachRight)(e.templateSrv.getVariables(),(e=>{o.unshift({type:"template",value:"$"+e.name,expandable:!0})})),o.unshift({value:"*",expandable:!0}),o.splice(Ze),e.supportsTags&&0===t?(function(e){(0,n.remove)(e,(e=>"_tagged"===e.value))}(o),await async function(e,t,a){let r=await Xe(e,t);return r=(0,n.map)(r,(e=>(e.value=De+e.value,e))),a.concat(...r)}(e,a,o)):o)}catch(t){Ee(e,t)}return[]}async function Ke(e,t,a){return We(await async function(e,t,a){try{const r=e.queryModel.renderTagExpressions(t),s=await e.datasource.getTagsAutoComplete(r,a,{range:e.range,limit:Ze}),i=(0,n.map)(s,"text");return i.splice(0,0,e.removeTagValue),i}catch(t){Re(e,t)}return[]}(e,t,a))}async function Xe(e,t){let a;try{const r=e.queryModel.renderTagExpressions(),s=await e.datasource.getTagsAutoComplete(r,t,{range:e.range,limit:Ze});a=(0,n.map)(s,(e=>({value:e.text,type:"tag",expandable:!1})))}catch(t){a=[],Re(e,t)}return a}async function Ye(e,t,a,r){return We(await async function(e,t,a,r){const s=e.queryModel.renderTagExpressions(a),i=t.key,o=await e.datasource.getTagValuesAutoComplete(s,i,r,{limit:Ze}),l=(0,n.map)(o,"text");return(0,n.eachRight)(e.templateSrv.getVariables(),(e=>{l.push("${"+e.name+":regex}")})),l}(e,t,a,r))}function et({tag:e,tagIndex:t,state:a}){const r=He(),s=(0,V.useCallback)((e=>Ke(a,t,e||"")),[a,t]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]),o=(0,V.useCallback)((n=>Ye(a,e,t,n||"")),[a,t,e]),l=(0,V.useMemo)((()=>(0,n.debounce)(o,200,{leading:!0})),[o]);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,value:e.key,loadOptions:i,reloadOptionsOnChange:!0,onChange:a=>{r(Pe.tagChanged({tag:Object.assign({},e,{key:a.value}),index:t}))},allowCustomValue:!0}),(0,W.jsx)(L.Segment,{inputMinWidth:50,value:e.operator,options:We(Me),onChange:a=>{r(Pe.tagChanged({tag:Object.assign({},e,{operator:a.value}),index:t}))}}),(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,value:e.value,loadOptions:l,reloadOptionsOnChange:!0,onChange:a=>{r(Pe.tagChanged({tag:Object.assign({},e,{value:a.value}),index:t}))},allowCustomValue:!0})]})}function tt(){const e=He(),t=(0,V.useCallback)((()=>{e(Pe.unpause())}),[e]);return(0,W.jsx)(L.Button,{icon:"play",onClick:t,type:"button",variant:"secondary","aria-label":"Unpause query"})}var at;function nt({tags:e,state:t}){const a=He(),r=(0,L.useStyles2)(rt),s=(0,V.useCallback)((e=>async function(e,t){return Ue(await Xe(e,t))}(t,e||"")),[t]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]);return(0,W.jsxs)(W.Fragment,{children:[e.map(((e,a)=>(0,W.jsx)(et,{tagIndex:a,tag:e,state:t},a))),e.length&&(0,W.jsx)(L.SegmentAsync,{inputMinWidth:150,onChange:e=>{a(Pe.addNewTag({segment:e.value}))},loadOptions:i,reloadOptionsOnChange:!0,Component:(0,W.jsx)(L.Button,{icon:"plus",variant:"secondary",className:r.button,"aria-label":"Add new tag"})}),t.paused&&(at||(at=(0,W.jsx)(tt,{})))]})}function rt(e){return{button:pe.css`
      margin-right: ${e.spacing(.5)};
    `}}function st({metricIndex:e,segment:t,state:a}){const r=He(),s=(0,V.useCallback)((t=>async function(e,t,a){return Ue(await Je(e,t,a))}(a,e,t||"")),[a,e]),i=(0,V.useMemo)((()=>(0,n.debounce)(s,200,{leading:!0})),[s]),o=(0,V.useCallback)((t=>{r(Pe.segmentValueChanged({segment:t.value,index:e}))}),[r,e]),l=(0,V.useMemo)((()=>(0,n.debounce)(o,100)),[o]);return(0,W.jsx)(L.SegmentAsync,{value:t.value,inputMinWidth:150,allowCustomValue:!0,loadOptions:i,reloadOptionsOnChange:!0,onChange:l})}function it({segments:e=[],state:t}){return(0,W.jsx)(W.Fragment,{children:e.map(((e,a)=>(0,W.jsx)(st,{segment:e,metricIndex:a,state:t},a)))})}function ot({state:e}){var t,a;const n=null!==(t=e.queryModel)&&void 0!==t&&t.seriesByTagUsed?(0,W.jsx)(nt,{tags:null===(a=e.queryModel)||void 0===a?void 0:a.tags,state:e}):(0,W.jsx)(it,{segments:e.segments,state:e});return(0,W.jsx)(L.SegmentSection,{label:"Series",fill:!0,children:n})}function lt({editableParam:e,onChange:t,onExpandedChange:a,autofocus:n}){var r;const s=(0,L.useStyles2)(ct);return(null===(r=e.options)||void 0===r?void 0:r.length)>0?(0,W.jsx)(L.Segment,{autofocus:n,value:e.value,inputPlaceholder:e.name,className:s.segment,options:e.options,placeholder:" +"+e.name,onChange:e=>{t(e.value||"")},onExpandedChange:a,inputMinWidth:150,allowCustomValue:!0,allowEmptyValue:!0}):(0,W.jsx)(L.SegmentInput,{autofocus:n,className:s.input,value:e.value||"",placeholder:" +"+e.name,inputPlaceholder:e.name,onChange:e=>{t(e.toString())},onExpandedChange:a,style:{height:"25px",paddingTop:"2px",marginTop:"2px",paddingLeft:"4px",minWidth:"100px"}})}const ct=e=>({segment:(0,pe.css)({margin:0,padding:0}),input:pe.css`
    margin: 0;
    padding: 0;
    input {
      height: 25px;
    },
  `});var mt;const ut=V.lazy((async()=>{const{default:e}=await a.e(495).then(a.t.bind(a,"../../opt/drone/yarncache/rst2html-https-e87da7ea2f-63d5ff3068.zip/node_modules/rst2html/dist/rst2html.min.js",23));return{default(t){var a;return(0,W.jsx)("div",{dangerouslySetInnerHTML:{__html:e(null!==(a=t.description)&&void 0!==a?a:"")}})}}})),dt=e=>{if(e.description){let t=(0,W.jsx)(V.Suspense,{fallback:mt||(mt=(0,W.jsx)("span",{children:"Loading description..."})),children:(0,W.jsx)(ut,{description:e.description})});return(0,W.jsx)(L.Tooltip,{content:t,placement:"bottom-end",children:(0,W.jsx)(L.Icon,{className:e.description?void 0:"pointer",name:"question-circle"})})}return(0,W.jsx)(L.Icon,{className:"pointer",name:"question-circle",onClick:()=>{window.open("http://graphite.readthedocs.org/en/latest/functions.html#graphite.render.functions."+e.name,"_blank")}})},pt=e=>{const{func:t,onMoveLeft:a,onMoveRight:n,onRemove:r}=e;return(0,W.jsxs)("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"},children:[(0,W.jsx)(L.Icon,{name:"arrow-left",onClick:()=>a(t)}),(0,W.jsx)(dt,{name:t.def.name,description:t.def.description}),(0,W.jsx)(L.Icon,{name:"times",onClick:()=>r(t)}),(0,W.jsx)(L.Icon,{name:"arrow-right",onClick:()=>n(t)})]})};var gt,ht;const ft=["onMoveLeft","onMoveRight","func"];const yt=e=>({icon:pe.css`
      margin-right: ${e.spacing(.5)};
    `,label:(0,pe.css)({fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.bodySmall.fontSize,cursor:"pointer",display:"inline-block",paddingBottom:"2px"})}),vt=e=>{let{onMoveLeft:t,onMoveRight:a,func:n}=e,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,ft);const s=(0,V.useRef)(null),i=(0,L.useStyles2)(yt);return(0,W.jsx)(L.PopoverController,{content:({updatePopperPosition:e})=>(0,W.jsx)(pt,Object.assign({},r,{func:n,onMoveLeft:()=>{t(n),e()},onMoveRight:()=>{a(n),e()}})),placement:"top",hideAfter:100,children:(e,t,a)=>(0,W.jsxs)(W.Fragment,{children:[s.current&&(0,W.jsx)(L.Popover,Object.assign({},a,{referenceElement:s.current,wrapperClassName:"popper",className:"popper__background",renderArrow:({arrowProps:e,placement:t})=>(0,W.jsx)("div",Object.assign({className:"popper__arrow","data-placement":t},e))})),(0,W.jsx)(L.ClickOutsideWrapper,{onClick:()=>{a.show&&t()},children:(0,W.jsxs)("span",{ref:s,onClick:a.show?t:e,className:i.label,children:[n.def.unknown&&(0,W.jsx)(L.Tooltip,{content:gt||(gt=(0,W.jsx)(xt,{})),placement:"bottom",children:(0,W.jsx)(L.Icon,{"data-testid":"warning-icon",name:"exclamation-triangle",size:"xs",className:i.icon})}),n.def.name]})})]})})},xt=V.memo((()=>ht||(ht=(0,W.jsxs)("span",{children:["This function is not supported. Check your function for typos and"," ",(0,W.jsx)("a",{target:"_blank",className:"external-link",rel:"noreferrer noopener",href:"https://graphite.readthedocs.io/en/latest/functions.html",children:"read the docs"})," ","to see whether you need to upgrade your data source’s version to make this function available."]}))));function bt({func:e}){const t=He(),a=(0,L.useStyles2)(jt),[n,r]=(0,V.useState)(!1),[s,i]=(0,V.useState)(!1);let o=function(e){var t;const a=e.def.params.map(((t,a)=>Qe(t,!1,e.params[a])));for(;a.length<e.params.length;){const t=e.def.params[e.def.params.length-1],n=e.params[a.length];a.push(Qe(t,!0,n))}if(a.length&&a[a.length-1].value&&null!==(t=a[a.length-1])&&void 0!==t&&t.multiple){const t=e.def.params[e.def.params.length-1];a.push(Qe(t,!0,""))}return a}(e);return o=o.filter(((t,a)=>a<e.def.params.length&&!t.optional||e.added||t.value||s||n)),(0,W.jsx)("div",{className:(0,pe.cx)(a.container,{[a.error]:e.def.unknown}),onMouseOver:()=>r(!0),onMouseLeave:()=>r(!1),children:(0,W.jsxs)(L.HorizontalGroup,{spacing:"none",children:[(0,W.jsx)(vt,{func:e,onMoveLeft:()=>{t(Pe.moveFunction({func:e,offset:-1}))},onMoveRight:()=>{t(Pe.moveFunction({func:e,offset:1}))},onRemove:()=>{t(Pe.removeFunction({func:e}))}}),(0,W.jsx)(L.InlineLabel,{className:a.label,children:"("}),o.map(((a,n)=>(0,W.jsxs)(V.Fragment,{children:[(0,W.jsx)(lt,{autofocus:0===n&&e.added,editableParam:a,onChange:s=>{(""!==s||a.optional)&&t(Pe.updateFunctionParam({func:e,index:n,value:s})),i(!1),r(!1)},onExpandedChange:i}),n!==o.length-1?",":""]},n))),(0,W.jsx)(L.InlineLabel,{className:a.label,children:")"})]})})}xt.displayName="FunctionEditorTooltipContent";const jt=e=>({container:(0,pe.css)({backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(),marginRight:e.spacing(.5),padding:`0 ${e.spacing(1)}`,height:`${e.v1.spacing.formInputHeight}px`}),error:pe.css`
    border: 1px solid ${e.colors.error.main};
  `,label:(0,pe.css)({padding:0,margin:0}),button:(0,pe.css)({padding:e.spacing(.5)})});function wt({funcDefs:e}){const t=He(),[a,r]=(0,V.useState)(void 0),s=(0,L.useStyles2)(St),i=(0,V.useMemo)((()=>function(e){const t={};return(0,n.forEach)(e,(e=>{e.category&&(t[e.category]||(t[e.category]={label:e.category,value:e.category,options:[]}),t[e.category].options.push({label:e.name,value:e.name}))})),(0,n.sortBy)(t,"label")}(e)),[e]);return(0,V.useEffect)((()=>{void 0!==(null==a?void 0:a.value)&&(t(Pe.addFunction({name:a.value})),r(void 0))}),[a,t]),(0,W.jsx)(L.Segment,{Component:(0,W.jsx)(L.Button,{icon:"plus",variant:"secondary",className:(0,pe.cx)(s.button),"aria-label":"Add new function"}),options:i,onChange:r,inputMinWidth:150})}function St(e){return{button:pe.css`
      margin-right: ${e.spacing(.5)};
    `}}function Pt({functions:e=[],funcDefs:t}){return(0,W.jsxs)(L.SegmentSection,{label:"Functions",fill:!0,children:[e.map(((e,t)=>!e.hidden&&(0,W.jsx)(bt,{func:e},t))),(0,W.jsx)(wt,{funcDefs:t})]})}var Ct,Tt,qt,kt;function Mt(){var e,t,a;const n=He(),r=(0,V.useContext)(Ge),s=(0,L.useStyles2)(Dt);return(0,W.jsxs)("div",{className:s.container,children:[(0,W.jsxs)("div",{className:s.visualEditor,children:[(null===(e=r.target)||void 0===e?void 0:e.textEditor)&&(0,W.jsx)(Le,{rawQuery:r.target.target}),!(null!==(t=r.target)&&void 0!==t&&t.textEditor)&&(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(ot,{state:r}),(0,W.jsx)(Pt,{functions:null===(a=r.queryModel)||void 0===a?void 0:a.functions,funcDefs:r.funcDefs})]})]}),(0,W.jsx)(L.Button,{className:s.toggleButton,icon:"pen",variant:"secondary","aria-label":"Toggle editor mode",onClick:()=>{n(Pe.toggleEditorMode())}})]})}function Dt(e){return{container:pe.css`
      display: flex;
    `,visualEditor:pe.css`
      flex-grow: 1;
    `,toggleButton:pe.css`
      margin-left: ${e.spacing(.5)};
    `}}class Ft{}kt="partials/annotations.editor.html",(qt="templateUrl")in(Tt=Ft)?Object.defineProperty(Tt,qt,{value:kt,enumerable:!0,configurable:!0,writable:!0}):Tt[qt]=kt;const It=new u.DataSourcePlugin(A).setQueryEditor((function({datasource:e,onRunQuery:t,onChange:a,query:n,range:r,queries:s}){return(0,W.jsx)(Ve,{datasource:e,onRunQuery:t,onChange:a,query:n,queries:s,range:r,children:Ct||(Ct=(0,W.jsx)(Mt,{}))})})).setConfigEditor(oe).setMetadataInspector(he).setAnnotationQueryCtrl(Ft)},"./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/usePrevious.js":(e,t,a)=>{a.d(t,{Z:()=>r});var n=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");function r(e){var t=(0,n.useRef)();return(0,n.useEffect)((function(){t.current=e})),t.current}}}]);
//# sourceMappingURL=graphitePlugin.1f65f885c5a67f13d9d6.js.map