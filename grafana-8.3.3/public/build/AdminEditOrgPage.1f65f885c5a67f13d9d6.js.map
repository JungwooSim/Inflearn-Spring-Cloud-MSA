{"version":3,"file":"AdminEditOrgPage.1f65f885c5a67f13d9d6.js","mappings":"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","sources":["webpack://grafana/./public/app/features/admin/AdminEditOrgPage.tsx","webpack://grafana/./public/app/features/users/UsersTable.tsx"],"sourcesContent":["import React, { FC, useState, useEffect } from 'react';\nimport Page from 'app/core/components/Page/Page';\nimport { useSelector } from 'react-redux';\nimport { StoreState, OrgUser, AccessControlAction } from 'app/types';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport UsersTable from '../users/UsersTable';\nimport { useAsyncFn } from 'react-use';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { UrlQueryValue } from '@grafana/data';\nimport { Form, Field, Input, Button, Legend, Alert } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { contextSrv } from 'app/core/core';\n\ninterface OrgNameDTO {\n  orgName: string;\n}\n\nconst getOrg = async (orgId: UrlQueryValue) => {\n  return await getBackendSrv().get('/api/orgs/' + orgId);\n};\n\nconst getOrgUsers = async (orgId: UrlQueryValue) => {\n  if (contextSrv.hasPermission(AccessControlAction.OrgUsersRead)) {\n    return await getBackendSrv().get(`/api/orgs/${orgId}/users`);\n  }\n  return [];\n};\n\nconst updateOrgUserRole = async (orgUser: OrgUser, orgId: UrlQueryValue) => {\n  await getBackendSrv().patch('/api/orgs/' + orgId + '/users/' + orgUser.userId, orgUser);\n};\n\nconst removeOrgUser = async (orgUser: OrgUser, orgId: UrlQueryValue) => {\n  return await getBackendSrv().delete('/api/orgs/' + orgId + '/users/' + orgUser.userId);\n};\n\ninterface Props extends GrafanaRouteComponentProps<{ id: string }> {}\n\nexport const AdminEditOrgPage: FC<Props> = ({ match }) => {\n  const navIndex = useSelector((state: StoreState) => state.navIndex);\n  const navModel = getNavModel(navIndex, 'global-orgs');\n  const orgId = parseInt(match.params.id, 10);\n  const canWriteOrg = contextSrv.hasPermission(AccessControlAction.OrgsWrite);\n  const canReadUsers = contextSrv.hasPermission(AccessControlAction.OrgUsersRead);\n\n  const [users, setUsers] = useState<OrgUser[]>([]);\n\n  const [orgState, fetchOrg] = useAsyncFn(() => getOrg(orgId), []);\n  const [, fetchOrgUsers] = useAsyncFn(() => getOrgUsers(orgId), []);\n\n  useEffect(() => {\n    fetchOrg();\n    fetchOrgUsers().then((res) => setUsers(res));\n  }, [fetchOrg, fetchOrgUsers]);\n\n  const updateOrgName = async (name: string) => {\n    return await getBackendSrv().put('/api/orgs/' + orgId, { ...orgState.value, name });\n  };\n\n  const renderMissingUserListRightsMessage = () => {\n    return (\n      <Alert severity=\"info\" title=\"Access denied\">\n        You do not have permission to see users in this organization. To update this organization, contact your server\n        administrator.\n      </Alert>\n    );\n  };\n\n  return (\n    <Page navModel={navModel}>\n      <Page.Contents>\n        <>\n          <Legend>Edit organization</Legend>\n          {orgState.value && (\n            <Form\n              defaultValues={{ orgName: orgState.value.name }}\n              onSubmit={async (values: OrgNameDTO) => await updateOrgName(values.orgName)}\n            >\n              {({ register, errors }) => (\n                <>\n                  <Field label=\"Name\" invalid={!!errors.orgName} error=\"Name is required\" disabled={!canWriteOrg}>\n                    <Input {...register('orgName', { required: true })} id=\"org-name-input\" />\n                  </Field>\n                  <Button disabled={!canWriteOrg}>Update</Button>\n                </>\n              )}\n            </Form>\n          )}\n\n          <div\n            className={css`\n              margin-top: 20px;\n            `}\n          >\n            <Legend>Organization users</Legend>\n            {!canReadUsers && renderMissingUserListRightsMessage()}\n            {canReadUsers && !!users.length && (\n              <UsersTable\n                users={users}\n                orgId={orgId}\n                onRoleChange={(role, orgUser) => {\n                  updateOrgUserRole({ ...orgUser, role }, orgId);\n                  setUsers(\n                    users.map((user) => {\n                      if (orgUser.userId === user.userId) {\n                        return { ...orgUser, role };\n                      }\n                      return user;\n                    })\n                  );\n                  fetchOrgUsers();\n                }}\n                onRemoveUser={(orgUser) => {\n                  removeOrgUser(orgUser, orgId);\n                  setUsers(users.filter((user) => orgUser.userId !== user.userId));\n                  fetchOrgUsers();\n                }}\n              />\n            )}\n          </div>\n        </>\n      </Page.Contents>\n    </Page>\n  );\n};\n\nexport default AdminEditOrgPage;\n","import React, { FC, useEffect, useState } from 'react';\nimport { AccessControlAction, OrgUser, Role } from 'app/types';\nimport { OrgRolePicker } from '../admin/OrgRolePicker';\nimport { Button, ConfirmModal } from '@grafana/ui';\nimport { OrgRole } from '@grafana/data';\nimport { contextSrv } from 'app/core/core';\nimport { fetchBuiltinRoles, fetchRoleOptions, UserRolePicker } from 'app/core/components/RolePicker/UserRolePicker';\n\nexport interface Props {\n  users: OrgUser[];\n  orgId?: number;\n  onRoleChange: (role: OrgRole, user: OrgUser) => void;\n  onRemoveUser: (user: OrgUser) => void;\n}\n\nconst UsersTable: FC<Props> = (props) => {\n  const { users, orgId, onRoleChange, onRemoveUser } = props;\n  const canUpdateRole = contextSrv.hasPermission(AccessControlAction.OrgUsersRoleUpdate);\n  const canRemoveFromOrg = contextSrv.hasPermission(AccessControlAction.OrgUsersRemove);\n  const rolePickerDisabled = !canUpdateRole;\n\n  const [showRemoveModal, setShowRemoveModal] = useState<string | boolean>(false);\n  const [roleOptions, setRoleOptions] = useState<Role[]>([]);\n  const [builtinRoles, setBuiltinRoles] = useState<{ [key: string]: Role[] }>({});\n\n  useEffect(() => {\n    async function fetchOptions() {\n      try {\n        let options = await fetchRoleOptions(orgId);\n        setRoleOptions(options);\n        const builtInRoles = await fetchBuiltinRoles(orgId);\n        setBuiltinRoles(builtInRoles);\n      } catch (e) {\n        console.error('Error loading options');\n      }\n    }\n    if (contextSrv.accessControlEnabled()) {\n      fetchOptions();\n    }\n  }, [orgId]);\n\n  const getRoleOptions = async () => roleOptions;\n  const getBuiltinRoles = async () => builtinRoles;\n\n  return (\n    <table className=\"filter-table form-inline\">\n      <thead>\n        <tr>\n          <th />\n          <th>Login</th>\n          <th>Email</th>\n          <th>Name</th>\n          <th>Seen</th>\n          <th>Role</th>\n          <th style={{ width: '34px' }} />\n        </tr>\n      </thead>\n      <tbody>\n        {users.map((user, index) => {\n          return (\n            <tr key={`${user.userId}-${index}`}>\n              <td className=\"width-2 text-center\">\n                <img className=\"filter-table__avatar\" src={user.avatarUrl} alt=\"User avatar\" />\n              </td>\n              <td className=\"max-width-6\">\n                <span className=\"ellipsis\" title={user.login}>\n                  {user.login}\n                </span>\n              </td>\n\n              <td className=\"max-width-5\">\n                <span className=\"ellipsis\" title={user.email}>\n                  {user.email}\n                </span>\n              </td>\n              <td className=\"max-width-5\">\n                <span className=\"ellipsis\" title={user.name}>\n                  {user.name}\n                </span>\n              </td>\n              <td className=\"width-1\">{user.lastSeenAtAge}</td>\n\n              <td className=\"width-8\">\n                {contextSrv.accessControlEnabled() ? (\n                  <UserRolePicker\n                    userId={user.userId}\n                    orgId={orgId}\n                    builtInRole={user.role}\n                    onBuiltinRoleChange={(newRole) => onRoleChange(newRole, user)}\n                    getRoleOptions={getRoleOptions}\n                    getBuiltinRoles={getBuiltinRoles}\n                    disabled={rolePickerDisabled}\n                  />\n                ) : (\n                  <OrgRolePicker\n                    aria-label=\"Role\"\n                    value={user.role}\n                    disabled={!canUpdateRole}\n                    onChange={(newRole) => onRoleChange(newRole, user)}\n                  />\n                )}\n              </td>\n\n              {canRemoveFromOrg && (\n                <td>\n                  <Button\n                    size=\"sm\"\n                    variant=\"destructive\"\n                    onClick={() => setShowRemoveModal(user.login)}\n                    icon=\"times\"\n                    aria-label=\"Delete user\"\n                  />\n                  <ConfirmModal\n                    body={`Are you sure you want to delete user ${user.login}?`}\n                    confirmText=\"Delete\"\n                    title=\"Delete\"\n                    onDismiss={() => setShowRemoveModal(false)}\n                    isOpen={user.login === showRemoveModal}\n                    onConfirm={() => {\n                      onRemoveUser(user);\n                    }}\n                  />\n                </td>\n              )}\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n\nexport default UsersTable;\n"],"names":["AdminEditOrgPage","match","navIndex","useSelector","state","navModel","getNavModel","orgId","parseInt","params","id","canWriteOrg","contextSrv","AccessControlAction","canReadUsers","users","setUsers","useState","orgState","fetchOrg","useAsyncFn","async","getBackendSrv","get","getOrg","fetchOrgUsers","getOrgUsers","useEffect","then","res","Legend","value","Form","defaultValues","orgName","name","onSubmit","put","updateOrgName","values","register","errors","Field","label","invalid","error","disabled","Input","required","Button","className","css","Alert","severity","title","length","onRoleChange","role","orgUser","patch","userId","updateOrgUserRole","map","user","onRemoveUser","delete","removeOrgUser","filter","props","canUpdateRole","canRemoveFromOrg","rolePickerDisabled","showRemoveModal","setShowRemoveModal","roleOptions","setRoleOptions","builtinRoles","setBuiltinRoles","options","fetchRoleOptions","builtInRoles","fetchBuiltinRoles","e","console","fetchOptions","getRoleOptions","getBuiltinRoles","style","width","index","src","avatarUrl","alt","login","email","lastSeenAtAge","builtInRole","onBuiltinRoleChange","newRole","onChange","size","variant","onClick","icon","ConfirmModal","body","confirmText","onDismiss","isOpen","onConfirm"],"sourceRoot":""}