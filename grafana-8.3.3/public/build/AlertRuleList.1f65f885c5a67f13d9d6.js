"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4286],{"./public/app/features/alerting/AlertRuleList.tsx":(e,a,t)=>{t.r(a),t.d(a,{AlertRuleListUnconnected:()=>F,default:()=>T});var n=t("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=t("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),s=t("./public/app/core/components/Page/Page.tsx"),i=t("./.yarn/__virtual__/react-highlight-words-virtual-d2265e757c/3/opt/drone/yarncache/react-highlight-words-npm-0.17.0-880b4a18ed-41b3d0e451.zip/node_modules/react-highlight-words/dist/main.js"),l=t.n(i),o=t("./packages/grafana-ui/src/index.ts"),c=t("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const u=({rule:e,search:a,onTogglePause:t})=>{const r=`${e.url}?editPanel=${e.panelId}&tab=alert`,s=(0,n.useCallback)((e=>(0,c.jsx)(l(),{highlightClassName:"highlight-search-match",textToHighlight:e,searchWords:[a]},e)),[a]);return(0,c.jsxs)(o.Card,{heading:(0,c.jsx)("a",{href:r,children:s(e.name)}),children:[(0,c.jsx)(o.Card.Figure,{children:(0,c.jsx)(o.Icon,{size:"xl",name:e.stateIcon,className:`alert-rule-item__icon ${e.stateClass}`})}),(0,c.jsxs)(o.Card.Meta,{children:[(0,c.jsxs)("span",{children:[(0,c.jsxs)("span",{className:`${e.stateClass}`,children:[s(e.stateText)," "]},"text"),"for ",e.stateAge]},"state"),e.info?s(e.info):null]}),(0,c.jsxs)(o.Card.Actions,{children:[(0,c.jsx)(o.Button,{variant:"secondary",icon:"paused"===e.state?"play":"pause",onClick:t,children:"paused"===e.state?"Resume":"Pause"},"play"),(0,c.jsx)(o.LinkButton,{variant:"secondary",href:r,icon:"cog",children:"Edit alert"},"edit")]})]})};var d=t("./public/app/core/app_events.ts"),p=t("./public/app/core/selectors/navModel.ts"),h=t("./public/app/features/alerting/state/actions.ts");const g=e=>e.searchQuery,f=e=>{const a=new RegExp(e.alertRules.searchQuery,"i");return e.alertRules.items.filter((e=>a.test(e.name)||a.test(e.stateText)||a.test(e.info)))};var m,v=t("./packages/grafana-runtime/src/index.ts"),x=t("./public/app/features/alerting/state/reducers.ts"),b=t("./public/app/types/events.ts");function j({onDismiss:e}){return(0,c.jsx)(o.Modal,{title:"Adding an Alert",isOpen:!0,onDismiss:e,onClickBackdrop:e,children:m||(m=(0,c.jsxs)(o.VerticalGroup,{spacing:"sm",children:[(0,c.jsx)("img",{src:"public/img/alert_howto_new.png",alt:"link to how to alert image"}),(0,c.jsx)("p",{children:"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."}),(0,c.jsx)("p",{children:"Remember to save the dashboard to persist your alert rule changes."})]}))})}var y,w,S=t("./.yarn/__virtual__/react-use-virtual-ca2705900f/3/opt/drone/yarncache/react-use-npm-17.2.4-c702db5427-3c885c3798.zip/node_modules/react-use/esm/useLocalStorage.js");const A=()=>{const[e,a]=(0,S.Z)("grafana.legacyalerting.unifiedalertingpromo",!0);return e?(0,c.jsxs)(o.Alert,{severity:"info",title:"Try out the Grafana 8 alerting!",onRemove:()=>a(!1),children:[y||(y=(0,c.jsxs)("p",{children:["You are using the legacy Grafana alerting.",(0,c.jsx)("br",{}),"While we have no plans of deprecating it any time soon, we invite you to give the improved Grafana 8 alerting a try."]})),w||(w=(0,c.jsxs)("p",{children:["See"," ",(0,c.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/difference-old-new/",children:"What’s New with Grafana 8 alerting"})," ","to learn more about what‘s new in Grafana 8 alerting or learn"," ",(0,c.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/alerting/unified-alerting/opt-in/",children:"how to enable the new Grafana 8 alerting feature"}),"."]}))]}):null};var k,_,C,R;function P(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}const N={getAlertRulesAsync:h.Au,setSearchQuery:x.ql,togglePauseAlertRule:h.en},B=(0,r.connect)((function(e){return{navModel:(0,p.h)(e.navIndex,"alert-list"),alertRules:f(e),search:g(e.alertRules),isLoading:e.alertRules.isLoading}}),N);class F extends n.PureComponent{constructor(...e){super(...e),P(this,"stateFilters",[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}]),P(this,"onStateFilterChanged",(e=>{v.locationService.partial({state:e.value})})),P(this,"onOpenHowTo",(()=>{d.Z.publish(new b.Dn({component:j}))})),P(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)})),P(this,"onTogglePause",(e=>{this.props.togglePauseAlertRule(e.id,{paused:"paused"!==e.state})})),P(this,"alertStateFilterOption",(({text:e,value:a})=>(0,c.jsx)("option",{value:a,children:e},a)))}componentDidMount(){this.fetchRules()}componentDidUpdate(e){e.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){var e;return null!==(e=this.props.queryParams.state)&&void 0!==e?e:"all"}render(){const{navModel:e,alertRules:a,search:t,isLoading:n}=this.props;return(0,c.jsx)(s.Z,{navModel:e,children:(0,c.jsxs)(s.Z.Contents,{isLoading:n,children:[(0,c.jsxs)("div",{className:"page-action-bar",children:[(0,c.jsx)("div",{className:"gf-form gf-form--grow",children:(0,c.jsx)(o.FilterInput,{placeholder:"Search alerts",value:t,onChange:this.onSearchQueryChange})}),(0,c.jsxs)("div",{className:"gf-form",children:[k||(k=(0,c.jsx)("label",{className:"gf-form-label",htmlFor:"alert-state-filter",children:"States"})),(0,c.jsx)("div",{className:"width-13",children:(0,c.jsx)(o.Select,{inputId:"alert-state-filter",menuShouldPortal:!0,options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()})})]}),_||(_=(0,c.jsx)("div",{className:"page-action-bar__spacer"})),v.config.unifiedAlertingEnabled&&(C||(C=(0,c.jsx)(o.LinkButton,{variant:"primary",href:"alerting/ng/new",children:"Add NG Alert"}))),(0,c.jsx)(o.Button,{variant:"secondary",onClick:this.onOpenHowTo,children:"How to add an alert"})]}),R||(R=(0,c.jsx)(A,{})),(0,c.jsx)(o.VerticalGroup,{spacing:"none",children:a.map((e=>(0,c.jsx)(u,{rule:e,search:t,onTogglePause:()=>this.onTogglePause(e)},e.id)))})]})})}}const T=B(F)},"./public/app/features/alerting/state/actions.ts":(e,a,t)=>{t.d(a,{Au:()=>l,en:()=>o,C2:()=>c,fg:()=>u,c1:()=>d,fA:()=>p,tk:()=>h});var n=t("./packages/grafana-data/src/index.ts"),r=t("./packages/grafana-runtime/src/index.ts"),s=t("./public/app/core/core.ts"),i=t("./public/app/features/alerting/state/reducers.ts");function l(e){return async a=>{a((0,i.gz)());const t=await(0,r.getBackendSrv)().get("/api/alerts",e);a((0,i.Oc)(t))}}function o(e,a){return async t=>{await(0,r.getBackendSrv)().post(`/api/alerts/${e}/pause`,a);t(l({state:(r.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async a=>{try{await(0,r.getBackendSrv)().post("/api/alert-notifications",e),s.h$.emit(n.AppEvents.alertSuccess,["Notification created"]),r.locationService.push("/alerting/notifications")}catch(e){s.h$.emit(n.AppEvents.alertError,[e.data.error])}}}function u(e){return async a=>{try{await(0,r.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),s.h$.emit(n.AppEvents.alertSuccess,["Notification updated"])}catch(e){s.h$.emit(n.AppEvents.alertError,[e.data.error])}}}function d(e){return async(a,t)=>{const n=t().notificationChannel.notificationChannel;await(0,r.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:n.id},e))}}function p(){return async e=>{const a=(await(0,r.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,a)=>e.name>a.name?1:-1));e((0,i.T2)(a))}}function h(e){return async a=>{await a(p());const t=await(0,r.getBackendSrv)().get(`/api/alert-notifications/${e}`);a((0,i.K)(t))}}}}]);
//# sourceMappingURL=AlertRuleList.1f65f885c5a67f13d9d6.js.map