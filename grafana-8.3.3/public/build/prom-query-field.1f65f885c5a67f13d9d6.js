"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6031],{"./public/app/plugins/datasource/prometheus/components/monaco-query-field/MonacoQueryField.tsx":(t,e,i)=>{i.r(e),i.d(e,{default:()=>Nt});var r=i("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),s=i("./packages/grafana-ui/src/index.ts"),n=i("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/3/opt/drone/yarncache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js");const a=function(t){var e=(0,r.useRef)(t);return e.current=t,e};var o={id:"promql",extensions:[".promql"],aliases:["Prometheus","prometheus","prom","Prom","promql","Promql","promQL","PromQL"],mimetypes:[],loader:function(){return Promise.all([i.e(7622),i.e(8578)]).then(i.bind(i,"../../opt/drone/yarncache/monaco-promql-npm-1.7.2-7f61733ebe-54061d5c1c.zip/node_modules/monaco-promql/promql/promql.js"))}},l=i("./packages/grafana-e2e-selectors/src/index.ts");const h=1024;let u=0;const f=new WeakMap;class c{constructor({deserialize:t}={}){this.id=u++,this.deserialize=t||(()=>{throw new Error("This node type doesn't define a deserialize function")})}static string(){return new c({deserialize:t=>t})}static number(){return new c({deserialize:Number})}static flag(){return new c({deserialize:()=>!0})}set(t,e){return t[this.id]=e,t}add(t){return"function"!=typeof t&&(t=O.match(t)),e=>{let i=t(e);return void 0===i?null:[this,i]}}}c.closedBy=new c({deserialize:t=>t.split(" ")}),c.openedBy=new c({deserialize:t=>t.split(" ")}),c.group=new c({deserialize:t=>t.split(" ")});const d=Object.create(null);class O{constructor(t,e,i,r=0){this.name=t,this.props=e,this.id=i,this.flags=r}static define(t){let e=t.props&&t.props.length?Object.create(null):d,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(null==t.name?8:0),r=new O(t.name||"",e,t.id,i);if(t.props)for(let i of t.props)Array.isArray(i)||(i=i(r)),i&&i[0].set(e,i[1]);return r}prop(t){return this.props[t.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(t){if("string"==typeof t){if(this.name==t)return!0;let e=this.prop(c.group);return!!e&&e.indexOf(t)>-1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let r of i.split(" "))e[r]=t[i];return t=>{for(let i=t.prop(c.group),r=-1;r<(i?i.length:0);r++){let s=e[r<0?t.name:i[r]];if(s)return s}}}}O.none=new O("",Object.create(null),0,8);class p{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let r=null;for(let e of t){let t=e(i);t&&(r||(r=Object.assign({},i.props)),t[0].set(r,t[1]))}e.push(r?new O(i.name,r,i.id,i.flags):i)}return new p(e)}}class g{constructor(t,e,i,r){this.type=t,this.children=e,this.positions=i,this.length=r}toString(){let t=this.children.map((t=>t.toString())).join();return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(t,e=0){let i=null!=t&&f.get(this)||this.topNode,r=new v(i);return null!=t&&(r.moveTo(t,e),f.set(this,r._tree)),r}fullCursor(){return new v(this.topNode,!0)}get topNode(){return new m(this,0,0,null)}resolve(t,e=0){return this.cursor(t,e).node}iterate(t){let{enter:e,leave:i,from:r=0,to:s=this.length}=t;for(let t=this.cursor();;){let n=!1;if(t.from<=s&&t.to>=r&&(t.type.isAnonymous||!1!==e(t.type,t.from,t.to))){if(t.firstChild())continue;t.type.isAnonymous||(n=!0)}for(;n&&i&&i(t.type,t.from,t.to),n=t.type.isAnonymous,!t.nextSibling();){if(!t.parent())return;n=!0}}}balance(t=h){return this.children.length<=S?this:X(this.type,O.none,this.children,this.positions,0,this.children.length,0,t,this.length,0)}static build(t){return function(t){var e;let{buffer:i,nodeSet:r,topID:s=0,maxBufferLength:n=h,reused:a=[],minRepeatType:o=r.types.length}=t,l=Array.isArray(i)?new k(i,i.length):i,u=r.types,f=0;function c(t,e,i,s,h){let{id:m,start:b,end:P,size:$}=l,v=b-t;if($<0)return-1==$?(i.push(a[m]),s.push(v)):f=m,void l.next();let y,k,_=u[m];if(P-b<=n&&(k=d(l.pos-e,h))){let e=new Uint16Array(k.size-k.skip),i=l.pos-k.size,s=e.length;for(;l.pos>i;)s=p(k.start,e,s,h);y=new x(e,P-k.start,r,h<0?O.none:u[h]),v=k.start-t}else{let t=l.pos-$;l.next();let e=[],i=[],r=m>=o?m:-1;for(;l.pos>t;)l.id==r?l.next():c(b,t,e,i,r);e.reverse(),i.reverse(),y=r>-1&&e.length>S?X(_,_,e,i,0,e.length,0,n,P-b,f):Q(new g(_,e,i,P-b),f)}i.push(y),s.push(v)}function d(t,e){let i=l.fork(),r=0,s=0,a=0,h=i.end-n,u={size:0,start:0,skip:0};t:for(let n=i.pos-t;i.pos>n;){if(i.id==e){u.size=r,u.start=s,u.skip=a,a+=4,r+=4,i.next();continue}let t=i.size,l=i.pos-t;if(t<0||l<n||i.start<h)break;let f=i.id>=o?4:0,c=i.start;for(i.next();i.pos>l;){if(i.size<0)break t;i.id>=o&&(f+=4),i.next()}s=c,r+=t,a+=f}return(e<0||r==t)&&(u.size=r,u.start=s,u.skip=a),u.size>4?u:void 0}function p(t,e,i,r){let{id:s,start:n,end:a,size:h}=l;if(l.next(),s==r)return i;let u=i;if(h>4){let s=l.pos-(h-4);for(;l.pos>s;)i=p(t,e,i,r)}return s<o&&(e[--i]=u,e[--i]=a-t,e[--i]=n-t,e[--i]=s),i}let m=[],b=[];for(;l.pos>0;)c(t.start||0,0,m,b,-1);let P=null!==(e=t.length)&&void 0!==e?e:m.length?b[0]+m[0].length:0;return new g(u[s],m.reverse(),b.reverse(),P)}(t)}}function Q(t,e){return e&&(t.contextHash=e),t}g.empty=new g(O.none,[],[],0);class x{constructor(t,e,i,r=O.none){this.buffer=t,this.length=e,this.set=i,this.type=r}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],r=this.set.types[e],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),i==(t+=4))return s;let n=[];for(;t<i;)n.push(this.childString(t)),t=this.buffer[t+3];return s+"("+n.join(",")+")"}findChild(t,e,i,r){let{buffer:s}=this,n=-1;for(let a=t;a!=e;a=s[a+3])if(-1e8!=r){let t=s[a+1],e=s[a+2];if(i>0){if(e>r&&(n=a),e>r)break}else if(t<r&&(n=a),e>=r)break}else if(n=a,i>0)break;return n}}class m{constructor(t,e,i,r){this.node=t,this.from=e,this.index=i,this._parent=r}get type(){return this.node.type}get name(){return this.node.type.name}get to(){return this.from+this.node.length}nextChild(t,e,i,r=!1){for(let s=this;;){for(let{children:n,positions:a}=s.node,o=e>0?n.length:-1;t!=o;t+=e){let o=n[t],l=a[t]+s.from;if(-1e8==i||!(e<0?l>=i:l+o.length<=i))if(o instanceof x){let r=o.findChild(0,o.buffer.length,e,-1e8==i?-1e8:i-l);if(r>-1)return new $(new P(s,o,t,l),null,r)}else if(r||!o.type.isAnonymous||y(o)){let n=new m(o,l,t,s);return r||!n.type.isAnonymous?n:n.nextChild(e<0?o.children.length-1:0,e,i)}}if(r||!s.type.isAnonymous)return null;if(t=s.index+e,s=s._parent,!s)return null}}get firstChild(){return this.nextChild(0,1,-1e8)}get lastChild(){return this.nextChild(this.node.children.length-1,-1,-1e8)}childAfter(t){return this.nextChild(0,1,t)}childBefore(t){return this.nextChild(this.node.children.length-1,-1,t)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent?this._parent.nextChild(this.index+1,1,-1):null}get prevSibling(){return this._parent?this._parent.nextChild(this.index-1,-1,-1):null}get cursor(){return new v(this)}resolve(t,e=0){return this.cursor.moveTo(t,e).node}getChild(t,e=null,i=null){let r=b(this,t,e,i);return r.length?r[0]:null}getChildren(t,e=null,i=null){return b(this,t,e,i)}toString(){return this.node.toString()}}function b(t,e,i,r){let s=t.cursor,n=[];if(!s.firstChild())return n;if(null!=i)for(;!s.type.is(i);)if(!s.nextSibling())return n;for(;;){if(null!=r&&s.type.is(r))return n;if(s.type.is(e)&&n.push(s.node),!s.nextSibling())return null==r?n:[]}}class P{constructor(t,e,i,r){this.parent=t,this.buffer=e,this.index=i,this.start=r}}class ${constructor(t,e,i){this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(t,e){let{buffer:i}=this.context,r=i.findChild(this.index+4,i.buffer[this.index+3],t,-1e8==e?-1e8:e-this.context.start);return r<0?null:new $(this.context,this,r)}get firstChild(){return this.child(1,-1e8)}get lastChild(){return this.child(-1,-1e8)}childAfter(t){return this.child(1,t)}childBefore(t){return this.child(-1,t)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,-1)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new $(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new $(this.context,this._parent,t.findChild(e,this.index,-1,-1e8))}get cursor(){return new v(this)}resolve(t,e=0){return this.cursor.moveTo(t,e).node}toString(){return this.context.buffer.childString(this.index)}getChild(t,e=null,i=null){let r=b(this,t,e,i);return r.length?r[0]:null}getChildren(t,e=null,i=null){return b(this,t,e,i)}}class v{constructor(t,e=!1){if(this.full=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof m)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let e=t._parent;e;e=e._parent)this.stack.unshift(e.index);this.bufferNode=t,this.yieldBuf(t.index)}}get name(){return this.type.name}yieldNode(t){return!!t&&(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0)}yieldBuf(t,e){this.index=t;let{start:i,buffer:r}=this.buffer;return this.type=e||r.set.types[r.buffer[t]],this.from=i+r.buffer[t+1],this.to=i+r.buffer[t+2],!0}yield(t){return!!t&&(t instanceof m?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enter(t,e){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,this.full));let{buffer:i}=this.buffer,r=i.findChild(this.index+4,i.buffer[this.index+3],t,-1e8==e?-1e8:e-this.buffer.start);return!(r<0)&&(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enter(1,-1e8)}lastChild(){return this.enter(-1,-1e8)}childAfter(t){return this.enter(1,t)}childBefore(t){return this.enter(-1,t)}parent(){if(!this.buffer)return this.yieldNode(this.full?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.full?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree._parent.nextChild(this._tree.index+t,t,-1e8,this.full));let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let t=i<0?0:this.stack[i]+4;if(this.index!=t)return this.yieldBuf(e.findChild(t,this.index,-1,-1e8))}else{let t=e.buffer[this.index+3];if(t<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(t)}return i<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,-1e8,this.full))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:r}=this;if(r){if(t>0){if(this.index<r.buffer.buffer.length)return!1}else for(let t=0;t<this.index;t++)if(r.buffer.buffer[t+3]<this.index)return!1;({index:e,parent:i}=r)}else({index:e,_parent:i}=this._tree);for(;i;({index:e,_parent:i}=i))for(let r=e+t,s=t<0?-1:i.node.children.length;r!=s;r+=t){let t=i.node.children[r];if(this.full||!t.type.isAnonymous||t instanceof x||y(t))return!1}return!0}move(t){if(this.enter(t,-1e8))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(){return this.move(1)}prev(){return this.move(-1)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;e<0?this.childBefore(t):this.childAfter(t);)if(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t)){this.parent();break}return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let r=this.index,s=this.stack.length;s>=0;){for(let n=t;n;n=n._parent)if(n.index==r){if(r==this.index)return n;e=n,i=s+1;break t}r=this.stack[--s]}for(let t=i;t<this.stack.length;t++)e=new $(this.buffer,e,this.stack[t]);return this.bufferNode=new $(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree.node}}function y(t){return t.children.some((t=>!t.type.isAnonymous||t instanceof x||y(t)))}class k{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new k(this.buffer,this.index)}}const S=8;function X(t,e,i,r,s,n,a,o,l,h){let u=[],f=[];if(l<=o)for(let t=s;t<n;t++)u.push(i[t]),f.push(r[t]-a);else{let t=Math.max(o,Math.ceil(1.5*l/S));for(let l=s;l<n;){let s=l,c=r[l];for(l++;l<n;l++){if(r[l]+i[l].length-c>t)break}if(l==s+1){let r=i[s];if(r instanceof g&&r.type==e&&r.length>t<<1){for(let t=0;t<r.children.length;t++)u.push(r.children[t]),f.push(r.positions[t]+c-a);continue}u.push(r)}else if(l==s+1)u.push(i[s]);else{let t=X(e,e,i,r,s,l,c,o,r[l-1]+i[l-1].length-c,h);e==O.none||_(t.children,e)||(t=Q(new g(O.none,t.children,t.positions,t.length),h)),u.push(t)}f.push(c-a)}}return Q(new g(t,u,f,l),h)}function _(t,e){for(let i of t)if(i.type==e)return!0;return!1}function E(t){return new R(t)}class R{constructor(t,e=t.length){this.string=t,this.length=e}get(t){return t<0||t>=this.length?-1:this.string.charCodeAt(t)}lineAfter(t){if(t<0)return"";let e=this.string.indexOf("\n",t);return this.string.slice(t,e<0?this.length:Math.min(e,this.length))}read(t,e){return this.string.slice(t,Math.min(this.length,e))}clip(t){return new R(this.string,t)}}class C{constructor(t,e,i,r,s,n,a,o,l,h){this.p=t,this.stack=e,this.state=i,this.reducePos=r,this.pos=s,this.score=n,this.buffer=a,this.bufferBase=o,this.curContext=l,this.parent=h}toString(){return`[${this.stack.filter(((t,e)=>e%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let r=t.parser.context;return new C(t,[],e,i,i,0,[],0,r?new w(r,r.start):null,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){let e=t>>19,i=65535&t,{parser:r}=this.p,s=r.dynamicPrecedence(i);if(s&&(this.score+=s),0==e)return i<r.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,4,!0),this.pushState(r.getGoto(this.state,i,!0),this.reducePos),void this.reduceContext(i);let n=this.stack.length-3*(e-1)-(262144&t?6:0),a=this.stack[n-2],o=this.stack[n-1],l=this.bufferBase+this.buffer.length-o;if(i<r.minRepeatTerm||131072&t){let t=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,a,t,l+4,!0)}if(262144&t)this.state=this.stack[n];else{let t=this.stack[n-3];this.state=r.getGoto(t,i,!0)}for(;this.stack.length>n;)this.stack.pop();this.reduceContext(i)}storeNode(t,e,i,r=4,s=!1){if(0==t){let t=this,r=this.buffer.length;if(0==r&&t.parent&&(r=t.bufferBase-t.parent.bufferBase,t=t.parent),r>0&&0==t.buffer[r-4]&&t.buffer[r-1]>-1){if(e==i)return;if(t.buffer[r-2]>=e)return void(t.buffer[r-2]=i)}}if(s&&this.pos!=i){let s=this.buffer.length;if(s>0&&0!=this.buffer[s-4])for(;s>0&&this.buffer[s-2]>i;)this.buffer[s]=this.buffer[s-4],this.buffer[s+1]=this.buffer[s-3],this.buffer[s+2]=this.buffer[s-2],this.buffer[s+3]=this.buffer[s-1],s-=4,r>4&&(r-=4);this.buffer[s]=t,this.buffer[s+1]=e,this.buffer[s+2]=i,this.buffer[s+3]=r}else this.buffer.push(t,e,i,r)}shift(t,e,i){if(131072&t)this.pushState(65535&t,this.pos);else if(0==(262144&t)){let r=this.pos,s=t,{parser:n}=this.p;(i>this.pos||e<=n.maxNode)&&(this.pos=i,n.stateFlag(s,1)||(this.reducePos=i)),this.pushState(s,r),e<=n.maxNode&&this.buffer.push(e,r,i,4),this.shiftContext(e)}else e<=this.p.parser.maxNode&&this.buffer.push(e,this.pos,i,4),this.pos=i}apply(t,e,i){65536&t?this.reduce(t):this.shift(t,e,i)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let r=this.pos;this.reducePos=this.pos=r+t.length,this.pushState(e,r),this.buffer.push(i,r,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this.p.input,this))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),r=t.bufferBase+e;for(;t&&r==t.bufferBase;)t=t.parent;return new C(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,r,this.curContext,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=200}canShift(t){for(let e=new T(this);;){let i=this.p.parser.stateSlot(e.top,4)||this.p.parser.hasAction(e.top,t);if(0==(65536&i))return!0;if(0==i)return!1;e.reduce(i)}}get ruleStart(){for(let t=this.state,e=this.stack.length;;){let i=this.p.parser.stateSlot(t,5);if(!(65536&i))return 0;if(e-=3*(i>>19),(65535&i)<this.p.parser.minRepeatTerm)return this.stack[e+1];t=this.stack[e]}}startOf(t,e){let i=this.state,r=this.stack.length,{parser:s}=this.p;for(;;){let n=s.stateSlot(i,5),a=n>>19,o=65535&n;if(t.indexOf(o)>-1){let t=r-3*(n>>19),i=this.stack[t+1];if(null==e||e>i)return i}if(0==r)return null;0==a?(r-=3,i=this.stack[r]):(r-=3*(a-1),i=s.getGoto(this.stack[r-3],o,!0))}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let i=[];for(let r,s=0;s<e.length;s+=2)(r=e[s+1])!=this.state&&this.p.parser.hasAction(r,t)&&i.push(e[s],r);if(this.stack.length<120)for(let t=0;i.length<8&&t<e.length;t+=2){let r=e[t+1];i.some(((t,e)=>1&e&&t==r))||i.push(e[t],r)}e=i}let i=[];for(let t=0;t<e.length&&i.length<4;t+=2){let r=e[t+1];if(r==this.state)continue;let s=this.split();s.storeNode(0,s.pos,s.pos,4,!0),s.pushState(r,this.pos),s.shiftContext(e[t]),s.score-=200,i.push(s)}return i}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);return 0!=(65536&t)&&(this.p.parser.validAction(this.state,t)||(this.storeNode(0,this.reducePos,this.reducePos,4,!0),this.score-=100),this.reduce(t),!0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2)&&this.forceReduce(););return this}get deadEnd(){if(3!=this.stack.length)return!1;let{parser:t}=this.p;return 65535==t.data[t.stateSlot(this.state,1)]&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this.p.input,this))}reduceContext(t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this.p.input,this))}emitContext(){let t=this.curContext;if(!t.tracker.strict)return;let e=this.buffer.length-1;(e<0||-2!=this.buffer[e])&&this.buffer.push(t.hash,this.reducePos,this.reducePos,-2)}updateContext(t){if(t!=this.curContext.context){let e=new w(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}}class w{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.hash(e)}}var N;!function(t){t[t.Token=200]="Token",t[t.Reduce=100]="Reduce",t[t.MaxNext=4]="MaxNext",t[t.MaxInsertStackDepth=300]="MaxInsertStackDepth",t[t.DampenInsertStackDepth=120]="DampenInsertStackDepth"}(N||(N={}));class T{constructor(t){this.stack=t,this.top=t.state,this.rest=t.stack,this.offset=this.rest.length}reduce(t){let e=65535&t,i=t>>19;0==i?(this.rest==this.stack.stack&&(this.rest=this.rest.slice()),this.rest.push(this.top,0,0),this.offset+=3):this.offset-=3*(i-1);let r=this.stack.p.parser.getGoto(this.rest[this.offset-3],e,!0);this.top=r}}class L{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,0==this.index&&this.maybeNext()}static create(t){return new L(t,t.bufferBase+t.buffer.length,t.buffer.length)}maybeNext(){let t=this.stack.parent;null!=t&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,0==this.index&&this.maybeNext()}fork(){return new L(this.stack,this.pos,this.index)}}class D{constructor(){this.start=-1,this.value=-1,this.end=-1}accept(t,e){this.value=t,this.end=e}}class q{constructor(t,e){this.data=t,this.id=e}token(t,e,i){!function(t,e,i,r,s){let n=0,a=1<<s,o=r.p.parser.dialect;t:for(let s=i.start;0!=(a&t[n]);){let l=t[n+1];for(let e=n+3;e<l;e+=2)if((t[e+1]&a)>0){let n=t[e];if(o.allows(n)&&(-1==i.value||i.value==n||r.p.parser.overrides(n,i.value))){i.accept(n,s);break}}let h=e.get(s++);for(let e=0,i=t[n+2];e<i;){let r=e+i>>1,s=l+r+(r<<1),a=t[s],o=t[s+1];if(h<a)i=r;else{if(!(h>=o)){n=t[s+2];continue t}e=r+1}}break}}(this.data,t,e,i,this.id)}}q.prototype.contextual=q.prototype.fallback=q.prototype.extend=!1;function A(t,e=Uint16Array){if("string"!=typeof t)return t;let i=null;for(let r=0,s=0;r<t.length;){let n=0;for(;;){let e=t.charCodeAt(r++),i=!1;if(126==e){n=65535;break}e>=92&&e--,e>=34&&e--;let s=e-32;if(s>=46&&(s-=46,i=!0),n+=s,i)break;n*=46}i?i[s++]=n:i=new e(n)}return i}const z="undefined"!=typeof process&&/\bparse\b/.test(process.env.LOG);let I=null;function Y(t,e,i){let r=t.cursor(e);for(;;)if(!(i<0?r.childBefore(e):r.childAfter(e)))for(;;){if((i<0?r.to<e:r.from>e)&&!r.type.isError)return i<0?Math.max(0,Math.min(r.to-1,e-5)):Math.min(t.length,Math.max(r.from+1,e+5));if(i<0?r.prevSibling():r.nextSibling())break;if(!r.parent())return i<0?0:t.length}}class M{constructor(t){this.fragments=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?Y(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?Y(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],r=this.index[e];if(r==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=i.children[r],n=this.start[e]+i.positions[r];if(n>t)return this.nextStart=n,null;if(n==t&&n+s.length<=this.safeTo)return n==t&&n>=this.safeFrom?s:null;s instanceof x?(this.index[e]++,this.nextStart=n+s.length):(this.index[e]++,n+s.length>=t&&(this.trees.push(s),this.start.push(n),this.index.push(0)))}}}class W extends D{constructor(){super(...arguments),this.extended=-1,this.mask=0,this.context=0}clear(t){this.start=t,this.value=this.extended=-1}}const U=new D;class V{constructor(t){this.tokens=[],this.mainToken=U,this.actions=[],this.tokens=t.tokenizers.map((t=>new W))}getActions(t,e){let i=0,r=null,{parser:s}=t.p,{tokenizers:n}=s,a=s.stateSlot(t.state,3),o=t.curContext?t.curContext.hash:0;for(let s=0;s<n.length;s++){if(0==(1<<s&a))continue;let l=n[s],h=this.tokens[s];if((!r||l.fallback)&&((l.contextual||h.start!=t.pos||h.mask!=a||h.context!=o)&&(this.updateCachedToken(h,l,t,e),h.mask=a,h.context=o),0!=h.value)){let e=i;if(h.extended>-1&&(i=this.addActions(t,h.extended,h.end,i)),i=this.addActions(t,h.value,h.end,i),!l.extend&&(r=h,i>e))break}}for(;this.actions.length>i;)this.actions.pop();return r||(r=U,r.start=t.pos,t.pos==e.length?r.accept(t.p.parser.eofTerm,t.pos):r.accept(0,t.pos+1)),this.mainToken=r,this.actions}updateCachedToken(t,e,i,r){if(t.clear(i.pos),e.token(r,t,i),t.value>-1){let{parser:e}=i.p;for(let s=0;s<e.specialized.length;s++)if(e.specialized[s]==t.value){let n=e.specializers[s](r.read(t.start,t.end),i);if(n>=0&&i.p.parser.dialect.allows(n>>1)){0==(1&n)?t.value=n>>1:t.extended=n>>1;break}}}else i.pos==r.length?t.accept(i.p.parser.eofTerm,i.pos):t.accept(0,i.pos+1)}putAction(t,e,i,r){for(let e=0;e<r;e+=3)if(this.actions[e]==t)return r;return this.actions[r++]=t,this.actions[r++]=e,this.actions[r++]=i,r}addActions(t,e,i,r){let{state:s}=t,{parser:n}=t.p,{data:a}=n;for(let t=0;t<2;t++)for(let o=n.stateSlot(s,t?2:1);;o+=3){if(65535==a[o]){if(1!=a[o+1]){0==r&&2==a[o+1]&&(r=this.putAction(K(a,o+1),e,i,r));break}o=K(a,o+2)}a[o]==e&&(r=this.putAction(K(a,o+1),e,i,r))}return r}}var B;!function(t){t[t.Distance=5]="Distance",t[t.MaxRemainingPerStep=3]="MaxRemainingPerStep",t[t.MinBufferLengthPrune=200]="MinBufferLengthPrune",t[t.ForceReduceLimit=10]="ForceReduceLimit"}(B||(B={}));class G{constructor(t,e,i,r){this.parser=t,this.input=e,this.startPos=i,this.context=r,this.pos=0,this.recovering=0,this.nextStackID=9812,this.nested=null,this.nestEnd=0,this.nestWrap=null,this.reused=[],this.tokens=new V(t),this.topTerm=t.top[1],this.stacks=[C.start(this,t.top[0],this.startPos)];let s=null==r?void 0:r.fragments;this.fragments=s&&s.length?new M(s):null}advance(){if(this.nested){let t=this.nested.advance();return this.pos=this.nested.pos,t&&(this.finishNested(this.stacks[0],t),this.nested=null),null}let t,e,i,r=this.stacks,s=this.pos,n=this.stacks=[];for(let a=0;a<r.length;a++){let o,l=r[a];for(;;){if(l.pos>s)n.push(l);else if(o=this.checkNest(l))(!i||i.stack.score<l.score)&&(i=o);else{if(this.advanceStack(l,n,r))continue;{t||(t=[],e=[]),t.push(l);let i=this.tokens.mainToken;e.push(i.value,i.end)}}break}}if(i)return this.startNested(i),null;if(!n.length){let e=t&&function(t){let e=null;for(let i of t)i.pos==i.p.input.length&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i);return e}(t);if(e)return this.stackToTree(e);if(this.parser.strict)throw z&&t&&console.log("Stuck with token "+this.parser.getName(this.tokens.mainToken.value)),new SyntaxError("No parse at "+s);this.recovering||(this.recovering=5)}if(this.recovering&&t){let i=this.runRecovery(t,e,n);if(i)return this.stackToTree(i.forceAll())}if(this.recovering){let t=1==this.recovering?1:3*this.recovering;if(n.length>t)for(n.sort(((t,e)=>e.score-t.score));n.length>t;)n.pop();n.some((t=>t.reducePos>s))&&this.recovering--}else if(n.length>1)t:for(let t=0;t<n.length-1;t++){let e=n[t];for(let i=t+1;i<n.length;i++){let r=n[i];if(e.sameState(r)||e.buffer.length>200&&r.buffer.length>200){if(!((e.score-r.score||e.buffer.length-r.buffer.length)>0)){n.splice(t--,1);continue t}n.splice(i--,1)}}}this.pos=n[0].pos;for(let t=1;t<n.length;t++)n[t].pos<this.pos&&(this.pos=n[t].pos);return null}advanceStack(t,e,i){let r=t.pos,{input:s,parser:n}=this,a=z?this.stackID(t)+" -> ":"";if(this.fragments){let e=t.curContext&&t.curContext.tracker.strict,i=e?t.curContext.hash:0;for(let s=this.fragments.nodeAt(r);s;){let r=this.parser.nodeSet.types[s.type.id]==s.type?n.getGoto(t.state,s.type.id):-1;if(r>-1&&s.length&&(!e||(s.contextHash||0)==i))return t.useNode(s,r),z&&console.log(a+this.stackID(t)+` (via reuse of ${n.getName(s.type.id)})`),!0;if(!(s instanceof g)||0==s.children.length||s.positions[0]>0)break;let o=s.children[0];if(!(o instanceof g))break;s=o}}let o=n.stateSlot(t.state,4);if(o>0)return t.reduce(o),z&&console.log(a+this.stackID(t)+` (via always-reduce ${n.getName(65535&o)})`),!0;let l=this.tokens.getActions(t,s);for(let s=0;s<l.length;){let o=l[s++],h=l[s++],u=l[s++],f=s==l.length||!i,c=f?t:t.split();if(c.apply(o,h,u),z&&console.log(a+this.stackID(c)+` (via ${0==(65536&o)?"shift":`reduce of ${n.getName(65535&o)}`} for ${n.getName(h)} @ ${r}${c==t?"":", split"})`),f)return!0;c.pos>r?e.push(c):i.push(c)}return!1}advanceFully(t,e){let i=t.pos;for(;;){let r=this.checkNest(t);if(r)return r;if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return j(t,e),!0}}runRecovery(t,e,i){let r,s=null,n=!1;for(let a=0;a<t.length;a++){let o=t[a],l=e[a<<1],h=e[1+(a<<1)],u=z?this.stackID(o)+" -> ":"";if(o.deadEnd){if(n)continue;n=!0,o.restart(),z&&console.log(u+this.stackID(o)+" (restarted)");let t=this.advanceFully(o,i);if(t){!0!==t&&(r=t);continue}}let f=o.split(),c=u;for(let t=0;f.forceReduce()&&t<10;t++){z&&console.log(c+this.stackID(f)+" (via force-reduce)");let t=this.advanceFully(f,i);if(t){!0!==t&&(r=t);break}z&&(c=this.stackID(f)+" -> ")}for(let t of o.recoverByInsert(l))z&&console.log(u+this.stackID(t)+" (via recover-insert)"),this.advanceFully(t,i);this.input.length>o.pos?(h==o.pos&&(h++,l=0),o.recoverByDelete(l,h),z&&console.log(u+this.stackID(o)+` (via recover-delete ${this.parser.getName(l)})`),j(o,i)):(!s||s.score<o.score)&&(s=o)}if(s)return s;if(r)for(let t of this.stacks)if(t.score>r.stack.score){r=void 0;break}return r&&this.startNested(r),null}forceFinish(){let t=this.stacks[0].split();return this.nested&&this.finishNested(t,this.nested.forceFinish()),this.stackToTree(t.forceAll())}stackToTree(t,e=t.pos){return this.parser.context&&t.emitContext(),g.build({buffer:L.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.startPos,length:e-this.startPos,minRepeatType:this.parser.minRepeatTerm})}checkNest(t){let e=this.parser.findNested(t.state);if(!e)return null;let i=e.value;return"function"==typeof i&&(i=i(this.input,t)),i?{stack:t,info:e,spec:i}:null}startNested(t){let{stack:e,info:i,spec:r}=t;this.stacks=[e],this.nestEnd=this.scanForNestEnd(e,i.end,r.filterEnd),this.nestWrap="number"==typeof r.wrapType?this.parser.nodeSet.types[r.wrapType]:r.wrapType||null,r.startParse?this.nested=r.startParse(this.input.clip(this.nestEnd),e.pos,this.context):this.finishNested(e)}scanForNestEnd(t,e,i){for(let r=t.pos;r<this.input.length;r++)if(U.start=r,U.value=-1,e.token(this.input,U,t),U.value>-1&&(!i||i(this.input.read(r,U.end))))return r;return this.input.length}finishNested(t,e){this.nestWrap?e=new g(this.nestWrap,e?[e]:[],e?[0]:[],this.nestEnd-t.pos):e||(e=new g(O.none,[],[],this.nestEnd-t.pos));let i=this.parser.findNested(t.state);t.useNode(e,this.parser.getGoto(t.state,i.placeholder,!0)),z&&console.log(this.stackID(t)+" (via unnest)")}stackID(t){let e=(I||(I=new WeakMap)).get(t);return e||I.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function j(t,e){for(let i=0;i<e.length;i++){let r=e[i];if(r.pos==t.pos&&r.sameState(t))return void(e[i].score<t.score&&(e[i]=t))}e.push(t)}class F{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||0==this.disabled[t]}}class Z{constructor(t){if(this.bufferLength=h,this.strict=!1,this.cachedDialect=null,13!=t.version)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (13)`);let e=A(t.tokenData),i=t.nodeNames.split(" ");this.minRepeatTerm=i.length,this.context=t.context;for(let e=0;e<t.repeatNodeCount;e++)i.push("");let r=[];for(let t=0;t<i.length;t++)r.push([]);function s(t,e,i){r[t].push([e,e.deserialize(String(i))])}if(t.nodeProps)for(let e of t.nodeProps){let t=e[0];for(let i=1;i<e.length;){let r=e[i++];if(r>=0)s(r,t,e[i++]);else{let n=e[i+-r];for(let a=-r;a>0;a--)s(e[i++],t,n);i++}}}if(this.specialized=new Uint16Array(t.specialized?t.specialized.length:0),this.specializers=[],t.specialized)for(let e=0;e<t.specialized.length;e++)this.specialized[e]=t.specialized[e].term,this.specializers[e]=t.specialized[e].get;this.states=A(t.states,Uint32Array),this.data=A(t.stateData),this.goto=A(t.goto);let n=Object.keys(t.topRules).map((e=>t.topRules[e][1]));this.nodeSet=new p(i.map(((e,i)=>O.define({name:i>=this.minRepeatTerm?void 0:e,id:i,props:r[i],top:n.indexOf(i)>-1,error:0==i,skipped:t.skippedNodes&&t.skippedNodes.indexOf(i)>-1})))),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map((t=>"number"==typeof t?new q(e,t):t)),this.topRules=t.topRules,this.nested=(t.nested||[]).map((([t,e,i,r])=>({name:t,value:e,end:new q(A(i),0),placeholder:r}))),this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}parse(t,e=0,i={}){"string"==typeof t&&(t=E(t));let r=new G(this,t,e,i);for(;;){let t=r.advance();if(t)return t}}startParse(t,e=0,i={}){return"string"==typeof t&&(t=E(t)),new G(this,t,e,i)}getGoto(t,e,i=!1){let r=this.goto;if(e>=r[0])return-1;for(let s=r[e+1];;){let e=r[s++],n=1&e,a=r[s++];if(n&&i)return a;for(let i=s+(e>>1);s<i;s++)if(r[s]==t)return a;if(n)return-1}}hasAction(t,e){let i=this.data;for(let r=0;r<2;r++)for(let s,n=this.stateSlot(t,r?2:1);;n+=3){if(65535==(s=i[n])){if(1!=i[n+1]){if(2==i[n+1])return K(i,n+2);break}s=i[n=K(i,n+2)]}if(s==e||0==s)return K(i,n+1)}return 0}stateSlot(t,e){return this.states[6*t+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}findNested(t){let e=this.stateSlot(t,0);return 4&e?this.nested[e>>10]:null}validAction(t,e){if(e==this.stateSlot(t,4))return!0;for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])return!1;i=K(this.data,i+2)}if(e==K(this.data,i+1))return!0}}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(65535==this.data[i]){if(1!=this.data[i+1])break;i=K(this.data,i+2)}if(0==(1&this.data[i+2])){let t=this.data[i+1];e.some(((e,i)=>1&i&&e==t))||e.push(this.data[i],t)}}return e}overrides(t,e){let i=H(this.data,this.tokenPrecTable,e);return i<0||H(this.data,this.tokenPrecTable,t)<i}configure(t){let e=Object.assign(Object.create(Z.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map((e=>{let i=t.tokenizers.find((t=>t.from==e));return i?i.to:e}))),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),t.nested&&(e.nested=this.nested.map((e=>Object.prototype.hasOwnProperty.call(t.nested,e.name)?{name:e.name,value:t.nested[e.name],end:e.end,placeholder:e.placeholder}:e))),null!=t.strict&&(e.strict=t.strict),null!=t.bufferLength&&(e.bufferLength=t.bufferLength),e}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get hasNested(){return this.nested.length>0}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return null==e?0:e[t]||0}parseDialect(t){if(this.cachedDialect&&this.cachedDialect.source==t)return this.cachedDialect;let e=Object.keys(this.dialects),i=e.map((()=>!1));if(t)for(let r of t.split(" ")){let t=e.indexOf(r);t>=0&&(i[t]=!0)}let r=null;for(let t=0;t<e.length;t++)if(!i[t])for(let i,s=this.dialects[e[t]];65535!=(i=this.data[s++]);)(r||(r=new Uint8Array(this.maxTerm+1)))[i]=1;return this.cachedDialect=new F(t,i,r)}static deserialize(t){return new Z(t)}}function K(t,e){return t[e]|t[e+1]<<16}function H(t,e,i){for(let r,s=e;65535!=(r=t[s]);s++)if(r==i)return s-e;return-1}const J={inf:130,nan:131,bool:1,ignoring:2,on:3,group_left:4,group_right:5,offset:6},tt={avg:7,bottomk:8,count:9,count_values:10,group:11,max:12,min:13,quantile:14,stddev:15,stdvar:16,sum:17,topk:18,by:19,without:20,and:21,or:22,unless:23,start:24,end:25},et={__proto__:null,absent_over_time:275,absent:277,abs:279,avg_over_time:281,ceil:283,changes:285,clamp:287,clamp_max:289,clamp_min:291,count_over_time:293,days_in_month:295,day_of_month:297,day_of_week:299,delta:301,deriv:303,exp:305,floor:307,histogram_quantile:309,holt_winters:311,hour:313,idelta:315,increase:317,irate:319,label_replace:321,label_join:323,last_over_time:325,ln:327,log10:329,log2:331,max_over_time:333,min_over_time:335,minute:337,month:339,predict_linear:341,present_over_time:343,quantile_over_time:345,rate:347,resets:349,round:351,scalar:353,sgn:355,sort:357,sort_desc:359,sqrt:361,stddev_over_time:363,stdvar_over_time:365,sum_over_time:367,timestamp:369,time:371,vector:373,year:375},it=Z.deserialize({version:13,states:"4^OYQPOOO%|QPOOOOQO'#Cz'#CzO&RQPO'#CyQ&^QQOOOOQO'#Dd'#DdO&XQPO'#DcOOQO'#Em'#EmO'hQPO'#EsOYQPO'#EoOYQPO'#ErOOQO'#Eu'#EuO,eQSO'#EvO,mQQO'#EtOOQO'#Et'#EtOOQO'#Cx'#CxOOQO'#De'#DeOOQO'#Dg'#DgOOQO'#Dh'#DhOOQO'#Di'#DiOOQO'#Dj'#DjOOQO'#Dk'#DkOOQO'#Dl'#DlOOQO'#Dm'#DmOOQO'#Dn'#DnOOQO'#Do'#DoOOQO'#Dp'#DpOOQO'#Dq'#DqOOQO'#Dr'#DrOOQO'#Ds'#DsOOQO'#Dt'#DtOOQO'#Du'#DuOOQO'#Dv'#DvOOQO'#Dw'#DwOOQO'#Dx'#DxOOQO'#Dy'#DyOOQO'#Dz'#DzOOQO'#D{'#D{OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[OOQO'#E]'#E]OOQO'#E^'#E^OOQO'#E_'#E_OOQO'#E`'#E`OOQO'#Ea'#EaOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO'#Ee'#EeOOQO'#Ef'#EfOOQO'#Eg'#EgOOQO'#Eh'#EhOOQO'#Ei'#EiOOQO'#Ej'#EjQOQPOOO.TQPO'#C{O.YQPO'#DQO&XQPO,59eO.aQQO,59eO/zQPO,59nO/zQPO,59nO/zQPO,59nO/zQPO,59nO/zQPO,59nO4wQQO,5;VO4|QQO,5;YO5UQPO,5;iOOQO,59},59}OOQO,5;X,5;XO5mQQO,5;ZO5tQQO,5;^O7XQPO'#ExO7gQPO,5;bOOQO'#Ew'#EwOOQO,5;b,5;bOOQO,5;`,5;`O7oQSO'#C|OOQO,59g,59gO7wQPO,59lO8PQQO'#DROOQO,59l,59lOOQO1G/P1G/PO.TQPO'#DVO<}QPO'#DUO=XQPO'#DUOYQPO1G/YOYQPO1G/YOYQPO1G/YOYQPO1G/YOYQPO1G/YO=cQSO1G0qOOQO1G0t1G0tO=kQQO1G0tO=pQPO'#EmOOQO'#FP'#FPOOQO1G1T1G1TO={QPO1G1TOOQO1G0u1G0uOOQO'#Ey'#EyO>QQPO,5;dO>VQSO1G0|OOQO1G0|1G0|OOQO'#DO'#DOO>_QPO,59hOOQO'#C}'#C}OOQO,59h,59hOYQPO,59mOOQO1G/W1G/WOOQO,59q,59qOCWQPO,59pOC_QPO,59pODvQQO7+$tOETQQO7+$tOFcQQO7+$tOFyQQO7+$tOH_QQO7+$tOOQO7+&]7+&]OHxQQO7+&cOOQO7+&`7+&`OIQQPO7+&oOOQO1G1O1G1OOOQO1G0}1G0}OOQO7+&h7+&hOIVQSO1G/SOOQO1G/S1G/SOI_QQO1G/XOOQO1G/[1G/[OIiQPO1G/[OOQO<<I}<<I}ON]QPO<<I}OOQO<<JZ<<JZOOQO1G/T1G/TOOQO7+$n7+$nOOQO7+$v7+$vOOQOAN?iAN?i",stateData:"Nb~O#yOSjOS~OVQOWQOXQOYQOZQO[QO]QO^QO_QO`QOaQObQO!YZO#d_O#vVO#wVO#zXO#}`O$OaO$PbO$QcO$RdO$SeO$TfO$UgO$VhO$WiO$XjO$YkO$ZlO$[mO$]nO$^oO$_pO$`qO$arO$bsO$ctO$duO$evO$fwO$gxO$hyO$izO$j{O$k|O$l}O$m!OO$n!PO$o!QO$p!RO$q!SO$r!TO$s!UO$t!VO$u!WO$v!XO$w!YO$x!ZO$y![O$z!]O${!^O$|!_O$}!`O%O!aO%P!bO%Q!cO%R!dO%UWO%VWO%WVO%Y[O~O!YZO~Oc!fOd!fO#z!gO~OU!pOe!mOf!nOg!mOw!jOz!jO{!jO|!jO}!kO!O!kO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO#r!qO%S!oO~O#v!sO#w!sO%W!sOV#gXW#gXX#gXY#gXZ#gX[#gX]#gX^#gX_#gX`#gXa#gXb#gX!Y#gX#d#gX#v#gX#w#gX#z#gX#}#gX$O#gX$P#gX$Q#gX$R#gX$S#gX$T#gX$U#gX$V#gX$W#gX$X#gX$Y#gX$Z#gX$[#gX$]#gX$^#gX$_#gX$`#gX$a#gX$b#gX$c#gX$d#gX$e#gX$f#gX$g#gX$h#gX$i#gX$j#gX$k#gX$l#gX$m#gX$n#gX$o#gX$p#gX$q#gX$r#gX$s#gX$t#gX$u#gX$v#gX$w#gX$x#gX$y#gX$z#gX${#gX$|#gX$}#gX%O#gX%P#gX%Q#gX%R#gX%U#gX%V#gX%W#gX%Y#gX~Os!vO%Z!yO~O%Y[OU#hXe#hXf#hXg#hXw#hXz#hX{#hX|#hX}#hX!O#hX!P#hX!Q#hX!R#hX!S#hX!T#hX!U#hX#r#hX#u#hX%S#hX#|#hX#{#hX~O#z!{O~O#|#PO~PYOc!fOd!fOUmaemafmagmawmazma{ma|ma}ma!Oma!Pma!Qma!Rma!Sma!Tma!Uma#rma#uma%Sma#|ma#{ma~OP#TOQ#ROR#ROVxPWxPXxPYxPZxP[xP]xP^xP_xP`xPaxPbxP!YxP#dxP#vxP#wxP#zxP#}xP$OxP$PxP$QxP$RxP$SxP$TxP$UxP$VxP$WxP$XxP$YxP$ZxP$[xP$]xP$^xP$_xP$`xP$axP$bxP$cxP$dxP$exP$fxP$gxP$hxP$ixP$jxP$kxP$lxP$mxP$nxP$oxP$pxP$qxP$rxP$sxP$txP$uxP$vxP$wxP$xxP$yxP$zxP${xP$|xP$}xP%OxP%PxP%QxP%RxP%UxP%VxP%WxP%YxP~O#`#ZO~O!O#]O#`#[O~Oh#_Oi#_O#vVO#wVO%U#^O%V#^O%WVO~O#|#bO~P&^Ow!jOU#fae#faf#fag#faz#fa{#fa|#fa}#fa!O#fa!P#fa!Q#fa!R#fa!S#fa!T#fa!U#fa#r#fa#u#fa%S#fa#|#fa#{#fa~O!U#cO#n#cO#o#cO#p#cO~O#{#eO%Z#fO~Os#gO#|#jO~O#{#kO#|#lO~O#{uX#|uX~P&^OVxXWxXXxXYxXZxX[xX]xX^xX_xX`xXaxXbxX!YxX#dxX#vxX#wxX#zxX#}xX$OxX$PxX$QxX$RxX$SxX$TxX$UxX$VxX$WxX$XxX$YxX$ZxX$[xX$]xX$^xX$_xX$`xX$axX$bxX$cxX$dxX$exX$fxX$gxX$hxX$ixX$jxX$kxX$lxX$mxX$nxX$oxX$pxX$qxX$rxX$sxX$txX$uxX$vxX$wxX$xxX$yxX$zxX${xX$|xX$}xX%OxX%PxX%QxX%RxX%UxX%VxX%WxX%YxX~OS#nOT#nO~P8ZOQ#ROR#RO~P8ZO%T#uO%X#vO~O#`#wO~O#v!sO#w!sO%W!sO~O#z#xO~O#d#yO~Os!vO%Z#{O~O#{#|O#|#}O~OVxaWxaXxaYxaZxa[xa]xa^xa_xa`xaaxabxa!Yxa#dxa#vxa#wxa#}xa$Oxa$Pxa$Qxa$Rxa$Sxa$Txa$Uxa$Vxa$Wxa$Xxa$Yxa$Zxa$[xa$]xa$^xa$_xa$`xa$axa$bxa$cxa$dxa$exa$fxa$gxa$hxa$ixa$jxa$kxa$lxa$mxa$nxa$oxa$pxa$qxa$rxa$sxa$txa$uxa$vxa$wxa$xxa$yxa$zxa${xa$|xa$}xa%Oxa%Pxa%Qxa%Rxa%Uxa%Vxa%Wxa%Yxa~O#z!{O~P>gOS$QOT$QO#zxa~P>gOw!jOUvqevqfvqgvq}vq!Ovq!Pvq!Qvq!Rvq!Svq!Tvq!Uvq#rvq#uvq%Svq#|vq#{vq~Ozvq{vq|vq~PClOz!jO{!jO|!jO~PClOw!jOz!jO{!jO|!jO}!kO!O!kOUvqevqfvqgvq#rvq#uvq%Svq#|vq#{vq~O!Pvq!Qvq!Rvq!Svq!Tvq!Uvq~PEbO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO~PEbOe!mOg!mOw!jOz!jO{!jO|!jO}!kO!O!kO!P!lO!Q!lO!R!lO!S!lO!T!lO!U!lO~OUvqfvq#rvq#uvq%Svq#|vq#{vq~PGaO#`$SO%T$RO~O#|$TO~Os#gO#|$VO~O#{ui#|ui~P&^O#z!{OVxiWxiXxiYxiZxi[xi]xi^xi_xi`xiaxibxi!Yxi#dxi#vxi#wxi#}xi$Oxi$Pxi$Qxi$Rxi$Sxi$Txi$Uxi$Vxi$Wxi$Xxi$Yxi$Zxi$[xi$]xi$^xi$_xi$`xi$axi$bxi$cxi$dxi$exi$fxi$gxi$hxi$ixi$jxi$kxi$lxi$mxi$nxi$oxi$pxi$qxi$rxi$sxi$txi$uxi$vxi$wxi$xxi$yxi$zxi${xi$|xi$}xi%Oxi%Pxi%Qxi%Rxi%Uxi%Vxi%Wxi%Yxi~O%T$XO~O",goto:"(e#tPPPPPPPPPPPPPPPPPPPPPPPPPPPP#u$e$q$}%T%a%dP%j%s$eP%v&VPPPPPPPPPPP$e&a&mP&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m&m$eP&y$e$eP$e$e'Y$e'f'u(U(X(_PPP$eP(bQSOQ!tXQ!uYQ#O!gQ#p#UQ#q#VQ#r#WQ#s#XQ#t#YR$O#ke_OXY!g#U#V#W#X#Y#keROXY!g#U#V#W#X#Y#kQ!hRR#Q!iQ!|!fQ#m#RQ$P#nR$W$QR#h!{Q#i!{R$U#|Q!iRQ!rUR#Q!hR!}!gQ#U!jQ#V!kQ#W!lQ#X!mR#Y!nY#S!j!k!l!m!nR#o#TeUOXY!g#U#V#W#X#Y#keTOXY!g#U#V#W#X#Y#kd_OXY!g#U#V#W#X#Y#kR#`!qeYOXY!g#U#V#W#X#Y#kd]OXY!g#U#V#W#X#Y#kR!ePd^OXY!g#U#V#W#X#Y#kR!z]R!w[Q!x[R#z#eR#d!vR#a!q",nodeNames:"⚠ Bool Ignoring On GroupLeft GroupRight Offset Avg Bottomk Count CountValues Group Max Min Quantile Stddev Stdvar Sum Topk By Without And Or Unless Start End LineComment PromQL Expr AggregateExpr AggregateOp AggregateModifier GroupingLabels GroupingLabelList GroupingLabel LabelName FunctionCallBody FunctionCallArgs BinaryExpr Pow BinModifiers OnOrIgnoring Mul Div Mod Add Sub Eql Gte Gtr Lte Lss Neq FunctionCall FunctionIdentifier AbsentOverTime Identifier Absent Abs AvgOverTime Ceil Changes Clamp ClampMax ClampMin CountOverTime DaysInMonth DayOfMonth DayOfWeek Delta Deriv Exp Floor HistogramQuantile HoltWinters Hour Idelta Increase Irate LabelReplace LabelJoin LastOverTime Ln Log10 Log2 MaxOverTime MinOverTime Minute Month PredictLinear PresentOverTime QuantileOverTime Rate Resets Round Scalar Sgn Sort SortDesc Sqrt StddevOverTime StdvarOverTime SumOverTime Timestamp Time Vector Year MatrixSelector Duration NumberLiteral OffsetExpr ParenExpr StringLiteral SubqueryExpr UnaryExpr UnaryOp VectorSelector MetricIdentifier LabelMatchers LabelMatchList LabelMatcher MatchOp EqlSingle EqlRegex NeqRegex StepInvariantExpr At AtModifierPreprocessors MetricName",maxTerm:195,skippedNodes:[0,26],repeatNodeCount:0,tokenData:"! j~RwX^#lpq#lqr$ars$tst%huv%swx%xxy&gyz&lz{&q{|&v|}&}}!O'S!O!P'Z!P!Q(Z!Q!R(`!R![)f![!]LZ!^!_MV!_!`Md!`!aMy!b!cNW!c!}N]!}#ONs#P#QNx#Q#RN}#R#SN]#S#T! S#T#oN]#o#p! `#q#r! e#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~#qY#y~X^#lpq#l#y#z#l$f$g#l#BY#BZ#l$IS$I_#l$I|$JO#l$JT$JU#l$KV$KW#l&FU&FV#l~$dQ!_!`$j#r#s$o~$oO!U~~$tO#p~~$yU#d~OY$tZr$trs%]s#O$t#O#P%b#P~$t~%bO#d~~%ePO~$t~%mQj~OY%hZ~%h~%xO|~~%}U#d~OY%xZw%xwx%]x#O%x#O#P&a#P~%x~&dPO~%x~&lO#z~~&qO#|~~&vOz~R&}O%VP}Q~'SO#{~R'ZO%UP!OQP'^P!Q!['aP'fR%WP!Q!['a!g!h'o#X#Y'oP'rR{|'{}!O'{!Q![(RP(OP!Q![(RP(WP%WP!Q![(R~(`O{~R(eZ%WP!O!P)W!Q![)f!g!h'o#W#X*Z#X#Y'o#[#].i#a#b0l#g#h1r#k#l2Z#l#mKo#m#n:pP)]R%WP!Q![)W!g!h'o#X#Y'oR)kY%WP!O!P)W!Q![)f!g!h'o#W#X*Z#X#Y'o#[#].i#a#b0l#g#h1r#k#l2Z#m#n:pQ*`P#`Q!Q![*cQ*fS!Q![*c#[#]*r#a#b,z#g#h.QQ*wP#`Q!Q![*zQ*}R!Q![*z#a#b+W#g#h,cQ+]Q#`Q!Q![+c#g#h+uQ+fR!Q![+c#a#b+o#g#h+zQ+rP#g#h+uQ+zO#`QQ,PP#`Q!Q![,SQ,VQ!Q![,S#a#b,]Q,`P#g#h+uQ,hP#`Q!Q![,kQ,nQ!Q![,k#a#b,tQ,wP#g#h+uQ-PQ#`Q!Q![-V#g#h+uQ-YR!Q![-V#a#b-c#g#h-iQ-fP#g#h+uQ-nP#`Q!Q![-qQ-tQ!Q![-q#a#b-zQ-}P#g#h+uQ.VP#`Q!Q![.YQ.]Q!Q![.Y#a#b.cQ.fP#g#h+uQ.nP#`Q!Q![.qQ.tR!Q![.q#a#b.}#g#h0TQ/SQ#`Q!Q![/Y#g#h+uQ/]R!Q![/Y#a#b/f#g#h/lQ/iP#g#h+uQ/qP#`Q!Q![/tQ/wQ!Q![/t#a#b/}Q0QP#g#h+uQ0YP#`Q!Q![0]Q0`Q!Q![0]#a#b0fQ0iP#g#h+uQ0qQ#`Q!Q![0w#g#h+uQ0zR!Q![0w#a#b1T#g#h1ZQ1WP#g#h+uQ1`P#`Q!Q![1cQ1fQ!Q![1c#a#b1lQ1oP#g#h+uQ1wP#`Q!Q![1zQ1}Q!Q![1z#a#b2TQ2WP#g#h+uQ2`P#`Q!Q![2cQ2fT!Q![2c#W#X2u#[#]7O#a#b9R#g#h:XQ2zP#`Q!Q![2}Q3QS!Q![2}#[#]3^#a#b5a#g#h6gQ3cP#`Q!Q![3fQ3iR!Q![3f#a#b3r#g#h4xQ3wQ#`Q!Q![3}#g#h+uQ4QR!Q![3}#a#b4Z#g#h4aQ4^P#g#h+uQ4fP#`Q!Q![4iQ4lQ!Q![4i#a#b4rQ4uP#g#h+uQ4}P#`Q!Q![5QQ5TQ!Q![5Q#a#b5ZQ5^P#g#h+uQ5fQ#`Q!Q![5l#g#h+uQ5oR!Q![5l#a#b5x#g#h6OQ5{P#g#h+uQ6TP#`Q!Q![6WQ6ZQ!Q![6W#a#b6aQ6dP#g#h+uQ6lP#`Q!Q![6oQ6rQ!Q![6o#a#b6xQ6{P#g#h+uQ7TP#`Q!Q![7WQ7ZR!Q![7W#a#b7d#g#h8jQ7iQ#`Q!Q![7o#g#h+uQ7rR!Q![7o#a#b7{#g#h8RQ8OP#g#h+uQ8WP#`Q!Q![8ZQ8^Q!Q![8Z#a#b8dQ8gP#g#h+uQ8oP#`Q!Q![8rQ8uQ!Q![8r#a#b8{Q9OP#g#h+uQ9WQ#`Q!Q![9^#g#h+uQ9aR!Q![9^#a#b9j#g#h9pQ9mP#g#h+uQ9uP#`Q!Q![9xQ9{Q!Q![9x#a#b:RQ:UP#g#h+uQ:^P#`Q!Q![:aQ:dQ!Q![:a#a#b:jQ:mP#g#h+uQ:uP#`Q!Q![:xQ:{U!Q![:x#W#X;_#[#]?h#a#bAk#g#hBq#k#lCYQ;dP#`Q!Q![;gQ;jS!Q![;g#[#];v#a#b=y#g#h?PQ;{P#`Q!Q![<OQ<RR!Q![<O#a#b<[#g#h=bQ<aQ#`Q!Q![<g#g#h+uQ<jR!Q![<g#a#b<s#g#h<yQ<vP#g#h+uQ=OP#`Q!Q![=RQ=UQ!Q![=R#a#b=[Q=_P#g#h+uQ=gP#`Q!Q![=jQ=mQ!Q![=j#a#b=sQ=vP#g#h+uQ>OQ#`Q!Q![>U#g#h+uQ>XR!Q![>U#a#b>b#g#h>hQ>eP#g#h+uQ>mP#`Q!Q![>pQ>sQ!Q![>p#a#b>yQ>|P#g#h+uQ?UP#`Q!Q![?XQ?[Q!Q![?X#a#b?bQ?eP#g#h+uQ?mP#`Q!Q![?pQ?sR!Q![?p#a#b?|#g#hASQ@RQ#`Q!Q![@X#g#h+uQ@[R!Q![@X#a#b@e#g#h@kQ@hP#g#h+uQ@pP#`Q!Q![@sQ@vQ!Q![@s#a#b@|QAPP#g#h+uQAXP#`Q!Q![A[QA_Q!Q![A[#a#bAeQAhP#g#h+uQApQ#`Q!Q![Av#g#h+uQAyR!Q![Av#a#bBS#g#hBYQBVP#g#h+uQB_P#`Q!Q![BbQBeQ!Q![Bb#a#bBkQBnP#g#h+uQBvP#`Q!Q![ByQB|Q!Q![By#a#bCSQCVP#g#h+uQC_P#`Q!Q![CbQCeT!Q![Cb#W#XCt#[#]G}#a#bJQ#g#hKWQCyP#`Q!Q![C|QDPS!Q![C|#[#]D]#a#bF`#g#hGfQDbP#`Q!Q![DeQDhR!Q![De#a#bDq#g#hEwQDvQ#`Q!Q![D|#g#h+uQEPR!Q![D|#a#bEY#g#hE`QE]P#g#h+uQEeP#`Q!Q![EhQEkQ!Q![Eh#a#bEqQEtP#g#h+uQE|P#`Q!Q![FPQFSQ!Q![FP#a#bFYQF]P#g#h+uQFeQ#`Q!Q![Fk#g#h+uQFnR!Q![Fk#a#bFw#g#hF}QFzP#g#h+uQGSP#`Q!Q![GVQGYQ!Q![GV#a#bG`QGcP#g#h+uQGkP#`Q!Q![GnQGqQ!Q![Gn#a#bGwQGzP#g#h+uQHSP#`Q!Q![HVQHYR!Q![HV#a#bHc#g#hIiQHhQ#`Q!Q![Hn#g#h+uQHqR!Q![Hn#a#bHz#g#hIQQH}P#g#h+uQIVP#`Q!Q![IYQI]Q!Q![IY#a#bIcQIfP#g#h+uQInP#`Q!Q![IqQItQ!Q![Iq#a#bIzQI}P#g#h+uQJVQ#`Q!Q![J]#g#h+uQJ`R!Q![J]#a#bJi#g#hJoQJlP#g#h+uQJtP#`Q!Q![JwQJzQ!Q![Jw#a#bKQQKTP#g#h+uQK]P#`Q!Q![K`QKcQ!Q![K`#a#bKiQKlP#g#h+uPKrR!Q![K{!c!iK{#T#ZK{PLQR%WP!Q![K{!c!iK{#T#ZK{VLbT%XS!YR!Q![Lq![!]Lq!c!}Lq#R#SLq#T#oLqRLvT!YR!Q![Lq![!]Lq!c!}Lq#R#SLq#T#oLq~M[P!T~!_!`M_~MdO!S~~MiQ#nP!_!`Mo#r#sMtQMtO!PQ~MyO#o~~NOP!R~!_!`NR~NWO!Q~~N]O#r~VNdT!YRsS!Q![N]![!]Lq!c!}N]#R#SN]#T#oN]~NxO%S~~N}O%T~~! SOw~~! VRO#S! S#S#T%]#T~! S~! eO%Y~~! jO%Z~",tokenizers:[0,1,2],topRules:{PromQL:[0,27],MetricName:[1,128]},specialized:[{term:56,get:(t,e)=>((t,e)=>J[t.toLowerCase()]||-1)(t)<<1},{term:56,get:(t,e)=>((t,e)=>tt[t.toLowerCase()]||-1)(t)<<1|1},{term:56,get:t=>et[t]||-1}],tokenPrec:0});class rt extends Error{constructor(t){super("should never happen")}}function st(t,e){switch(e){case"parent":return t.parent;case"firstChild":return t.firstChild;case"lastChild":return t.lastChild;case"nextSibling":return t.nextSibling;default:throw new rt(e)}}function nt(t,e){let i=t;for(const[t,r]of e){if(i=st(i,t),null===i)return null;if(i.type.name!==r)return null}return i}function at(t,e){return e.slice(t.from,t.to)}function ot(t,e){return t.every(((t,i)=>t===e[i]))}const lt="⚠",ht=[{path:["LabelMatchers","VectorSelector"],fun:function(t,e,i){if(function(t){return null!==dt(t,lt)}(t))return null;const r=nt(t,[["firstChild","LabelMatchList"]]);if(null!==r){if(!e.slice(r.to,i).includes(","))return null}const s=nt(t,[["parent","VectorSelector"],["firstChild","MetricIdentifier"],["firstChild","Identifier"]]),n=ct(t,e);if(null===s)return{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:n};return{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",metricName:at(s,e),otherLabels:n}}},{path:["PromQL"],fun:function(t,e,i){return{type:"AT_ROOT"}}},{path:["FunctionCallBody"],fun:function(t,e,i){return{type:"IN_FUNCTION"}}},{path:["StringLiteral","LabelMatcher"],fun:Ot},{path:[lt,"LabelMatcher"],fun:Ot},{path:[lt,"MatrixSelector"],fun:function(t,e,i){return{type:"IN_DURATION"}}},{path:["GroupingLabels"],fun:function(t,e,i){const r=nt(t,[["parent","AggregateModifier"],["parent","AggregateExpr"]]);if(null===r)return null;const s=r.getChild("FunctionCallBody");if(null===s)return null;const n=dt(s,"MetricIdentifier");if(null===n)return null;const a=nt(n,[["firstChild","Identifier"]]);if(null===a)return null;return{type:"IN_GROUPING",metricName:at(a,e),otherLabels:[]}}}],ut=new Map([["EqlSingle","="],["EqlRegex","=~"],["Neq","!="],["NeqRegex","!~"]]);function ft(t,e){if("LabelMatcher"!==t.type.name)return null;const i=nt(t,[["firstChild","LabelName"]]);if(null===i)return null;const r=nt(i,[["nextSibling","MatchOp"]]);if(null===r)return null;const s=function(t){var e;const i=t.firstChild;return null===i?null:null!==(e=ut.get(i.name))&&void 0!==e?e:null}(r);if(null===s)return null;const n=nt(t,[["lastChild","StringLiteral"]]);if(null===n)return null;const a=at(i,e),o=function(t){const e=t.slice(1,t.length-1);if(t.startsWith('"')&&t.endsWith('"'))return e.replace(/\\"/,'"');if(t.startsWith("'")&&t.endsWith("'"))return e.replace(/\\'/,"'");if(t.startsWith("`")&&t.endsWith("`"))return e;throw new Error("FIXME: invalid string literal")}(at(n,e));return{name:a,value:o,op:s}}function ct(t,e){if("LabelMatchers"!==t.type.name)return[];let i=nt(t,[["firstChild","LabelMatchList"]]);const r=[];for(;null!==i;){const t=nt(i,[["lastChild","LabelMatcher"]]);if(null===t)return[];const s=ft(t,e);null!==s&&r.push(s),i=nt(i,[["firstChild","LabelMatchList"]])}return r.reverse(),r}function dt(t,e){if(t.type.name===e)return t;const i=function(t){let e=t.firstChild;const i=[];for(;null!==e;)i.push(e),e=e.nextSibling;return i}(t);for(const t of i){const i=dt(t,e);if(null!==i)return i}return null}function Ot(t,e,i){const r=!t.type.isError,s=nt(t,[["parent","LabelMatcher"]]);if(null===s)return null;const n=nt(s,[["firstChild","LabelName"]]);if(null===n)return null;const a=at(n,e),o=nt(s,[["parent","LabelMatchList"]]);if(null===o)return null;let l=o,h=null;for(;null===h;){const t=l.parent;if(null===t)return null;const{name:e}=t.type;switch(e){case"LabelMatchList":l=t;continue;case"LabelMatchers":h=t;continue;default:return null}}const u=ct(h,e).filter((t=>t.name!==a)),f=nt(h,[["parent","VectorSelector"],["firstChild","MetricIdentifier"],["firstChild","Identifier"]]);if(null===f)return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:a,betweenQuotes:r,otherLabels:u};return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",metricName:at(f,e),labelName:a,betweenQuotes:r,otherLabels:u}}var pt=i("./public/app/plugins/datasource/prometheus/promql.ts"),gt=i("./public/app/plugins/datasource/prometheus/language_utils.ts");async function Qt(t){return(await t.getAllMetricNames()).map((t=>({type:"METRIC_NAME",label:t.name,insertText:t.name,detail:`${t.name} : ${t.type}`,documentation:t.help})))}const xt=pt.r8.map((t=>{var e;return{type:"FUNCTION",label:t.label,insertText:null!==(e=t.insertText)&&void 0!==e?e:"",detail:t.detail,documentation:t.documentation}}));async function mt(t){const e=await Qt(t);return[...xt,...e]}const bt=["$__interval","$__range","$__rate_interval","1m","5m","10m","30m","1h","1d"].map((t=>({type:"DURATION",label:t,insertText:t})));function Pt(t,e){const i=[...e];void 0!==t&&i.push({name:"__name__",value:t,op:"="});return`{${i.map((t=>`${t.name}${t.op}"${(0,gt.U9)(t.value)}"`)).join(",")}}`}async function $t(t,e,i,r,s){const n=await async function(t,e,i){if(void 0===t&&0===e.length)return i.getAllLabelNames();{const r=Pt(t,e),s=await i.getSeries(r),n=Object.keys(s),a=new Set(e.map((t=>t.name)));return n.filter((t=>!a.has(t)))}}(t,r,s);return n.map((t=>({type:"LABEL_NAME",label:t,insertText:`${t}${e}`,triggerOnInsert:i})))}async function vt(t,e,i,r,s){const n=await async function(t,e,i,r){if(void 0===t&&0===i.length)return r.getLabelValues(e);{var s;const n=Pt(t,i);return null!==(s=(await r.getSeries(n))[e])&&void 0!==s?s:[]}}(t,e,r,s);return n.map((t=>({type:"LABEL_VALUE",label:t,insertText:i?t:`"${t}"`})))}async function yt(t,e){switch(t.type){case"IN_DURATION":return bt;case"IN_FUNCTION":case"AT_ROOT":return mt(e);case"EMPTY":{const t=await Qt(e),i=await async function(t){return(await t.getHistory()).slice(0,10).map((t=>({type:"HISTORY",label:t,insertText:t})))}(e);return[...i,...xt,...t]}case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return async function(t,e,i){return $t(t,"=",!0,e,i)}(t.metricName,t.otherLabels,e);case"IN_GROUPING":return async function(t,e,i){return $t(t,"",!1,e,i)}(t.metricName,t.otherLabels,e);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return vt(t.metricName,t.labelName,t.betweenQuotes,t.otherLabels,e);default:throw new rt(t)}}function kt(t,e){switch(t){case"DURATION":return e.languages.CompletionItemKind.Unit;case"FUNCTION":return e.languages.CompletionItemKind.Variable;case"HISTORY":return e.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return e.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return e.languages.CompletionItemKind.EnumMember;case"METRIC_NAME":return e.languages.CompletionItemKind.Constructor;default:throw new rt(t)}}function St(t,e){return{triggerCharacters:["{",",","[","(","=","~"," ",'"'],provideCompletionItems:(i,r)=>{const s=i.getWordAtPosition(r),n=null!=s?t.Range.lift({startLineNumber:r.lineNumber,endLineNumber:r.lineNumber,startColumn:s.startColumn,endColumn:s.endColumn}):t.Range.fromPositions(r),a={column:r.column,lineNumber:r.lineNumber},o=i.getOffsetAt(a),l=function(t,e){if(""===t)return{type:"EMPTY"};const i=it.parse(t),r=function(t,e){const i=t.cursor(e);for(;;){if(i.from===e&&i.to===e){const{node:t}=i;if(t.type.isError)return t}if(!i.next())break}return null}(i,e),s=null!=r?r.cursor:i.cursor(e),n=s.node,a=[s.name];for(;s.parent();)a.push(s.name);for(let i of ht)if(ot(i.path,a))return i.fun(n,t,e);return null}(i.getValue(),o);return(null!=l?yt(l,e):Promise.resolve([])).then((e=>{const i=e.length.toString().length;return{suggestions:e.map(((e,r)=>({kind:kt(e.type,t),label:e.label,insertText:e.insertText,detail:e.detail,documentation:e.documentation,sortText:r.toString().padStart(i,"0"),range:n,command:e.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0})))}}))}}}function Xt(){const t=new Map;return t.set("expandSuggestionDocs",(!0).toString()),{onDidChangeValue:t=>{},onDidChangeTarget:t=>{},onWillSaveState:t=>{},get:(e,i,r)=>{var s;return null!==(s=t.get(e))&&void 0!==s?s:r},getBoolean:(e,i,r)=>{const s=t.get(e);return void 0!==s?"true"===s:r},getNumber:(e,i,r)=>{const s=t.get(e);return void 0!==s?parseInt(s,10):r},store:(e,i,r,s)=>{null==i?t.delete(e):t.set(e,i.toString())},remove:(e,i)=>{t.delete(e)},keys:(e,i)=>Array.from(t.keys()),logStorage:()=>{console.log("logStorage: not implemented")},migrate:()=>Promise.resolve(void 0),isNew:t=>!0,flush:t=>Promise.resolve(void 0)}}let _t=null;var Et=i("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const Rt={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,suggest:{showWords:!1},suggestFontSize:12,wordWrap:"on"},Ct=o.id;let wt=!1;const Nt=t=>{const e=(0,r.useRef)((null===_t&&(_t={storageService:Xt()}),_t)),i=(0,r.useRef)(null),{languageProvider:h,history:u,onBlur:f,onRunQuery:c,initialValue:d}=t,O=a(h),p=a(u),g=a(c),Q=a(f),x=(0,r.useRef)(null),m=(t=>({container:n.css`
      border-radius: ${t.shape.borderRadius()};
      border: 1px solid ${t.components.input.borderColor};
    `}))((0,s.useTheme2)());return(0,r.useEffect)((()=>()=>{var t;null===(t=x.current)||void 0===t||t.call(x)}),[]),(0,Et.jsx)("div",{"aria-label":l.wl.components.QueryField.container,className:m.container,ref:i,children:(0,Et.jsx)(s.ReactMonacoEditor,{overrideServices:e.current,options:Rt,language:"promql",value:d,beforeMount:t=>{!function(t){if(!1===wt){wt=!0;const{aliases:e,extensions:i,mimetypes:r,loader:s}=o;t.languages.register({id:Ct,aliases:e,extensions:i,mimetypes:r}),s().then((e=>{t.languages.setMonarchTokensProvider(Ct,e.language),t.languages.setLanguageConfiguration(Ct,e.languageConfiguration)}))}}(t)},onMount:(t,e)=>{t.onDidBlurEditorWidget((()=>{Q.current(t.getValue())}));const r=St(e,{getSeries:t=>O.current.getSeries(t),getHistory:()=>Promise.resolve(p.current.map((t=>t.query.expr)).filter((t=>void 0!==t))),getAllMetricNames:()=>{const{metrics:t,metricsMetadata:e}=O.current,i=t.map((t=>{var i,r;const s=null==e?void 0:e[t];return{name:t,help:null!==(i=null==s?void 0:s.help)&&void 0!==i?i:"",type:null!==(r=null==s?void 0:s.type)&&void 0!==r?r:""}}));return Promise.resolve(i)},getAllLabelNames:()=>Promise.resolve(O.current.getLabelKeys()),getLabelValues:t=>O.current.getLabelValues(t)}),s=Object.assign({},r,{provideCompletionItems:(e,i,s,n)=>{var a;return(null===(a=t.getModel())||void 0===a?void 0:a.id)!==e.id?{suggestions:[]}:r.provideCompletionItems(e,i,s,n)}}),{dispose:n}=e.languages.registerCompletionItemProvider(Ct,s);x.current=n;const a=()=>{const e=i.current;if(null!==e){const i=t.getContentHeight();e.style.height=`${i+2}px`,e.style.width="100%";const r=e.clientWidth;t.layout({width:r,height:i})}};t.onDidContentSizeChange(a),a(),t.addCommand(e.KeyMod.Shift|e.KeyCode.Enter,(()=>{g.current(t.getValue())}))}})})}}}]);
//# sourceMappingURL=prom-query-field.1f65f885c5a67f13d9d6.js.map