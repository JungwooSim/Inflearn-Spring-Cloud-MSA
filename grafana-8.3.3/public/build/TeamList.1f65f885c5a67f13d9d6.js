"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{"./public/app/core/components/connectWithCleanUp.tsx":(e,t,a)=>{a.d(t,{$:()=>d});var s=a("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),n=a("./public/app/core/actions/cleanUp.ts"),r=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),i=a("../../opt/drone/yarncache/hoist-non-react-statics-npm-3.3.2-e7b709e6c1-b153827042.zip/node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"),c=a.n(i),o=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const d=(e,t,a)=>i=>{const d=(0,s.connect)(e,t)(i),m=e=>{const t=(0,s.useDispatch)();return(0,r.useEffect)((()=>function(){t((0,n.e)({stateSelector:a}))}),[t]),(0,o.jsx)(d,Object.assign({},e))};return m.displayName=`ConnectWithCleanUp(${d.displayName})`,c()(m,i),m}},"./public/app/features/teams/TeamList.tsx":(e,t,a)=>{a.r(t),a.d(t,{TeamList:()=>C,default:()=>T});var s,n,r,i,c,o=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),d=a("./public/app/core/components/Page/Page.tsx"),m=a("./packages/grafana-ui/src/index.ts"),p=a("./public/app/core/components/EmptyListCTA/EmptyListCTA.tsx"),l=a("./public/app/types/index.ts"),u=a("./public/app/features/teams/state/actions.ts"),h=a("./public/app/features/teams/state/selectors.ts"),g=a("./public/app/core/selectors/navModel.ts"),f=a("./public/app/core/config.ts"),b=a("./public/app/core/services/context_srv.ts"),x=a("./public/app/core/components/connectWithCleanUp.tsx"),v=a("./public/app/features/teams/state/reducers.ts"),y=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function j(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class C extends o.PureComponent{constructor(...e){super(...e),j(this,"deleteTeam",(e=>{this.props.deleteTeam(e.id)})),j(this,"onSearchQueryChange",(e=>{this.props.setSearchQuery(e)}))}componentDidMount(){this.fetchTeams()}async fetchTeams(){await this.props.loadTeams()}renderTeam(e){var t;const{editorsCanAdmin:a,signedInUser:s}=this.props,n=e.permission,r=`org/teams/edit/${e.id}`,i=(0,h.kC)({permission:n,editorsCanAdmin:a,signedInUser:s});return(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"width-4 text-center link-td",children:(0,y.jsx)("a",{href:r,children:(0,y.jsx)("img",{className:"filter-table__avatar",src:e.avatarUrl,alt:"Team avatar"})})}),(0,y.jsx)("td",{className:"link-td",children:(0,y.jsx)("a",{href:r,children:e.name})}),(0,y.jsx)("td",{className:"link-td",children:(0,y.jsx)("a",{href:r,"aria-label":(null===(t=e.email)||void 0===t?void 0:t.length)>0?void 0:"Empty email cell",children:e.email})}),(0,y.jsx)("td",{className:"link-td",children:(0,y.jsx)("a",{href:r,children:e.memberCount})}),(0,y.jsx)("td",{className:"text-right",children:(0,y.jsx)(m.DeleteButton,{"aria-label":"Delete team",size:"sm",disabled:!i,onConfirm:()=>this.deleteTeam(e)})})]},e.id)}renderEmptyList(){return s||(s=(0,y.jsx)(p.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}))}renderTeamList(){const{teams:e,searchQuery:t,editorsCanAdmin:a,signedInUser:s}=this.props,o=a&&s.orgRole===l.B5.Viewer,d=o?" disabled":"",p=o?"#":"org/teams/new";return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"page-action-bar",children:[(0,y.jsx)("div",{className:"gf-form gf-form--grow",children:(0,y.jsx)(m.FilterInput,{placeholder:"Search teams",value:t,onChange:this.onSearchQueryChange})}),(0,y.jsx)(m.LinkButton,{className:d,href:p,children:"New Team"})]}),(0,y.jsx)("div",{className:"admin-list-table",children:(0,y.jsxs)("table",{className:"filter-table filter-table--hover form-inline",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[n||(n=(0,y.jsx)("th",{})),r||(r=(0,y.jsx)("th",{children:"Name"})),i||(i=(0,y.jsx)("th",{children:"Email"})),c||(c=(0,y.jsx)("th",{children:"Members"})),(0,y.jsx)("th",{style:{width:"1%"}})]})}),(0,y.jsx)("tbody",{children:e.map((e=>this.renderTeam(e)))})]})})]})}renderList(){const{teamsCount:e,hasFetched:t}=this.props;return t?e>0?this.renderTeamList():this.renderEmptyList():null}render(){const{hasFetched:e,navModel:t}=this.props;return(0,y.jsx)(d.Z,{navModel:t,children:(0,y.jsx)(d.Z.Contents,{isLoading:!e,children:this.renderList()})})}}const k={loadTeams:u.jI,deleteTeam:u.fC,setSearchQuery:v.ql},T=(0,x.$)((function(e){return{navModel:(0,g.h)(e.navIndex,"teams"),teams:(0,h.LK)(e.teams),searchQuery:(0,h.uP)(e.teams),teamsCount:(0,h.v7)(e.teams),hasFetched:e.teams.hasFetched,editorsCanAdmin:f.vc.editorsCanAdmin,signedInUser:b.Vt.user}}),k,(e=>e.teams))(C)},"./public/app/features/teams/state/actions.ts":(e,t,a)=>{a.d(t,{jI:()=>c,QX:()=>o,ei:()=>d,Lt:()=>m,zT:()=>p,fs:()=>l,j_:()=>u,A_:()=>h,P5:()=>g,fC:()=>f,zZ:()=>b});var s=a("./packages/grafana-runtime/src/index.ts"),n=a("./public/app/core/actions/index.ts"),r=a("./public/app/features/teams/state/navModel.ts"),i=a("./public/app/features/teams/state/reducers.ts");function c(){return async e=>{const t=await(0,s.getBackendSrv)().get("/api/teams/search",{perpage:1e3,page:1});e((0,i.PL)(t.teams))}}function o(e){return async t=>{const a=await(0,s.getBackendSrv)().get(`/api/teams/${e}`);t((0,i.y$)(a)),t((0,n.RL)((0,r.B)(a)))}}function d(){return async(e,t)=>{const a=t().team.team,n=await(0,s.getBackendSrv)().get(`/api/teams/${a.id}/members`);e((0,i.n2)(n))}}function m(e){return async(t,a)=>{const n=a().team.team;await(0,s.getBackendSrv)().post(`/api/teams/${n.id}/members`,{userId:e}),t(d())}}function p(e){return async(t,a)=>{const n=a().team.team;await(0,s.getBackendSrv)().delete(`/api/teams/${n.id}/members/${e}`),t(d())}}function l(e,t){return async(a,n)=>{const r=n().team.team;await(0,s.getBackendSrv)().put(`/api/teams/${r.id}`,{name:e,email:t}),a(o(r.id))}}function u(){return async(e,t)=>{const a=t().team.team,n=await(0,s.getBackendSrv)().get(`/api/teams/${a.id}/groups`);e((0,i.iI)(n))}}function h(e){return async(t,a)=>{const n=a().team.team;await(0,s.getBackendSrv)().post(`/api/teams/${n.id}/groups`,{groupId:e}),t(u())}}function g(e){return async(t,a)=>{const n=a().team.team;await(0,s.getBackendSrv)().delete(`/api/teams/${n.id}/groups/${encodeURIComponent(e)}`),t(u())}}function f(e){return async t=>{await(0,s.getBackendSrv)().delete(`/api/teams/${e}`),t(c())}}function b(e){return async t=>{await(0,s.getBackendSrv)().put(`/api/teams/${e.teamId}/members/${e.userId}`,{permission:e.permission}),t(d())}}},"./public/app/features/teams/state/navModel.ts":(e,t,a)=>{a.d(t,{B:()=>r,o:()=>i});var s=a("./public/app/types/index.ts"),n=a("./public/app/core/config.ts");function r(e){const t={img:e.avatarUrl,id:"team-"+e.id,subTitle:"Manage members and settings",url:"",text:e.name,breadcrumbs:[{title:"Teams",url:"org/teams"}],children:[{active:!1,icon:"users-alt",id:`team-members-${e.id}`,text:"Members",url:`org/teams/edit/${e.id}/members`},{active:!1,icon:"sliders-v-alt",id:`team-settings-${e.id}`,text:"Settings",url:`org/teams/edit/${e.id}/settings`}]};return n.ZP.licenseInfo.hasLicense&&t.children.push({active:!1,icon:"sync",id:`team-groupsync-${e.id}`,text:"External group sync",url:`org/teams/edit/${e.id}/groupsync`}),t}function i(e){const t=r({avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:s.hw.Member});let a;for(const s of t.children)if(s.id.indexOf(e)>0){s.active=!0,a=s;break}return{main:t,node:a}}},"./public/app/features/teams/state/selectors.ts":(e,t,a)=>{a.d(t,{uP:()=>n,xc:()=>r,JB:()=>i,v7:()=>c,VP:()=>o,LK:()=>d,YY:()=>m,vt:()=>p,kC:()=>l});var s=a("./public/app/types/index.ts");const n=e=>e.searchQuery,r=e=>e.searchMemberQuery,i=e=>e.groups,c=e=>e.teams.length,o=(e,t)=>e.team.id===parseInt(t,10)?e.team:null,d=e=>{const t=RegExp(e.searchQuery,"i");return e.teams.filter((e=>t.test(e.name)))},m=e=>{const t=RegExp(e.searchMemberQuery,"i");return e.members.filter((e=>t.test(e.login)||t.test(e.email)||t.test(e.name)))},p=e=>{const{members:t,signedInUser:a,editorsCanAdmin:n}=e,r=t.find((e=>e.userId===a.id)),i=r?r.permission:s.hw.Member;return l({permission:i,signedInUser:a,editorsCanAdmin:n})},l=e=>{const{permission:t,signedInUser:a,editorsCanAdmin:n}=e,r=a.isGrafanaAdmin||a.orgRole===s.B5.Admin,i=t===s.hw.Admin;return r||i||!n}}}]);
//# sourceMappingURL=TeamList.1f65f885c5a67f13d9d6.js.map