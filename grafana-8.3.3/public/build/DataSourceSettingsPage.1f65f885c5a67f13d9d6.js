"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3959],{"./public/app/features/datasources/settings/DataSourceSettingsPage.tsx":(e,t,a)=>{a.r(t),a.d(t,{DataSourceSettingsPage:()=>_,default:()=>W});var s=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=a("./public/app/core/components/Page/Page.tsx"),n=a("../../opt/drone/yarncache/lodash-npm-4.17.21-6382451519-eb835a2e51.zip/node_modules/lodash/lodash.js"),o=a("./packages/grafana-runtime/src/index.ts"),i=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c extends s.PureComponent{constructor(e){super(e),l(this,"element",null),l(this,"component",void 0),l(this,"scopeProps",void 0),l(this,"onModelChanged",(e=>{this.props.onModelChange(e)})),this.scopeProps={ctrl:{datasourceMeta:e.dataSourceMeta,current:(0,n.cloneDeep)(e.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:e}=this.props;if(this.element&&!e.components.ConfigEditor){const e=(0,o.getAngularLoader)(),t='<plugin-component type="datasource-config-ctrl" />';this.component=e.load(this.element,this.scopeProps,t)}}componentDidUpdate(e){const{plugin:t}=this.props;var a;t.components.ConfigEditor||this.props.dataSource===e.dataSource||(this.scopeProps.ctrl.current=(0,n.cloneDeep)(this.props.dataSource),null===(a=this.component)||void 0===a||a.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:e,dataSource:t}=this.props;return e?(0,i.jsx)("div",{ref:e=>this.element=e,children:e.components.ConfigEditor&&s.createElement(e.components.ConfigEditor,{options:t,onOptionsChange:this.onModelChanged})}):null}}var d,u=a("./packages/grafana-ui/src/index.ts"),p=a("./packages/grafana-e2e-selectors/src/index.ts");const{Input:h,Switch:g}=u.LegacyForms,f=({dataSourceName:e,isDefault:t,onDefaultChange:a,onNameChange:s})=>(0,i.jsx)("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings",children:(0,i.jsxs)("div",{className:"gf-form-inline",children:[(0,i.jsxs)("div",{className:"gf-form max-width-30",style:{marginRight:"3px"},children:[d||(d=(0,i.jsx)(u.InlineFormLabel,{tooltip:"The name is used when you select the data source in panels. The default data source is preselected in new panels.",children:"Name"})),(0,i.jsx)(h,{className:"gf-form-input max-width-23",type:"text",value:e,placeholder:"Name",onChange:e=>s(e.target.value),required:!0,"aria-label":p.wl.pages.DataSource.name})]}),(0,i.jsx)(g,{label:"Default",checked:t,onChange:e=>{a(e.target.checked)}})]})});var m=a("./public/app/types/index.ts"),b=a("./public/app/core/core.ts");const x=({isReadOnly:e,onDelete:t,onSubmit:a,onTest:s,exploreUrl:r})=>{const n=!e&&b.Vt.hasPermission(m.bW.DataSourcesWrite),o=!e&&b.Vt.hasPermission(m.bW.DataSourcesDelete),l=b.Vt.hasPermission(m.bW.DataSourcesExplore);return(0,i.jsxs)("div",{className:"gf-form-button-row",children:[(0,i.jsx)(u.Button,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back(),children:"Back"}),(0,i.jsx)(u.LinkButton,{variant:"secondary",fill:"solid",href:r,disabled:!l,children:"Explore"}),(0,i.jsx)(u.Button,{type:"button",variant:"destructive",disabled:!o,onClick:t,"aria-label":p.wl.pages.DataSource.delete,children:"Delete"}),n&&(0,i.jsx)(u.Button,{type:"submit",variant:"primary",disabled:!n,onClick:e=>a(e),"aria-label":p.wl.pages.DataSource.saveAndTest,children:"Save & test"}),!n&&(0,i.jsx)(u.Button,{type:"submit",variant:"primary",onClick:s,children:"Test"})]})};var S=a("./public/app/core/app_events.ts"),v=a("./public/app/features/datasources/state/selectors.ts"),y=a("./public/app/features/datasources/state/actions.ts"),D=a("./public/app/core/selectors/navModel.ts"),j=a("./packages/grafana-data/src/index.ts"),C=a("./public/app/features/datasources/state/navModel.ts"),k=a("./public/app/features/plugins/components/PluginStateInfo.tsx"),P=a("./public/app/features/datasources/state/reducers.ts"),M=a("./public/app/core/config.ts"),w=a("./packages/grafana-data/src/types/config.ts"),N=a("./public/app/core/components/LocalStorageValueProvider/index.tsx");const O=({dataSource:e})=>{var t;let a="",s="";if(e.readOnly||(null!==(t=e.version)&&void 0!==t?t:0)>2)return null;if(M.vc.buildInfo.edition!==w.e.OpenSource)return null;switch(e.type){case"prometheus":a="Prometheus",s="Loki";break;case"loki":a="Loki",s="Prometheus";break;default:return null}return(0,i.jsx)(N.G,{storageKey:"datasources.settings.cloudInfoBox.isDismissed",defaultValue:!1,children:(t,r)=>t?null:(0,i.jsxs)(u.Alert,{title:`Configure your ${a} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{r(!0)},children:["Or skip the effort and get ",a," (and ",s,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",(0,i.jsx)("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${e.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage.",children:"free-forever Grafana Cloud plan"}),"."]})})};var E,T,B=a("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),I=a("./public/app/core/actions/cleanUp.ts"),L=a("./public/app/types/events.ts");function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const U={deleteDataSource:y.xU,loadDataSource:y.gv,setDataSourceName:P.BX,updateDataSource:y.oe,setIsDefault:P.yr,dataSourceLoaded:P.rl,initDataSourceSettings:y.M9,testDataSource:y.kY,cleanUpAction:I.e},A=(0,B.connect)((function(e,t){const a=t.match.params.uid,s=new URLSearchParams(t.location.search),r=(0,v.f6)(e.dataSources,a),{plugin:n,loadError:o,loading:i,testingStatus:l}=e.dataSourceSettings,c=s.get("page"),d=n?(0,C.nI)((0,C.B1)(r,n),c||"settings"):(0,C.xG)("settings"),u=(0,D.h)(e.navIndex,c?`datasource-page-${c}`:`datasource-settings-${a}`,d);return{dataSource:(0,v.f6)(e.dataSources,a),dataSourceMeta:(0,v.G4)(e.dataSources,r.type),dataSourceId:a,page:c,plugin:n,loadError:o,loading:i,testingStatus:l,navModel:u}}),U);class _ extends s.PureComponent{constructor(...e){super(...e),R(this,"onSubmit",(async e=>{e.preventDefault(),await this.props.updateDataSource(Object.assign({},this.props.dataSource)),this.testDataSource()})),R(this,"onTest",(async e=>{e.preventDefault(),this.testDataSource()})),R(this,"onDelete",(()=>{S.Z.publish(new L.VJ({title:"Delete",text:`Are you sure you want to delete the "${this.props.dataSource.name}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>{this.confirmDelete()}}))})),R(this,"confirmDelete",(()=>{this.props.deleteDataSource()})),R(this,"onModelChange",(e=>{this.props.dataSourceLoaded(e)}))}componentDidMount(){const{initDataSourceSettings:e,dataSourceId:t}=this.props;e(t)}componentWillUnmount(){this.props.cleanUpAction({stateSelector:e=>e.dataSourceSettings})}isReadOnly(){return!0===this.props.dataSource.readOnly}renderIsReadOnlyMessage(){return(0,i.jsx)(u.Alert,{"aria-label":p.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source",children:"This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source."})}renderMissingEditRightsMessage(){return E||(E=(0,i.jsx)(u.Alert,{severity:"info",title:"Missing rights",children:"You are not allowed to modify this data source. Please contact your server admin to update this data source."}))}testDataSource(){const{dataSource:e,testDataSource:t}=this.props;t(e.name)}get hasDataSource(){return this.props.dataSource.id>0}onNavigateToExplore(){const{dataSource:e}=this.props,t=JSON.stringify({datasource:e.name,context:"explore"});return j.urlUtil.renderUrl("/explore",{left:t})}renderLoadError(){const{loadError:e}=this.props,t=!this.isReadOnly()&&b.Vt.hasPermission(m.bW.DataSourcesDelete),a={text:e,subTitle:"Data Source Error",icon:"exclamation-triangle"},s={node:a,main:a};return(0,i.jsx)(r.Z,{navModel:s,children:(0,i.jsxs)(r.Z.Contents,{isLoading:this.props.loading,children:[this.isReadOnly()&&this.renderIsReadOnlyMessage(),(0,i.jsxs)("div",{className:"gf-form-button-row",children:[t&&(0,i.jsx)(u.Button,{type:"submit",variant:"destructive",onClick:this.onDelete,children:"Delete"}),(0,i.jsx)(u.Button,{variant:"secondary",fill:"outline",type:"button",onClick:()=>history.back(),children:"Back"})]})]})})}renderConfigPageBody(e){const{plugin:t}=this.props;if(!t||!t.configPages)return null;for(const a of t.configPages)if(a.id===e)return(0,i.jsx)(a.body,{plugin:t,query:{}});return(0,i.jsxs)("div",{children:["Page not found: ",e]})}renderAlertDetails(){var e,t,a;const{testingStatus:s}=this.props;return(0,i.jsxs)(i.Fragment,{children:[null==s||null===(e=s.details)||void 0===e?void 0:e.message,null!=s&&null!==(t=s.details)&&void 0!==t&&t.verboseMessage?(0,i.jsx)("details",{style:{whiteSpace:"pre-wrap"},children:null==s||null===(a=s.details)||void 0===a?void 0:a.verboseMessage}):null]})}renderSettings(){const{dataSourceMeta:e,setDataSourceName:t,setIsDefault:a,dataSource:s,plugin:r,testingStatus:n}=this.props,o=b.Vt.hasPermission(m.bW.DataSourcesWrite);return(0,i.jsxs)("form",{onSubmit:this.onSubmit,children:[!o&&this.renderMissingEditRightsMessage(),this.isReadOnly()&&this.renderIsReadOnlyMessage(),e.state&&(0,i.jsxs)("div",{className:"gf-form",children:[T||(T=(0,i.jsx)("label",{className:"gf-form-label width-10",children:"Plugin state"})),(0,i.jsx)("label",{className:"gf-form-label gf-form-label--transparent",children:(0,i.jsx)(k.u,{state:e.state})})]}),(0,i.jsx)(O,{dataSource:s}),(0,i.jsx)(f,{dataSourceName:s.name,isDefault:s.isDefault,onDefaultChange:e=>a(e),onNameChange:e=>t(e)}),r&&(0,i.jsx)(c,{plugin:r,dataSource:s,dataSourceMeta:e,onModelChange:this.onModelChange}),(null==n?void 0:n.message)&&(0,i.jsx)("div",{className:"gf-form-group p-t-2",children:(0,i.jsx)(u.Alert,{severity:"error"===n.status?"error":"success",title:n.message,"aria-label":p.wl.pages.DataSource.alert,children:n.details&&this.renderAlertDetails()})}),(0,i.jsx)(x,{onSubmit:e=>this.onSubmit(e),isReadOnly:this.isReadOnly(),onDelete:this.onDelete,onTest:e=>this.onTest(e),exploreUrl:this.onNavigateToExplore()})]})}render(){const{navModel:e,page:t,loadError:a,loading:s}=this.props;return a?this.renderLoadError():(0,i.jsx)(r.Z,{navModel:e,children:(0,i.jsx)(r.Z.Contents,{isLoading:s,children:this.hasDataSource?(0,i.jsx)("div",{children:t?this.renderConfigPageBody(t):this.renderSettings()}):null})})}}const W=A(_)},"./public/app/features/plugins/components/PluginStateInfo.tsx":(e,t,a)=>{a.d(t,{u:()=>o});a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js");var s=a("./packages/grafana-ui/src/index.ts"),r=a("./packages/grafana-data/src/index.ts"),n=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const o=e=>{const t=function(e){switch(e){case r.PluginState.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case r.PluginState.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case r.PluginState.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}(e.state);return t?(0,n.jsx)(s.Badge,{color:t.color,title:t.tooltip,text:t.text,icon:t.icon}):null}}}]);
//# sourceMappingURL=DataSourceSettingsPage.1f65f885c5a67f13d9d6.js.map