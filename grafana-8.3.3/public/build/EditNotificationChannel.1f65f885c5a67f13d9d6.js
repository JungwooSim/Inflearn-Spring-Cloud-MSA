"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7384],{"./public/app/core/components/connectWithCleanUp.tsx":(e,t,n)=>{n.d(t,{$:()=>c});var s=n("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),i=n("./public/app/core/actions/cleanUp.ts"),a=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=n("../../opt/drone/yarncache/hoist-non-react-statics-npm-3.3.2-e7b709e6c1-b153827042.zip/node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js"),o=n.n(r),l=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const c=(e,t,n)=>r=>{const c=(0,s.connect)(e,t)(r),d=e=>{const t=(0,s.useDispatch)();return(0,a.useEffect)((()=>function(){t((0,i.e)({stateSelector:n}))}),[t]),(0,l.jsx)(c,Object.assign({},e))};return d.displayName=`ConnectWithCleanUp(${c.displayName})`,o()(d,r),d}},"./public/app/features/alerting/EditNotificationChannelPage.tsx":(e,t,n)=>{n.r(t),n.d(t,{EditNotificationChannelPage:()=>b,default:()=>v});var s,i,a=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),r=n("./packages/grafana-runtime/src/index.ts"),o=n("./packages/grafana-ui/src/index.ts"),l=n("./public/app/core/components/Page/Page.tsx"),c=n("./public/app/core/components/connectWithCleanUp.tsx"),d=n("./public/app/features/alerting/components/NotificationChannelForm.tsx"),u=n("./public/app/features/alerting/state/actions.ts"),p=n("./public/app/core/selectors/navModel.ts"),f=n("./public/app/features/alerting/utils/notificationChannels.ts"),h=n("./public/app/features/alerting/state/reducers.ts"),g=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class b extends a.PureComponent{constructor(...e){super(...e),m(this,"onSubmit",(e=>{const{notificationChannel:t}=this.props;this.props.updateNotificationChannel(Object.assign({},(0,f.YV)(Object.assign({},t,e,{settings:Object.assign({},t.settings,e.settings)})),{id:t.id}))})),m(this,"onTestChannel",(e=>{const{notificationChannel:t}=this.props;this.props.testNotificationChannel((0,f.dv)(Object.assign({},t,e,{settings:Object.assign({},t.settings,e.settings)})))}))}componentDidMount(){this.props.loadNotificationChannel(parseInt(this.props.match.params.id,10))}render(){const{navModel:e,notificationChannel:t,notificationChannelTypes:n}=this.props;return(0,g.jsx)(l.Z,{navModel:e,children:(0,g.jsxs)(l.Z.Contents,{children:[s||(s=(0,g.jsx)("h2",{className:"page-sub-heading",children:"Edit notification channel"})),t&&t.id>0?(0,g.jsx)(o.Form,{maxWidth:600,onSubmit:this.onSubmit,defaultValues:Object.assign({},t,{type:n.find((e=>e.value===t.type))}),children:({control:e,errors:s,getValues:i,register:a,watch:o})=>{const l=n.find((e=>e.value===i().type.value));return(0,g.jsx)(d.w,{selectableChannels:(0,f.t7)(n,!0),selectedChannel:l,imageRendererAvailable:r.config.rendererAvailable,onTestChannel:this.onTestChannel,register:a,watch:o,errors:s,getValues:i,control:e,resetSecureField:this.props.resetSecureField,secureFields:t.secureFields})}}):i||(i=(0,g.jsxs)("div",{children:["Loading notification channel",(0,g.jsx)(o.Spinner,{})]}))]})})}}const j={loadNotificationChannel:u.tk,testNotificationChannel:u.c1,updateNotificationChannel:u.fg,resetSecureField:h.J0},v=(0,c.$)((e=>({navModel:(0,p.h)(e.navIndex,"channels"),notificationChannel:e.notificationChannel.notificationChannel,notificationChannelTypes:e.notificationChannel.notificationChannelTypes})),j,(e=>e.notificationChannel))(b)},"./public/app/features/alerting/components/NotificationChannelForm.tsx":(e,t,n)=>{n.d(t,{w:()=>x});var s,i=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),a=n("./.yarn/__virtual__/@emotion-css-virtual-9fd25d72e0/3/opt/drone/yarncache/@emotion-css-npm-11.1.3-72aa05c30f-dc50283f65.zip/node_modules/@emotion/css/dist/emotion-css.esm.js"),r=n("./packages/grafana-ui/src/index.ts"),o=n("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");const l=({currentFormValues:e,imageRendererAvailable:t,register:n})=>(0,o.jsxs)(r.CollapsableSection,{label:"Notification settings",isOpen:!1,children:[(0,o.jsx)(r.Field,{children:(0,o.jsx)(r.Checkbox,Object.assign({},n("isDefault"),{label:"Default",description:"Use this notification for all alerts"}))}),(0,o.jsx)(r.Field,{children:(0,o.jsx)(r.Checkbox,Object.assign({},n("settings.uploadImage"),{label:"Include image",description:"Captures an image and include it in the notification"}))}),e.uploadImage&&!t&&(s||(s=(0,o.jsx)(r.InfoBox,{title:"No image renderer available/installed",children:"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."}))),(0,o.jsx)(r.Field,{children:(0,o.jsx)(r.Checkbox,Object.assign({},n("disableResolveMessage"),{label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"}))}),(0,o.jsx)(r.Field,{children:(0,o.jsx)(r.Checkbox,Object.assign({},n("sendReminder"),{label:"Send reminders",description:"Send additional notifications for triggered alerts"}))}),e.sendReminder&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(r.Field,{label:"Send reminder every",description:"Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc. Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently than a configured alert rule evaluation interval.",children:(0,o.jsx)(r.Input,Object.assign({},n("frequency"),{width:8}))})})]}),c=["ref"];const d=({control:e,option:t,register:n,invalid:s})=>{const i=t.secure?`secureSettings.${t.propertyName}`:`settings.${t.propertyName}`;switch(t.element){case"input":return(0,o.jsx)(r.Input,Object.assign({},n(`${i}`,{required:!!t.required&&"Required",validate:e=>""===t.validationRule||u(e,t.validationRule)}),{invalid:s,type:t.inputType,placeholder:t.placeholder}));case"select":return(0,o.jsx)(r.InputControl,{control:e,name:`${i}`,render:e=>{var n;let{}=e,i=function(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,c);return(0,o.jsx)(r.Select,Object.assign({menuShouldPortal:!0},i,{options:null!==(n=t.selectOptions)&&void 0!==n?n:void 0,invalid:s}))}});case"textarea":return(0,o.jsx)(r.TextArea,Object.assign({invalid:s},n(`${i}`,{required:!!t.required&&"Required",validate:e=>""===t.validationRule||u(e,t.validationRule)})));default:return console.error("Element not supported",t.element),null}},u=(e,t)=>!!RegExp(t).test(e)||"Invalid format",p=({control:e,currentFormValues:t,errors:n,selectedChannelOptions:s,register:i,onResetSecureField:a,secureFields:l})=>(0,o.jsx)(o.Fragment,{children:s.map(((s,c)=>{var u;const p=`${s.label}-${c}`,f=t[`settings.${s.showWhen.field}`]&&t[`settings.${s.showWhen.field}`].value;return s.showWhen.field&&f!==s.showWhen.is?null:"checkbox"===s.element?(0,o.jsx)(r.Field,{children:(0,o.jsx)(r.Checkbox,Object.assign({},i(s.secure?`secureSettings.${s.propertyName}`:`settings.${s.propertyName}`),{label:s.label,description:s.description}))},p):(0,o.jsx)(r.Field,{label:s.label,description:s.description,invalid:n.settings&&!!n.settings[s.propertyName],error:n.settings&&(null===(u=n.settings[s.propertyName])||void 0===u?void 0:u.message),children:l&&l[s.propertyName]?(0,o.jsx)(r.Input,{readOnly:!0,value:"Configured",suffix:(0,o.jsx)(r.Button,{onClick:()=>a(s.propertyName),fill:"text",type:"button",size:"sm",children:"Clear"})}):(0,o.jsx)(d,{option:s,register:i,control:e})},p)}))}),f=["ref"];const h=({control:e,currentFormValues:t,errors:n,secureFields:s,selectedChannel:i,channels:a,register:l,resetSecureField:c})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Field,{label:"Name",invalid:!!n.name,error:n.name&&n.name.message,children:(0,o.jsx)(r.Input,Object.assign({},l("name",{required:"Name is required"})))}),(0,o.jsx)(r.Field,{label:"Type",children:(0,o.jsx)(r.InputControl,{name:"type",render:e=>{let{}=e,t=function(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e.field,f);return(0,o.jsx)(r.Select,Object.assign({menuShouldPortal:!0},t,{options:a}))},control:e,rules:{required:!0}})}),(0,o.jsx)(p,{selectedChannelOptions:i.options.filter((e=>e.required)),currentFormValues:t,secureFields:s,onResetSecureField:c,register:l,errors:n,control:e})]}),g=({control:e,currentFormValues:t,errors:n,selectedChannel:s,secureFields:i,register:a,resetSecureField:l})=>{var c;return(0,o.jsxs)(r.CollapsableSection,{label:`Optional ${s.heading}`,isOpen:!1,children:[""!==s.info&&(0,o.jsx)(r.Alert,{severity:"info",title:null!==(c=s.info)&&void 0!==c?c:""}),(0,o.jsx)(p,{selectedChannelOptions:s.options.filter((e=>!e.required)),currentFormValues:t,register:a,errors:n,control:e,onResetSecureField:l,secureFields:i})]})};var m,b,j,v=n("./public/app/core/config.ts");const x=({control:e,errors:t,selectedChannel:n,selectableChannels:s,register:a,watch:c,getValues:d,imageRendererAvailable:u,onTestChannel:p,resetSecureField:f,secureFields:x})=>{const C=y((0,r.useTheme)());(0,i.useEffect)((()=>{const e=new Set(null==n?void 0:n.options.filter((e=>e.showWhen.field)).map((e=>`settings.${e.showWhen.field}`)))||[];c(["type","sendReminder","uploadImage",...e])}),[null==n?void 0:n.options,c]);const S=d();return n?(0,o.jsxs)("div",{className:C.formContainer,children:[(0,o.jsx)("div",{className:C.formItem,children:(0,o.jsx)(h,{selectedChannel:n,channels:s,secureFields:x,resetSecureField:f,currentFormValues:S,register:a,errors:t,control:e})}),n.options.filter((e=>!e.required)).length>0&&(0,o.jsx)("div",{className:C.formItem,children:(0,o.jsx)(g,{selectedChannel:n,secureFields:x,resetSecureField:f,currentFormValues:S,register:a,errors:t,control:e})}),(0,o.jsx)("div",{className:C.formItem,children:(0,o.jsx)(l,{imageRendererAvailable:u,currentFormValues:S,register:a,errors:t,control:e})}),(0,o.jsx)("div",{className:C.formButtons,children:(0,o.jsxs)(r.HorizontalGroup,{children:[b||(b=(0,o.jsx)(r.Button,{type:"submit",children:"Save"})),(0,o.jsx)(r.Button,{type:"button",variant:"secondary",onClick:()=>p(d()),children:"Test"}),(0,o.jsx)("a",{href:`${v.ZP.appSubUrl}/alerting/notifications`,children:j||(j=(0,o.jsx)(r.Button,{type:"button",variant:"secondary",children:"Back"}))})]})})]}):m||(m=(0,o.jsx)(r.Spinner,{}))},y=(0,r.stylesFactory)((e=>({formContainer:a.css``,formItem:a.css`
      flex-grow: 1;
      padding-top: ${e.spacing.md};
    `,formButtons:a.css`
      padding-top: ${e.spacing.xl};
    `})))},"./public/app/features/alerting/state/actions.ts":(e,t,n)=>{n.d(t,{Au:()=>o,en:()=>l,C2:()=>c,fg:()=>d,c1:()=>u,fA:()=>p,tk:()=>f});var s=n("./packages/grafana-data/src/index.ts"),i=n("./packages/grafana-runtime/src/index.ts"),a=n("./public/app/core/core.ts"),r=n("./public/app/features/alerting/state/reducers.ts");function o(e){return async t=>{t((0,r.gz)());const n=await(0,i.getBackendSrv)().get("/api/alerts",e);t((0,r.Oc)(n))}}function l(e,t){return async n=>{await(0,i.getBackendSrv)().post(`/api/alerts/${e}/pause`,t);n(o({state:(i.locationService.getSearchObject().state||"all").toString()}))}}function c(e){return async t=>{try{await(0,i.getBackendSrv)().post("/api/alert-notifications",e),a.h$.emit(s.AppEvents.alertSuccess,["Notification created"]),i.locationService.push("/alerting/notifications")}catch(e){a.h$.emit(s.AppEvents.alertError,[e.data.error])}}}function d(e){return async t=>{try{await(0,i.getBackendSrv)().put(`/api/alert-notifications/${e.id}`,e),a.h$.emit(s.AppEvents.alertSuccess,["Notification updated"])}catch(e){a.h$.emit(s.AppEvents.alertError,[e.data.error])}}}function u(e){return async(t,n)=>{const s=n().notificationChannel.notificationChannel;await(0,i.getBackendSrv)().post("/api/alert-notifications/test",Object.assign({id:s.id},e))}}function p(){return async e=>{const t=(await(0,i.getBackendSrv)().get("/api/alert-notifiers")).sort(((e,t)=>e.name>t.name?1:-1));e((0,r.T2)(t))}}function f(e){return async t=>{await t(p());const n=await(0,i.getBackendSrv)().get(`/api/alert-notifications/${e}`);t((0,r.K)(n))}}},"./public/app/features/alerting/utils/notificationChannels.ts":(e,t,n)=>{n.d(t,{Pg:()=>i,t7:()=>a,YV:()=>r,dv:()=>o});var s=n("../../opt/drone/yarncache/memoize-one-npm-6.0.0-8b2a2cd020-f185ea69f7.zip/node_modules/memoize-one/dist/memoize-one.esm.js");const i={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:n("./packages/grafana-runtime/src/index.ts").config.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},a=(0,s.Z)(((e,t)=>e.map((e=>t?{value:e.value,label:e.label,description:e.description}:{value:e.value,label:e.label})))),r=e=>{const t=Object.fromEntries(Object.entries(e.settings).map((([e,t])=>[e,t&&t.hasOwnProperty("value")?t.value:t])));return Object.assign({},i,e,{frequency:""===e.frequency?i.frequency:e.frequency,type:e.type.value,settings:Object.assign({},i.settings,t),secureSettings:Object.assign({},e.secureSettings)})},o=e=>{var t;return{name:e.name,type:e.type.value,frequency:null!==(t=e.frequency)&&void 0!==t?t:i.frequency,settings:Object.assign({},Object.assign(i.settings,e.settings)),secureSettings:Object.assign({},e.secureSettings)}}}}]);
//# sourceMappingURL=EditNotificationChannel.1f65f885c5a67f13d9d6.js.map