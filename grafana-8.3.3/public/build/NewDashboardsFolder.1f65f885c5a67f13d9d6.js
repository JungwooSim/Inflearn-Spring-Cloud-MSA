"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8932],{"./public/app/features/folders/components/NewDashboardsFolder.tsx":(e,s,a)=>{a.r(s),a.d(s,{NewDashboardsFolder:()=>v,default:()=>g});var r,t,i=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/index.js"),n=a("./.yarn/__virtual__/react-redux-virtual-8e30c710ae/3/opt/drone/yarncache/react-redux-npm-7.2.5-cf7e365145-04ac4a4178.zip/node_modules/react-redux/es/index.js"),o=a("./packages/grafana-ui/src/index.ts"),d=a("./public/app/core/components/Page/Page.tsx"),c=a("./public/app/features/folders/state/actions.ts"),l=a("./public/app/core/selectors/navModel.ts"),u=a("./public/app/features/manage-dashboards/services/ValidationSrv.ts"),p=a("../../opt/drone/yarncache/react-npm-17.0.1-98658812fc-83b9df9529.zip/node_modules/react/jsx-runtime.js");function f(e,s,a){return s in e?Object.defineProperty(e,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[s]=a,e}const m={createNewFolder:c.W7},h=(0,n.connect)((e=>({navModel:(0,l.h)(e.navIndex,"manage-dashboards")})),m),b={folderName:""};class v extends i.PureComponent{constructor(...e){super(...e),f(this,"onSubmit",(e=>{this.props.createNewFolder(e.folderName)})),f(this,"validateFolderName",(e=>u.t.validateNewFolderName(e).then((()=>!0)).catch((e=>e.message))))}render(){return(0,p.jsx)(d.Z,{navModel:this.props.navModel,children:(0,p.jsxs)(d.Z.Contents,{children:[r||(r=(0,p.jsx)("h3",{children:"New dashboard folder"})),(0,p.jsx)(o.Form,{defaultValues:b,onSubmit:this.onSubmit,children:({register:e,errors:s})=>(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(o.Field,{label:"Folder name",invalid:!!s.folderName,error:s.folderName&&s.folderName.message,children:(0,p.jsx)(o.Input,Object.assign({id:"folder-name-input"},e("folderName",{required:"Folder name is required.",validate:async e=>await this.validateFolderName(e)})))}),t||(t=(0,p.jsx)(o.Button,{type:"submit",children:"Create"}))]})})]})})}}const g=h(v)},"./public/app/features/folders/state/actions.ts":(e,s,a)=>{a.d(s,{Pb:()=>l,OD:()=>u,Go:()=>p,a:()=>f,v7:()=>h,Uk:()=>b,pz:()=>v,W7:()=>g});var r=a("./packages/grafana-data/src/index.ts"),t=a("./packages/grafana-runtime/src/index.ts"),i=a("./public/app/core/services/backend_srv.ts"),n=a("./public/app/core/actions/index.ts"),o=a("./public/app/features/folders/state/navModel.ts"),d=a("./public/app/core/app_events.ts"),c=a("./public/app/features/folders/state/reducers.ts");function l(e){return async s=>{const a=await i.ae.getFolderByUid(e);s((0,c.G3)(a)),s((0,n.RL)((0,o.B)(a)))}}function u(e){return async s=>{const a=await i.ae.put(`/api/folders/${e.uid}`,{title:e.title,version:e.version});d.Z.emit(r.AppEvents.alertSuccess,["Folder saved"]),t.locationService.push(`${a.url}/settings`)}}function p(e){return async()=>{await i.ae.delete(`/api/folders/${e}?forceDeleteRules=false`),t.locationService.push("/dashboards")}}function f(e){return async s=>{const a=await i.ae.get(`/api/folders/${e}/permissions`);s((0,c.R7)(a))}}function m(e){return{userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}}function h(e,s){return async(a,r)=>{const t=r().folder,n=[];for(const a of t.permissions){if(a.inherited)continue;const r=m(a);e===a&&(r.permission=s),n.push(r)}await i.ae.post(`/api/folders/${t.uid}/permissions`,{items:n}),await a(f(t.uid))}}function b(e){return async(s,a)=>{const r=a().folder,t=[];for(const s of r.permissions)s.inherited||s===e||t.push(m(s));await i.ae.post(`/api/folders/${r.uid}/permissions`,{items:t}),await s(f(r.uid))}}function v(e){return async(s,a)=>{const r=a().folder,t=[];for(const e of r.permissions)e.inherited||t.push(m(e));t.push({userId:e.userId,teamId:e.teamId,role:e.role,permission:e.permission}),await i.ae.post(`/api/folders/${r.uid}/permissions`,{items:t}),await s(f(r.uid))}}function g(e){return async()=>{const s=await(0,t.getBackendSrv)().post("/api/folders",{title:e});d.Z.emit(r.AppEvents.alertSuccess,["Folder Created","OK"]),t.locationService.push(r.locationUtil.stripBaseFromUrl(s.url))}}},"./public/app/features/folders/state/navModel.ts":(e,s,a)=>{function r(e){const s={icon:"folder",id:"manage-folder",subTitle:"Manage folder dashboards and permissions",url:"",text:e.title,breadcrumbs:[{title:"Dashboards",url:"dashboards"}],children:[{active:!1,icon:"apps",id:`folder-dashboards-${e.uid}`,text:"Dashboards",url:e.url}]};return s.children.push({active:!1,icon:"library-panel",id:`folder-library-panels-${e.uid}`,text:"Panels",url:`${e.url}/library-panels`}),e.canAdmin&&s.children.push({active:!1,icon:"lock",id:`folder-permissions-${e.uid}`,text:"Permissions",url:`${e.url}/permissions`}),e.canSave&&s.children.push({active:!1,icon:"cog",id:`folder-settings-${e.uid}`,text:"Settings",url:`${e.url}/settings`}),s}function t(e){const s=r({id:1,uid:"loading",title:"Loading",url:"url",canSave:!0,canEdit:!0,canAdmin:!0,version:0});return s.children[e].active=!0,{main:s,node:s.children[e]}}a.d(s,{B:()=>r,_:()=>t})}}]);
//# sourceMappingURL=NewDashboardsFolder.1f65f885c5a67f13d9d6.js.map