define(["tslib","react","@grafana/data","@grafana/ui"],(function(e,t,a,r){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=4)}([function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t,a){"use strict";a.r(t);var r=a(2),n=a(0),o=function(e){function t(t){var a=e.call(this,t)||this;return a.data=[],t.jsonData.data&&(a.data=t.jsonData.data.map((function(e){return Object(r.toDataFrame)(e)}))),a}return Object(n.__extends)(t,e),t.prototype.getQueryDisplayText=function(e){return e.data?"Panel Data: "+s(e.data):"Shared Data From: "+this.name+" ("+s(this.data)+")"},t.prototype.metricFindQuery=function(e,t){var a=this;return new Promise((function(e,t){var r,o,i,s,u=[];try{for(var l=Object(n.__values)(a.data),c=l.next();!c.done;c=l.next()){var d=c.value;try{for(var f=(i=void 0,Object(n.__values)(d.fields)),p=f.next();!p.done;p=f.next()){var h=p.value;u.push({text:h.name})}}catch(e){i={error:e}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}e(u)}))},t.prototype.query=function(e){var t,a,o=[];try{for(var i=Object(n.__values)(e.targets),s=i.next();!s.done;s=i.next()){var u=s.value;if(!u.hide){var l=this.data;u.data&&(l=u.data.map((function(e){return Object(r.toDataFrame)(e)})));for(var c=0;c<l.length;c++)o.push(Object(n.__assign)(Object(n.__assign)({},l[c]),{refId:u.refId}))}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(t)throw t.error}}return Promise.resolve({data:o})},t.prototype.testDatasource=function(){var e=this;return new Promise((function(t,a){var r,o,i=0,s=e.data.length+" Series:";try{for(var u=Object(n.__values)(e.data),l=u.next();!l.done;l=u.next()){var c=l.value,d=c.length;s+=" ["+c.fields.length+" Fields, "+d+" Rows]",i+=d}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}i>0&&t({status:"success",message:s}),a({status:"error",message:"No Data Entered"})}))},t}(r.DataSourceApi);function i(e){return e&&e.fields&&e.fields.length?e.hasOwnProperty("length")?e.length:e.fields[0].values.length:0}function s(e){if(!e||!e.length)return"";if(e.length>1){var t=e.reduce((function(e,t){return e+i(t)}),0);return e.length+" Series, "+t+" Rows"}var a=e[0];if(!a.fields)return"Missing Fields";var r=i(a);return a.fields.length+" Fields, "+r+" Rows"}var u=a(1),l=a.n(u),c=a(3);function d(e){return e&&e.length?Object(r.toCSV)(e.map((function(e){return Object(r.toDataFrame)(e)}))):""}var f=[{value:"panel",label:"Panel",description:"Save data in the panel configuration."},{value:"shared",label:"Shared",description:"Save data in the shared datasource object."}],p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={text:""},t.onSourceChange=function(e){var a=t.props,o=a.datasource,i=a.query,s=a.onChange,u=a.onRunQuery,l=void 0;if("panel"===e.value){if(i.data)return;(l=Object(n.__spreadArray)([],Object(n.__read)(o.data),!1))||(l=[new r.MutableDataFrame]),t.setState({text:Object(r.toCSV)(l)})}s(Object(n.__assign)(Object(n.__assign)({},i),{data:l})),u()},t.onSeriesParsed=function(e,a){var o=t.props,i=o.query,s=o.onChange,u=o.onRunQuery;t.setState({text:a}),e||(e=[new r.MutableDataFrame]),s(Object(n.__assign)(Object(n.__assign)({},i),{data:e})),u()},t}return Object(n.__extends)(t,e),t.prototype.onComponentDidMount=function(){var e=d(this.props.query.data);this.setState({text:e})},t.prototype.render=function(){var e=this.props,t=e.datasource,a=e.query,r=t.uid,n=t.name,o=this.state.text,i=a.data?f[0]:f[1];return l.a.createElement("div",null,l.a.createElement(c.InlineField,{label:"Data",labelWidth:8},l.a.createElement(l.a.Fragment,null,l.a.createElement(c.Select,{menuShouldPortal:!0,width:20,options:f,value:i,onChange:this.onSourceChange}),a.data?l.a.createElement("div",{style:{alignSelf:"center"}},s(a.data)):l.a.createElement(c.LinkButton,{variant:"link",href:"datasources/edit/"+r+"/"},n,": ",s(t.data),"   ",l.a.createElement(c.Icon,{name:"pen"})))),a.data&&l.a.createElement(c.TableInputCSV,{text:o,onSeriesParsed:this.onSeriesParsed,width:"100%",height:200}))},t}(u.PureComponent),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={text:""},t.onSeriesParsed=function(e,a){var o=t.props,i=o.options,s=o.onOptionsChange;e||(e=[new r.MutableDataFrame]);var u=Object(n.__assign)(Object(n.__assign)({},i.jsonData),{data:e});s(Object(n.__assign)(Object(n.__assign)({},i),{jsonData:u})),t.setState({text:a})},t}return Object(n.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.options;if(e.jsonData.data){var t=d(e.jsonData.data);this.setState({text:t})}},t.prototype.render=function(){var e=this.state.text;return l.a.createElement("div",null,l.a.createElement("div",{className:"gf-form-group"},l.a.createElement("h4",null,"Shared Data:"),l.a.createElement("span",null,"Enter CSV"),l.a.createElement(c.TableInputCSV,{text:e,onSeriesParsed:this.onSeriesParsed,width:"100%",height:200})),l.a.createElement("div",{className:"grafana-info-box"},"This data is stored in the datasource json and is returned to every user in the initial request for any datasource. This is an appropriate place to enter a few values. Large datasets will perform better in other datasources.",l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("b",null,"NOTE:")," Changes to this data will only be reflected after a browser refresh."))},t}(u.PureComponent);a.d(t,"plugin",(function(){return v}));var v=new r.DataSourcePlugin(o).setConfigEditor(h).setQueryEditor(p)}])}));
//# sourceMappingURL=module.js.map